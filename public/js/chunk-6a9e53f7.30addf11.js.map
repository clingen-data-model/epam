{"version":3,"sources":["webpack:///./src/components/groups/AnnualUpdateAlert.vue","webpack:///./src/components/groups/AnnualUpdateAlert.vue?6eef","webpack:///./src/views/Dashboard.vue","webpack:///./src/views/Dashboard.vue?1521"],"names":["class","$options","$data","id","_createBlock","_component_static_alert","variant","_createElementVNode","_createVNode","_component_icon_review","height","width","$props","_createElementBlock","_hoisted_2","_toDisplayString","displayName","_hoisted_4","for_year","_ctx","end","uuid","_component_router_link","to","name","params","props","group","type","Object","required","showGroupName","Boolean","default","data","annualReview","loading","computed","window","this","isPending","completed_at","now","Date","console","log","endDate","parse","addDays","watch","immediate","handler","getAnnualUpdate","methods","expert_panel","definition_is_approved","api","get","headers","then","response","__exports__","render","$setup","person","_TransitionGroup","tag","_Fragment","_renderList","notification","_component_notification_item","key","onRemoved","task","_component_sustained_curation_review_alert","assignee","_component_annual_update_alert","show-group-name","membershipsWithPendingCois","membership","_component_coi_alert","_component_tabs_container","_component_tab_item","label","length","_component_data_table","fields","sort","$event","onRowClick","row-class","cell-status_name","_withCtx","value","_component_badge","color","_component_person_profile","_component_coi_list","components","CoiList","NotificationItem","PersonProfile","AnnualUpdateAlert","testInst","setup","store","useStore","router","useRouter","user","getters","personFromStore","Person","loadPersonInStore","commit","onMounted","loadingNotifications","ref","notifications","getNotifications","removeNotification","index","findIndex","item","splice","groups","memberships","map","m","filter","g","Group","coordinatingGroups","hasPermission","groupFields","sortable","String","resolveValue","status","configs","statuses","currentStepName","groupSort","field","desc","groupBadgeColor","Active","Applying","Retired","Removed","sustainedCurationReviews","getSustainedCurationReviewTasks","with","where","task_type_id","assignee_type","assignee_id","Set","cg","pending","queryString","queryStringFromParams","url","uniqueTasks","forEach","dispatch","navigateToGroup","push"],"mappings":"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","file":"js/chunk-6a9e53f7.30addf11.js","sourcesContent":["<template>\n    <static-alert :variant=\"variant\"  v-if=\"isPending && annualReview.id\">\n        <div class=\"flex space-x-2 items-center mb-3\">\n            <icon-review height=\"30\" width=\"30\"></icon-review>\n            <div>\n                <p>\n                    <span v-if=\"showGroupName\"><strong>{{group.displayName}}</strong> has</span>\n                    <span v-else>You have</span>\n                    an <strong>annual update for {{window.for_year}}</strong> due on <strong>{{formatDate(window.end)}}</strong>.\n                </p>\n                <router-link \n                    class=\"btn font-bold\" \n                    :to=\"{name: 'AnnualUpdate', params: {uuid: group.uuid}}\"\n                    v-if=\"group.uuid\"\n                >\n                    Complete the Annual Update\n                </router-link>\n            </div>\n        </div>\n    </static-alert>\n</template>\n<script>\nimport { api } from '@/http';\nexport default {\n    name: 'AnnualUpdateAlert',\n    props: {\n        group: {\n            type: Object,\n            required: true,\n        },\n        showGroupName: {\n            type: Boolean,\n            default: false\n        }\n    },\n    data() {\n        return {\n            annualReview: {},\n            loading: false\n        }\n    },\n    computed: {\n        window () {\n            return this.annualReview.window ? this.annualReview.window : {}\n        },\n\n        isPending() {\n            return !(this.annualReview.completed_at)\n        },\n        \n        variant () {\n            const now = new Date();\n            if (!this.window.end) {\n                console.log('no window.end');\n                return 'warning';\n            }\n            const endDate = new Date(Date.parse(this.window.end));\n\n            return now > this.addDays(endDate, -7) ? 'danger' : 'warning';\n        }\n    },\n    watch: {\n        group: {\n            immediate: true,\n            handler () {\n                this.getAnnualUpdate();\n            }\n        }\n    },\n    methods: {\n        getAnnualUpdate () {\n            if (!this.group.uuid) {\n                return;\n            }\n\n            if (!this.group.expert_panel.definition_is_approved) {\n                return;\n            }\n\n            this.loading = true;\n            api.get(`/api/groups/${this.group.uuid}/expert-panel/annual-updates`, {headers: {'X-Ignore-Missing': 1} })\n                .then(response => {\n                    this.annualReview = response.data\n                });\n            this.loading = false;\n        }\n    }\n}\n</script>","import { render } from \"./AnnualUpdateAlert.vue?vue&type=template&id=e6294adc\"\nimport script from \"./AnnualUpdateAlert.vue?vue&type=script&lang=js\"\nexport * from \"./AnnualUpdateAlert.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/yugen/code/epam/resources/app/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\n    <div>\n        <h1>\n            Dashboard\n            <div class=\"note font-normal\">\n                User ID: {{user.id}}\n                |\n                Person ID: {{user.person ? user.person.id : 'no person!!'}}\n            </div>\n        </h1>\n        <transition-group tag=\"div\" name=\"slide-fade-down\">\n            <notification-item \n                v-for=\"notification in notifications\" :key=\"notification.id\"\n                :notification=\"notification\"\n                class=\"mb-2\"\n                @removed=\"removeNotification(notification)\"\n            ></notification-item>\n        </transition-group>\n\n        <sustained-curation-review-alert\n            v-for=\"task in sustainedCurationReviews\" \n            :key=\"task.id\"\n            :group=\"task.assignee\"\n            class=\"mb-2\"\n        />\n\n        <annual-update-alert \n            v-for=\"group in coordinatingGroups\" :key=\"group.id\" \n            :group=\"group\"\n            :show-group-name=\"true\"\n            class=\"mb-2\"\n        />\n\n        <coi-alert\n            v-for=\"membership in user.person.membershipsWithPendingCois\" \n            :key=\"membership.id\"\n            :membership=\"membership\"\n            class=\"mb-2\"\n        />\n\n        <tabs-container class=\"mt-8\">\n            <tab-item label=\"Your Groups\">\n                <div class=\"well\" v-if=\"!groups.length\">You are not assigned to any groups.</div>\n                <data-table\n                    v-else\n                    :data=\"groups\"\n                    :fields=\"groupFields\"\n                    v-model:sort=\"groupSort\"\n                    @rowClick=\"navigateToGroup\"\n                    row-class=\"cursor-pointer\"\n                >\n                    <template v-slot:cell-status_name=\"{value}\">\n                        <badge :color=\"groupBadgeColor(value)\">{{value}}</badge>\n                    </template>\n                </data-table>\n            </tab-item>\n\n            <tab-item label=\"Your Info\">\n                <person-profile :person=\"personFromStore\"></person-profile>\n            </tab-item>\n\n            <tab-item label=\"COIs\">\n                <coi-list :person=\"user.person\"></coi-list>\n            </tab-item>\n\n        </tabs-container>\n    </div>\n</template>\n<script>\nimport {useStore} from 'vuex'\nimport {useRouter} from 'vue-router'\nimport {ref, computed, onMounted, watch} from 'vue'\nimport {api, queryStringFromParams} from '@/http'\nimport AnnualUpdateAlert from '@/components/groups/AnnualUpdateAlert';\nimport NotificationItem from '@/components/NotificationItem'\nimport CoiList from '@/components/people/CoiList'\nimport PersonProfile from '@/components/people/PersonProfile'\nimport Person from \"@/domain/person\"\nimport Group from \"@/domain/group\"\nimport configs from '@/configs'\n\nexport default {\n    name: 'Dashboard',\n    components: {\n        CoiList,\n        NotificationItem,\n        PersonProfile,\n        AnnualUpdateAlert\n    },\n    data() {\n        return {\n            testInst: null\n        }\n    },\n    props: {\n        \n    },\n    setup () {\n        const store = useStore();\n        const router = useRouter();\n        const user = computed(() => {\n            return store.getters['currentUser']\n        });\n        const personFromStore = computed(() => {\n            return store.getters['people/currentItem'] || new Person();\n        })\n        const loadPersonInStore = () => {\n            if (user.value.id && user.value.person && user.value.person.id) {\n                store.commit('people/addItem', user.value.person);\n                store.commit('people/setCurrentItemIndex', user.value.person);\n            }\n        }\n        watch(() => user, () => {\n            loadPersonInStore();\n        });\n        onMounted(() => {\n            loadPersonInStore();\n        });\n\n        // NOTIFICATIONS\n        // TODO: Extract to modules\n        const loadingNotifications = ref(false);\n        const notifications = ref([]);\n        const getNotifications = async () => {\n            loadingNotifications.value = true;\n            notifications.value = await api.get(`/api/people/${user.value.person.uuid}/notifications/unread`)\n                                .then(response => response.data)\n            loadingNotifications.value = false;\n        }\n        const removeNotification = (notification) => {\n            const index = notifications.value.findIndex((item) => item.id == notification.id);\n            if (index > -1) {\n                notifications.value.splice(index, 1);\n            }\n        }\n\n\n        // GROUPS\n        // TODO: Get groups by search with TONS of info.\n        // TODO: Extract that work to a module.\n        const groups = computed(() => {\n            return user.value.memberships\n                    .map(m => m.group)\n                    .filter(g => g !== null)\n                    .map(group => new Group(group))\n        });\n\n        const coordinatingGroups = computed(() => {\n            return user.value.memberships\n                    .filter(m => m.hasPermission('annual-update-manage'))\n                    .map(m => m.group)\n                    .filter(g => g !== null)\n                    .map(group => new Group(group))\n        });\n\n        const groupFields = ref([\n            {\n                name: 'displayName',\n                sortable: true,\n                type: String\n            },\n            {\n                name: 'status.name',\n                label: 'Status',\n                sortable: true,\n                resolveValue: (item) => {\n                    if (item.status.id == configs.groups.statuses['applying'].id) {\n                        return item.status.name+' - '+item.expert_panel.currentStepName;\n                    }\n                    return item.status.name;\n                },\n                type: String\n            },\n        ]);\n        const groupSort = ref({\n            field: 'displayName',\n            desc: false\n        });\n        const groupBadgeColor = (status) => {\n            const map = {\n                Active: 'green',\n                Applying: 'blue',\n                Retired: 'yellow',\n                Removed: 'red'\n            }\n            return map[status] || 'blue'\n        };\n\n        const sustainedCurationReviews = ref([]);\n        const getSustainedCurationReviewTasks = async () => {\n            const params = {\n                with: ['assignee'],\n                where: {\n                    task_type_id: 1,\n                    assignee_type: 'App\\\\Modules\\\\Group\\\\Models\\\\Group',\n                    assignee_id: [...(new Set(coordinatingGroups.value.map(cg => cg.id)))],\n                    pending: 1\n                }\n            }\n            const queryString = queryStringFromParams(params);\n            const url = `/api/tasks${queryString}`;\n            sustainedCurationReviews.value = await api.get(url)\n                                                .then(response => {\n                                                    const uniqueTasks = {};\n                                                    response.data.forEach(task => {\n                                                        uniqueTasks[task.assignee_id] = task;\n                                                    })\n                                                    return uniqueTasks;\n                                                });\n        }\n\n        // TODO: extract to module.\n        // TODO: Get coi data on demand\n\n        onMounted(async () => {\n            getNotifications();\n            await store.dispatch('forceGetCurrentUser');\n            await getSustainedCurationReviewTasks();\n        })\n\n        return {\n            user,\n            sustainedCurationReviews,\n            personFromStore,\n            loadingNotifications,\n            notifications,\n            groups,\n            coordinatingGroups,\n            groupSort,\n            groupFields,\n            groupBadgeColor,\n            getNotifications,\n            removeNotification,\n            navigateToGroup: (item) => {\n                router.push({\n                    name: 'GroupDetail',\n                    params: {uuid: item.uuid}\n                })\n            }\n        }\n        \n    }\n}\n</script>","import { render } from \"./Dashboard.vue?vue&type=template&id=abcc5620\"\nimport script from \"./Dashboard.vue?vue&type=script&lang=js\"\nexport * from \"./Dashboard.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/yugen/code/epam/resources/app/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}