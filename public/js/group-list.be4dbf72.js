"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[23],{3774:function(e,t,a){a.d(t,{R0:function(){return i}});var r=a(2262),s=a(9700),o=a(812);const i=(0,r.iH)({}),l=(0,r.iH)(!1),u=()=>{l.value=!1,i.value={}},n=async({method:e,url:t,data:a})=>{try{return await(0,o.Z)({method:e,url:t,data:a}).then((e=>e.data.data))}catch(r){(0,s.Z)(r)&&(i.value={...i,...r.response.data.errors})}},p=()=>{i.value={}};t["ZP"]=()=>({errors:i,editing:l,hideForm:u,submitFormData:n,resetErrors:p})},1211:function(e,t,a){a.d(t,{Z:function(){return C}});var r=a(6252),s=a(3577),o=a(9963);const i={key:0},l={key:0},u=(0,r.Uk)(" Affiliation ID "),n=(0,r.Uk)("admin-only"),p={key:0},d={key:1,class:"text-gray-400"},m={key:1},g={key:2},h=(0,r.Uk)(" Status: "),c=(0,r.Uk)("admin-only"),_=(0,r.Uk)(" Parent group: "),f=(0,r.Uk)("admin-only");function y(e,t,a,y,w,b){const D=(0,r.up)("input-row"),v=(0,r.up)("dictionary-row"),k=(0,r.up)("note");return(0,r.wg)(),(0,r.iD)("div",null,[b.canSetType?((0,r.wg)(),(0,r.j4)(D,{key:0,modelValue:b.group.group_type_id,"onUpdate:modelValue":t[0]||(t[0]=e=>b.group.group_type_id=e),errors:y.errors.group_type_id,type:"select",options:b.typeOptions,label:"Type"},null,8,["modelValue","errors","options"])):((0,r.wg)(),(0,r.j4)(v,{key:1,label:"Type"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(b.typeDisplayName),1)])),_:1})),(0,r.Wm)(o.uT,{name:"slide-fade-down",mode:"out-in"},{default:(0,r.w5)((()=>[b.group.group_type_id>2&&b.group.expert_panel?((0,r.wg)(),(0,r.iD)("div",i,[(0,r.Wm)(D,{label:"Long Base Name",modelValue:b.group.expert_panel.long_base_name,"onUpdate:modelValue":[t[1]||(t[1]=e=>b.group.expert_panel.long_base_name=e),b.emitUpdate],placeholder:"Long base name",errors:y.errors.long_base_name,"input-class":"w-full"},null,8,["modelValue","onUpdate:modelValue","errors"]),(0,r.Wm)(D,{label:"Short Base Name",modelValue:b.group.expert_panel.short_base_name,"onUpdate:modelValue":[t[2]||(t[2]=e=>b.group.expert_panel.short_base_name=e),b.emitUpdate],placeholder:"Short base name",errors:y.errors.short_base_name,"input-class":"w-full"},null,8,["modelValue","onUpdate:modelValue","errors"]),e.hasAnyPermission(["groups-manage"])?((0,r.wg)(),(0,r.iD)("div",l,[(0,r.Wm)(D,{label:"Affiliation ID",modelValue:b.group.expert_panel.affiliation_id,"onUpdate:modelValue":[t[3]||(t[3]=e=>b.group.expert_panel.affiliation_id=e),b.emitUpdate],placeholder:b.affiliationIdPlaceholder,errors:y.errors.affiliation_id,"input-class":"w-full"},{label:(0,r.w5)((()=>[u,(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[n])),_:1})])),_:1},8,["modelValue","placeholder","errors","onUpdate:modelValue"])])):((0,r.wg)(),(0,r.j4)(v,{key:1,label:"Affiliation ID"},{default:(0,r.w5)((()=>[b.group.expert_panel.affiliation_id?((0,r.wg)(),(0,r.iD)("span",p,(0,s.zw)(b.group.expert_panel.affiliation_id),1)):((0,r.wg)(),(0,r.iD)("span",d,(0,s.zw)("Not yet assigend")))])),_:1}))])):((0,r.wg)(),(0,r.iD)("div",m,[(0,r.Wm)(D,{modelValue:b.group.name,"onUpdate:modelValue":[t[4]||(t[4]=e=>b.group.name=e),b.emitUpdate],placeholder:"Name",label:"Name","input-class":"w-full",errors:y.errors.name},null,8,["modelValue","errors","onUpdate:modelValue"])]))])),_:1}),e.hasPermission("groups-manage")?((0,r.wg)(),(0,r.iD)("div",g,[(0,r.Wm)(D,{modelValue:b.group.group_status_id,"onUpdate:modelValue":[t[5]||(t[5]=e=>b.group.group_status_id=e),b.emitUpdate],type:"select",options:b.statusOptions,errors:y.errors.group_status_id},{label:(0,r.w5)((()=>[h,(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[c])),_:1})])),_:1},8,["modelValue","options","errors","onUpdate:modelValue"]),(0,r.Wm)(D,{modelValue:b.group.parent_id,"onUpdate:modelValue":[t[6]||(t[6]=e=>b.group.parent_id=e),b.emitUpdate],type:"select",options:b.parentOptions,errors:y.errors.parent_id},{label:(0,r.w5)((()=>[_,(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[f])),_:1})])),_:1},8,["modelValue","options","errors","onUpdate:modelValue"])])):(0,r.kq)("",!0)])}var w=a(6486),b=a(9028),D=a(7506),v=a(3823),k=a(3774),x={name:"GroupForm",emits:["canceled","saved","update"],data(){return{groupTypes:[{id:1,fullname:"Working Group"},{id:2,fullname:"Clinical Domain Working Group"},{id:3,fullname:"GCEP"},{id:4,fullname:"VCEP"}],groupStatuses:v.groups.statuses,newGroup:new D.Z,parents:[]}},computed:{group:{get(){const e=this.$store.getters["groups/currentItem"];return e||this.newGroup},set(e){try{this.$store.commit("groups/addItem",e)}catch(t){this.newGroup=e}}},statusOptions(){return Object.values(this.groupStatuses).map((e=>({value:e.id,label:this.titleCase(e.name)})))},typeOptions(){return this.groupTypes.map((e=>({value:e.id,label:e.fullname})))},canSetType(){return this.hasPermission("groups-manage")&&!this.group.id},typeDisplayName(){return this.group.type?this.group.type.name?this.group.type.id<3?this.group.type.name.toUpperCase():this.group.expert_panel.type.name.toUpperCase():null:"🐇🥚"},affiliationIdPlaceholder(){return 5e4},cdwgs(){return this.$store.getters["cdwgs/all"]},namesDirty(){return this.group.expert_panel.isDirty("long_base_name")||this.group.expert_panel.isDirty("short_base_name")},affiliationIdDirty(){return this.group.expert_panel.isDirty("affiliation_id")},parentOptions(){const e=[{value:0,label:"None"}];return this.parents.filter((e=>e.type.can_be_parent)).forEach((t=>{e.push({value:t.id,label:t.displayName})})),(0,w.sortBy)(e,"label")}},methods:{async save(){this.resetErrors();try{if(this.group.id)return await this.updateGroup(),void this.$emit("saved");const e=await this.createGroup().then((e=>e.data.data));this.$emit("saved"),this.$store.commit("pushSuccess","Group created."),this.$router.push({name:"AddMember",params:{uuid:e.uuid}})}catch(e){throw(0,b.z1)(e)&&(this.errors=e.response.data.errors),e}},createGroup(){let{name:e,parent_id:t,group_type_id:a,group_status_id:r}=this.group.attributes;const{short_base_name:s}=this.group.expert_panel;return null===e&&this.group.expert_panel&&(e=this.group.expert_panel.long_base_name),this.$store.dispatch("groups/create",{name:e,parent_id:t,group_type_id:a,group_status_id:r,short_base_name:s})},updateGroup(){const e=[];return e.push(this.saveGroupData()),this.group.expert_panel&&e.push(this.saveEpData()),Promise.all(e)},saveGroupData(){const e=[];return this.group.isDirty("parent_id")&&e.push(this.saveParent()),this.group.isDirty("name")&&e.push(this.saveName()),this.group.isDirty("group_status_id")&&e.push(this.saveStatus()),Promise.all(e)},async saveEpData(){const e=[];if(this.namesDirty){const{long_base_name:t,short_base_name:a}=this.group.expert_panel;e.push(this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/expert-panel/name`,data:{long_base_name:t,short_base_name:a}}))}return this.affiliationIdDirty&&e.push(this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/expert-panel/affiliation-id`,data:{affiliation_id:this.group.expert_panel.affiliation_id}})),await Promise.all(e)},isDirty(e){return this.group[e]!=this.group[e]},saveParent(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/parent`,data:{parent_id:this.group.parent_id}})},saveName(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/name`,data:{name:this.group.name}})},saveStatus(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/status`,data:{status_id:this.group.group_status_id}})},resetData(){this.group.uuid&&this.$store.dispatch("groups/find",this.group.uuid)},cancel(){this.group.uuid&&this.resetData(),this.$emit("canceled")},async getParentOptions(){const e={"where[group_type_id]":[1,2],without:["coordinators","expertPanel"]};this.parents=await b.hi.get("/api/groups",{params:e}).then((e=>e.data.filter((e=>e.id!=this.group.id)).map((e=>new D.Z(e)))))},emitUpdate(){this.$emit("update")}},beforeMount(){this.getParentOptions(),this.$store.dispatch("cdwgs/getAll")},setup(e,t){const{errors:a,submitFormData:r,resetErrors:s}=(0,k.ZP)(e,t);return{errors:a,submitFormData:r,resetErrors:s}}},U=a(3744);const V=(0,U.Z)(x,[["render",y]]);var C=V},9350:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var r=a(6252),s=a(9963),o=a(3577);const i={class:"flex justify-between items-center"},l=(0,r.Uk)(" Groups "),u={key:0,class:"text-center w-full"},n={key:1},p={class:"mb-2"},d=(0,r.Uk)(" Filter: "),m={key:0},g={key:0},h={key:0};function c(e,t,a,c,_,f){const y=(0,r.up)("badge"),w=(0,r.up)("router-link"),b=(0,r.up)("data-table"),D=(0,r.up)("tab-item"),v=(0,r.up)("tabs-container"),k=(0,r.up)("group-form"),x=(0,r.up)("submission-wrapper"),U=(0,r.up)("modal-dialog"),V=(0,r.Q2)("remaining-height");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("h1",i,[l,e.hasPermission("groups-manage")?((0,r.wg)(),(0,r.iD)("button",{key:0,class:"btn btn-xs",onClick:t[0]||(t[0]=(...e)=>f.startCreateGroup&&f.startCreateGroup(...e))},"Create a group")):(0,r.kq)("",!0)]),(0,r.Wm)(v,{onTabChanged:f.getGroupsForType},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(c.tabDefinitions,(e=>((0,r.wg)(),(0,r.j4)(D,{label:e.label,key:e.label},{default:(0,r.w5)((()=>[_.loading?((0,r.wg)(),(0,r.iD)("div",u,"Loading...")):((0,r.wg)(),(0,r.iD)("div",n,[(0,r._)("div",p,[d,(0,r.wy)((0,r._)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>c.filterString=e),placeholder:"name,id,status,coordinator name"},null,512),[[s.nr,c.filterString]])]),(0,r.wy)(((0,r.wg)(),(0,r.j4)(b,{data:c.filteredGroups.filter(e.filter),fields:_.fields,sort:_.sort,"onUpdate:sort":t[3]||(t[3]=e=>_.sort=e),"row-click-handler":c.goToGroup,"row-class":"cursor-pointer active:bg-blue-100"},{"cell-displayStatus":(0,r.w5)((({item:e})=>[(0,r.Wm)(y,{class:"text-xs",color:e.statusColor},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.displayStatus),1),1==e.status.id&&e.isEp()?((0,r.wg)(),(0,r.iD)("span",m," - "+(0,o.zw)(e.expert_panel.currentStepAbbr),1)):(0,r.kq)("",!0)])),_:2},1032,["color"])])),"cell-coordinators":(0,r.w5)((({value:e})=>[0==e.length?((0,r.wg)(),(0,r.iD)("div",g)):(0,r.kq)("",!0),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e,((e,a)=>((0,r.wg)(),(0,r.iD)("span",{key:e.id},[a>0?((0,r.wg)(),(0,r.iD)("span",h,", ")):(0,r.kq)("",!0),(0,r.Wm)(w,{to:{name:"PersonDetail",params:{uuid:e.person.uuid}},class:"link",onClick:t[2]||(t[2]=(0,s.iM)((()=>{}),["stop"]))},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.person.name),1)])),_:2},1032,["to"])])))),128))])),_:2},1032,["data","fields","sort","row-click-handler"])),[[V]])]))])),_:2},1032,["label"])))),128))])),_:1},8,["onTabChanged"]),(0,r.Wm)(U,{modelValue:_.showCreateForm,"onUpdate:modelValue":t[8]||(t[8]=e=>_.showCreateForm=e),title:"Create a New Group",size:"sm"},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{onSubmitted:t[6]||(t[6]=t=>e.$refs.groupForm.save()),onCanceled:t[7]||(t[7]=t=>e.$refs.groupForm.cancel())},{default:(0,r.w5)((()=>[(0,r.Wm)(k,{ref:"groupForm",onCanceled:t[4]||(t[4]=e=>_.showCreateForm=!1),onSaved:t[5]||(t[5]=e=>_.showCreateForm=!1)},null,512)])),_:1})])),_:1},8,["modelValue"])])}var _=a(3907),f=a(2119),y=a(2262),w=a(1211),b=a(3117),D={name:"ComponentName",components:{GroupForm:w.Z,SubmissionWrapper:b.Z},props:{},data(){return{loading:!1,showCreateForm:!1,loadedFor:{VCEPs:!1,GCEPs:!1,CDWGs:!1,WGs:!1},sort:{field:"id",desc:!1},fields:[{name:"id",label:"ID",sortable:!0},{name:"name",label:"Name",sortable:!0,resolveValue:e=>e.displayName},{name:"coordinators",sortable:!1},{name:"displayStatus",sortable:!0,label:"status"}]}},methods:{startCreateGroup(){this.showCreateForm=!0},async getGroupsForType(e){const t=this.tabDefinitions.find((t=>t.label===e));this.loadedFor[e]||(this.loading=!0,await this.$store.dispatch("groups/getItems",{where:{group_type_id:t.typeId}}),this.loadedFor[e]=!0,this.loading=!1)}},setup(){const e=(0,_.oR)(),t=(0,f.tv)(),a=(0,r.Fl)((()=>{const e=[{label:"VCEPs",typeId:4,filter:e=>e.isVcep()},{label:"GCEPs",typeId:3,filter:e=>e.isGcep()},{label:"CDWGs",typeId:2,filter:e=>e.isCdwg()},{label:"WGs",typeId:1,filter:e=>e.isWg()}];return e})),s=(0,y.iH)(null),o=(0,r.Fl)((()=>e.getters["groups/all"])),i=(0,r.Fl)((()=>o.value.filter((e=>{if(!s.value)return!0;const t=new RegExp(`.*${s.value}.*`,"i");return e.name&&e.name.match(t)||e.displayName&&e.displayName.match(t)||e.expert_panel&&e.expert_panel.full_short_base_name&&e.expert_panel.full_short_base_name.match(t)||e.id==s.value||e.status.name.match(t)||e.expert_panel&&e.expert_panel.currentStepName&&e.expert_panel.currentStepName.match(t)||e.coordinators.filter((e=>e.person.name.match(t))).length>0})))),l=e=>{t.push({name:"GroupDetail",params:{uuid:e.uuid}})};return{filterString:s,groups:o,filteredGroups:i,tabDefinitions:a,goToItem:l,goToGroup:l}}},v=a(3744);const k=(0,v.Z)(D,[["render",c]]);var x=k}}]);
//# sourceMappingURL=group-list.be4dbf72.js.map