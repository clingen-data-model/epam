"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[336],{4582:function(e,t,o){o.d(t,{A:function(){return i}});o(3725),o(5019);var l=o(6166),n=o(641);function i(e=null){const t=(0,l.rd)(),o=(0,l.lq)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const i=(0,n.EW)({immediate:!0,get(){return Object.keys(o.query).includes("sort-field")?{field:o.query["sort-field"],desc:Boolean(parseInt(o.query["sort-desc"]))}:e},set(e){const l={"sort-field":e.field,"sort-desc":e.desc?1:0},n={...o.query,...l};t.replace({path:o.path,query:n})}}),r=(0,n.EW)({set(e){let l=o.query,n=o.path,i={...l};e?i={...l,filter:e}:delete i.filter,t.replace({path:n,query:i})},get(){return o.query.filter},immediate:!0});return{sort:i,filter:r}}},6375:function(e,t,o){o.r(t),o.d(t,{default:function(){return P}});o(3725),o(5019);var l=o(641),n=o(3751),i=o(33);const r=(0,l.Lk)("h1",null,"Credentials",-1),a=(0,l.eW)(" Filter: "),s=(0,l.Lk)("button",{class:"btn btn-xs"},"â€¦",-1),d=(0,l.eW)("Edit"),u=(0,l.eW)("Approve"),c=(0,l.eW)("Merge into another"),m=(0,l.eW)("Delete"),h={key:0},p=(0,l.Lk)("p",null,"You cannot delete an credential people are using.",-1),b=(0,l.Lk)("p",null,"Either edit this this credential or merge it into another.",-1),g=[p,b],v={key:1};function f(e,t,o,p,b,f){const I=(0,l.g2)("dropdown-item"),y=(0,l.g2)("dropdown-menu"),w=(0,l.g2)("data-table"),k=(0,l.g2)("CredentialsApprovalForm"),C=(0,l.g2)("modal-dialog"),V=(0,l.g2)("CredentialUpdateForm"),F=(0,l.g2)("CredentialMergeForm"),A=(0,l.g2)("button-row");return(0,l.uX)(),(0,l.CE)("div",null,[r,(0,l.bF)(w,{paginated:"",data:f.filteredItems,fields:b.fields,sort:p.sort,"onUpdate:sort":t[1]||(t[1]=e=>p.sort=e),"reset-page-on-data-change":!1},{header:(0,l.k6)((()=>[(0,l.Lk)("label",null,[a,(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>p.filter=e)},null,512),[[n.Jo,p.filter]])])])),"cell-actions":(0,l.k6)((({item:e})=>[(0,l.bF)(y,{"hide-cheveron":""},{label:(0,l.k6)((()=>[s])),default:(0,l.k6)((()=>[(0,l.bF)(I,{onClick:t=>f.edit(e)},{default:(0,l.k6)((()=>[d])),_:2},1032,["onClick"]),e.approved?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(I,{key:0,onClick:t=>f.initApprove(e)},{default:(0,l.k6)((()=>[u])),_:2},1032,["onClick"])),(0,l.bF)(I,{onClick:t=>f.initMerge(e)},{default:(0,l.k6)((()=>[c])),_:2},1032,["onClick"]),(0,l.bF)(I,{onClick:t=>f.initDelete(e)},{default:(0,l.k6)((()=>[m])),_:2},1032,["onClick"])])),_:2},1024)])),_:1},8,["data","fields","sort"]),((0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[(0,l.bF)(C,{modelValue:b.showApproveDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>b.showApproveDialog=e),title:`Approve ${b.currentItem.name}`},{default:(0,l.k6)((()=>[(0,l.bF)(k,{modelValue:b.currentItem,"onUpdate:modelValue":t[2]||(t[2]=e=>b.currentItem=e),onSaved:f.handleSaved,onCanceled:f.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,l.bF)(C,{modelValue:b.showEditDialog,"onUpdate:modelValue":t[5]||(t[5]=e=>b.showEditDialog=e),title:`Edit ${b.currentItem.name}`},{default:(0,l.k6)((()=>[(0,l.bF)(V,{modelValue:b.currentItem,"onUpdate:modelValue":t[4]||(t[4]=e=>b.currentItem=e),onSaved:f.handleSaved,onCanceled:f.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,l.bF)(C,{modelValue:b.showMergeDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>b.showMergeDialog=e),title:"Merge Credentials"},{default:(0,l.k6)((()=>[b.currentItem.id?((0,l.uX)(),(0,l.Wv)(F,{key:0,obsoletes:b.currentItem,credentials:f.items,onSaved:f.handleMerge,onCanceled:t[6]||(t[6]=e=>b.showMergeDialog=!1)},null,8,["obsoletes","credentials","onSaved"])):(0,l.Q3)("",!0)])),_:1},8,["modelValue"]),(0,l.bF)(C,{modelValue:b.showDeleteConfirmation,"onUpdate:modelValue":t[9]||(t[9]=e=>b.showDeleteConfirmation=e),title:"Delete Credential",size:"sm"},{default:(0,l.k6)((()=>[b.currentItem.people_count>0?((0,l.uX)(),(0,l.CE)("div",h,g)):((0,l.uX)(),(0,l.CE)("div",v,[(0,l.eW)(" You are about to delete the "+(0,i.v_)(b.currentItem.name)+" ",1),(0,l.bF)(A,{"submit-text":"Delete",onSubmitted:f.deleteItem,onCanceled:t[8]||(t[8]=e=>b.showDeleteConfirmation=!1)},null,8,["onSubmitted"])]))])),_:1},8,["modelValue"])]))])}var I=o(4582);function y(e,t,o,n,i,r){const a=(0,l.g2)("input-row"),s=(0,l.g2)("button-row");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(a,{label:"Name",modelValue:n.workingCopy.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.workingCopy.name=e),errors:i.errors.name},null,8,["modelValue","errors"]),(0,l.bF)(s,{"submit-text":"Save",onSubmitted:r.save,onCancel:r.cancel},null,8,["onSubmitted","onCancel"])])}var w=o(5169),k=o(696),C={name:"InstitutionCreateForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","saved","canceled"],data(){return{errors:{}}},methods:{async save(){try{this.initErrors(),console.log("save!");const e=await this.$store.dispatch("credentials/update",this.workingCopy).then((e=>e.data));console.log(e),this.$emit("update:modelValue",e),this.$emit("saved",e)}catch(e){(0,k.Ah)(e)&&(this.errors=e.response.data.errors)}},cancel(){this.$emit("canceled"),this.initInstitution()},initErrors(){this.errors={}}},setup(e,t){const{workingCopy:o}=(0,w.L5)(e,t);return{workingCopy:o}}},V=o(6262);const F=(0,V.A)(C,[["render",y]]);var A=F;const D=(0,l.eW)(" Are you sure you want to approve this institution? ");function S(e,t,o,n,r,a){const s=(0,l.g2)("dictionary-row"),d=(0,l.g2)("button-row");return(0,l.uX)(),(0,l.CE)("div",null,[D,(0,l.bF)(s,{label:"Name"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(o.modelValue.name),1)])),_:1}),(0,l.bF)(d,{"submit-text":"Approve",onSubmitted:a.approve,onCancel:a.cancelApproval},null,8,["onSubmitted","onCancel"])])}var _={name:"ComponentName",props:{modelValue:{type:Object,required:!0}},emits:["saved","canceled","update:modelValue"],methods:{async approve(){const e=await k.FH.put(`/api/credentials/${this.modelValue.id}`,{name:this.modelValue.name,approved:1}).then((e=>e.data));this.$emit("update:modelValue",e),this.$emit("saved",e)},cancelApproval(){this.$emit("canceled")}}};const M=(0,V.A)(_,[["render",S]]);var E=M;const W=(0,l.Lk)("p",{class:"mb-8"},[(0,l.eW)(" Merging credentials will do the following: "),(0,l.Lk)("ol",{class:"list-decimal ml-6"},[(0,l.Lk)("li",null,"Transfer all people with the obsolete credential to the authoritiative credential."),(0,l.Lk)("li",null,"Delete the obsolete credential.")])],-1),$=(0,l.eW)(" Merge "),U=(0,l.eW)("(Obsolete credential that will be deleted)"),O=(0,l.eW)("Into "),x=(0,l.eW)("(Authoritative credential)");function L(e,t,o,n,i,r){const a=(0,l.g2)("note"),s=(0,l.g2)("SearchSelect"),d=(0,l.g2)("input-row"),u=(0,l.g2)("button-row");return(0,l.uX)(),(0,l.CE)("div",null,[W,(0,l.bF)(d,{label:"Merge",vertical:""},{label:(0,l.k6)((()=>[$,(0,l.bF)(a,{class:"inline-block"},{default:(0,l.k6)((()=>[U])),_:1})])),default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:i.selectedObsolete,"onUpdate:modelValue":t[0]||(t[0]=e=>i.selectedObsolete=e),options:o.credentials,showOptionsOnFocus:!0,keyBy:"id"},null,8,["modelValue","options"])])),_:1}),(0,l.bF)(d,{label:"Into",errors:i.errors.authority_id,vertical:""},{label:(0,l.k6)((()=>[O,(0,l.bF)(a,{class:"inline"},{default:(0,l.k6)((()=>[x])),_:1})])),default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:i.selectedAuthority,"onUpdate:modelValue":t[1]||(t[1]=e=>i.selectedAuthority=e),options:o.credentials,showOptionsOnFocus:!0,keyBy:"id"},null,8,["modelValue","options"])])),_:1},8,["errors"]),(0,l.bF)(u,{"submit-text":"Merge",onSubmitted:r.commitMerge,onCanceled:r.cancelMerge},null,8,["onSubmitted","onCanceled"])])}var X=o(915),q={name:"CredentialMergeForm",components:{SearchSelect:X["default"]},props:{obsoletes:{type:Array,default:()=>[]},credentials:{type:Array,default:()=>[]}},emits:["saved","canceled"],data(){return{selectedAuthority:null,selectedObsolete:null,errors:{}}},watch:{authority:{immediate:!0,handler(e){e&&(this.authorityId=e.id)}},obsoletes:{immediate:!0,deep:!0,handler(e){this.handleObsoleteUpdate(e)}}},methods:{handleObsoleteUpdate(e){this.selectedObsolete=e},async commitMerge(){if(console.log("committing merge",this.selectedAuthority,this.selectedObsolete),this.selectedAuthority&&this.selectedObsolete)try{this.errors={},await this.$store.dispatch("credentials/merge",{authority:this.selectedAuthority,obsolete:this.selectedObsolete}),this.selectedAuthority=null,this.selectedObsolete=null,this.$emit("saved")}catch(e){(0,k.Ah)(e)&&(this.errors=e.response.data.errors)}},cancelMerge(){this.authorityId=null,this.obsoleteIds=[],this.$emit("canceled")}}};const N=(0,V.A)(q,[["render",L]]);var j=N,Y={name:"CredentialList",components:{CredentialUpdateForm:A,CredentialsApprovalForm:E,CredentialMergeForm:j},data(){return{fields:[{name:"id",label:"ID",type:Number,sortable:!0,class:"w-12"},{name:"name",type:String,sortable:!0},{name:"people_count",label:"# People",type:Number,sortable:!0},{name:"approved",type:Boolean,sortable:!0,resolveValue(e){return e.approved?"Approved":null},resolveSort(e){return e.approved}},{name:"actions",label:"",sortable:!1}],currentItem:{},showApproveDialog:!1,showEditDialog:!1,showMergeDialog:!1,showDeleteConfirmation:!1}},computed:{items(){return this.$store.getters["credentials/items"]},filteredItems(){if(!this.filter)return this.items;const e=new RegExp(`.*${this.filter}.*`,"i");return this.items.filter((t=>t.name.match(e)||t.abbreviation&&t.abbreviation.match(e)||t.country&&t.country.name.match(e)))},currentIndex(){return this.items.findIndex((e=>e.id==this.currentItem.id))}},methods:{edit(e){this.showEditDialog=!0,this.currentItem=e},initApprove(e){this.showApproveDialog=!0,this.currentItem=e},initMerge(e){this.currentItem=e,this.showMergeDialog=!0},handleSaved(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.$store.commit("pushSuccess","Credential saved.")},handleCancel(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},handleMerge(){this.items.splice(this.currentIndex,1),this.showMergeDialog=!1,this.$store.commit("pushSuccess","Credential merged."),this.currentItem={}},updateItem(){this.currentItem.id&&this.currentIndex>-1&&(this.items[this.currentIndex]={...this.currentItem})},initDelete(e){this.showDeleteConfirmation=!0,this.currentItem=e},async deleteItem(){this.currentItem.id&&(this.currentItem.people_count>0&&alert("You cannot delete an credential because it is in use.  Please edit the credential or merge it into another."),await this.$store.dispatch("credentials/delete",this.currentItem),this.showDeleteConfirmation=!1,this.$store.commit("pushSuccess",`${this.currentItem.name} deleted.`))}},setup(){const{sort:e,filter:t}=(0,I.A)({field:"name",desc:!1});return{sort:e,filter:t}},mounted(){this.$store.dispatch("credentials/getItems")}};const B=(0,V.A)(Y,[["render",f]]);var P=B},6164:function(e,t,o){o.r(t),o.d(t,{default:function(){return P}});o(3725),o(5019);var l=o(641),n=o(3751),i=o(33);const r=(0,l.Lk)("h1",null,"Institutions",-1),a=(0,l.eW)(" Filter: "),s=(0,l.Lk)("button",{class:"btn btn-xs"},"â€¦",-1),d=(0,l.eW)("Edit"),u=(0,l.eW)("Approve"),c=(0,l.eW)("Merge into another"),m=(0,l.eW)("Delete"),h={key:0},p=(0,l.Lk)("p",null,"You cannot delete an institution people are using.",-1),b=(0,l.Lk)("p",null,"Either edit this this institution or merge it into another.",-1),g=[p,b],v={key:1};function f(e,t,o,p,b,f){const I=(0,l.g2)("dropdown-item"),y=(0,l.g2)("dropdown-menu"),w=(0,l.g2)("data-table"),k=(0,l.g2)("institution-approval-form"),C=(0,l.g2)("modal-dialog"),V=(0,l.g2)("institution-update-form"),F=(0,l.g2)("institution-merge-form"),A=(0,l.g2)("button-row");return(0,l.uX)(),(0,l.CE)("div",null,[r,(0,l.bF)(w,{paginated:"",data:f.filteredItems,fields:b.fields,sort:p.sort,"onUpdate:sort":t[1]||(t[1]=e=>p.sort=e),"reset-page-on-data-change":!1},{header:(0,l.k6)((()=>[(0,l.Lk)("label",null,[a,(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>p.filter=e)},null,512),[[n.Jo,p.filter]])])])),"cell-actions":(0,l.k6)((({item:e})=>[(0,l.bF)(y,{"hide-cheveron":""},{label:(0,l.k6)((()=>[s])),default:(0,l.k6)((()=>[(0,l.bF)(I,{onClick:t=>f.edit(e)},{default:(0,l.k6)((()=>[d])),_:2},1032,["onClick"]),(0,l.bF)(I,{onClick:t=>f.initApprove(e)},{default:(0,l.k6)((()=>[u])),_:2},1032,["onClick"]),(0,l.bF)(I,{onClick:t=>f.initMerge(e)},{default:(0,l.k6)((()=>[c])),_:2},1032,["onClick"]),(0,l.bF)(I,{onClick:t=>f.initDelete(e)},{default:(0,l.k6)((()=>[m])),_:2},1032,["onClick"])])),_:2},1024)])),_:1},8,["data","fields","sort"]),((0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[(0,l.bF)(C,{modelValue:b.showApproveDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>b.showApproveDialog=e),title:`Approve ${b.currentItem.name}`},{default:(0,l.k6)((()=>[(0,l.bF)(k,{modelValue:b.currentItem,"onUpdate:modelValue":t[2]||(t[2]=e=>b.currentItem=e),onSaved:f.handleSaved,onCanceled:f.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,l.bF)(C,{modelValue:b.showEditDialog,"onUpdate:modelValue":t[5]||(t[5]=e=>b.showEditDialog=e),title:`Edit ${b.currentItem.name}`},{default:(0,l.k6)((()=>[(0,l.bF)(V,{modelValue:b.currentItem,"onUpdate:modelValue":t[4]||(t[4]=e=>b.currentItem=e),onSaved:f.handleSaved,onCanceled:f.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,l.bF)(C,{modelValue:b.showMergeDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>b.showMergeDialog=e),title:"Merge Institutions"},{default:(0,l.k6)((()=>[(0,l.bF)(F,{obsoletes:[b.currentItem],onSaved:f.handleMerge,onCanceled:t[6]||(t[6]=e=>b.showMergeDialog=!1)},null,8,["obsoletes","onSaved"])])),_:1},8,["modelValue"]),(0,l.bF)(C,{modelValue:b.showDeleteConfirmation,"onUpdate:modelValue":t[9]||(t[9]=e=>b.showDeleteConfirmation=e),title:"Delete Institution",size:"sm"},{default:(0,l.k6)((()=>[b.currentItem.people_count>0?((0,l.uX)(),(0,l.CE)("div",h,g)):((0,l.uX)(),(0,l.CE)("div",v,[(0,l.eW)(" You are about to delete the "+(0,i.v_)(b.currentItem.name)+" ",1),(0,l.bF)(A,{"submit-text":"Delete",onSubmitted:f.deleteItem,onCanceled:t[8]||(t[8]=e=>b.showDeleteConfirmation=!1)},null,8,["onSubmitted"])]))])),_:1},8,["modelValue"])]))])}var I=o(4582),y=o(7158);const w=(0,l.eW)(" Are you sure you want to approve this institution? ");function k(e,t,o,n,r,a){const s=(0,l.g2)("dictionary-row"),d=(0,l.g2)("button-row");return(0,l.uX)(),(0,l.CE)("div",null,[w,(0,l.bF)(s,{label:"Name"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(o.modelValue.name),1)])),_:1}),(0,l.bF)(s,{label:"Abbreviation"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(o.modelValue.abbreviation||"--"),1)])),_:1}),(0,l.bF)(s,{label:"URL"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(o.modelValue.url||"--"),1)])),_:1}),(0,l.bF)(s,{label:"Country"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(o.modelValue.country?o.modelValue.country.name:"--"),1)])),_:1}),(0,l.bF)(s,{label:"Reportable"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(o.modelValue.reportable?"Yes":"No"),1)])),_:1}),(0,l.bF)(d,{"submit-text":"Approve",onSubmitted:a.approve,onCancel:a.cancelApproval},null,8,["onSubmitted","onCancel"])])}var C={name:"ComponentName",props:{modelValue:{type:Object,required:!0}},emits:["saved","canceled","update:modelValue"],methods:{async approve(){const e=await(0,y.Bd)(this.modelValue);this.$emit("update:modelValue",e),this.$emit("saved",e)},cancelApproval(){this.$emit("canceled")}}},V=o(6262);const F=(0,V.A)(C,[["render",k]]);var A=F;function D(e,t,o,n,i,r){const a=(0,l.g2)("data-form"),s=(0,l.g2)("button-row");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(a,{fields:n.fields,errors:i.errors,modelValue:n.workingCopy,"onUpdate:modelValue":t[0]||(t[0]=e=>n.workingCopy=e)},null,8,["fields","errors","modelValue"]),(0,l.bF)(s,{"submit-text":"Save",onSubmitted:r.save,onCancel:r.cancel},null,8,["onSubmitted","onCancel"])])}var S=o(5169),_=o(696),M={name:"InstitutionCreateForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","saved","canceled"],data(){return{errors:{}}},methods:{async save(){try{this.initErrors();const e=await this.updateInstitution(this.workingCopy);this.$emit("update:modelValue",e),this.$emit("saved",e)}catch(e){(0,_.Ah)(e)&&(this.errors=e.response.data.errors)}},cancel(){this.$emit("canceled"),this.initInstitution()},initErrors(){this.errors={}}},setup(e,t){const{workingCopy:o}=(0,S.L5)(e,t);return{fields:y.OA,getCountries:y.X6,countries:y.Xr,updateInstitution:y.i3,workingCopy:o}},mounted(){this.getCountries()}};const E=(0,V.A)(M,[["render",D]]);var W=E;const $=(0,l.Lk)("p",{class:"mb-8"},[(0,l.eW)(" Merging institutions will do the following: "),(0,l.Lk)("ol",{class:"list-decimal ml-6"},[(0,l.Lk)("li",null,"Transfer all people with the obsolete institution to the authoritiative institution."),(0,l.Lk)("li",null,"Delete the obsolete institution.")])],-1),U=(0,l.eW)(" Merge "),O=(0,l.eW)("(Obsolete institution that will be deleted)"),x=(0,l.eW)("Into "),L=(0,l.eW)("(Authoritative institution)");function X(e,t,o,n,i,r){const a=(0,l.g2)("note"),s=(0,l.g2)("institution-search-select"),d=(0,l.g2)("input-row"),u=(0,l.g2)("button-row");return(0,l.uX)(),(0,l.CE)("div",null,[$,(0,l.bF)(d,{label:"Merge",vertical:""},{label:(0,l.k6)((()=>[U,(0,l.bF)(a,{class:"inline-block"},{default:(0,l.k6)((()=>[O])),_:1})])),default:(0,l.k6)((()=>[(0,l.bF)(s,{"model-value":i.obsoleteIds,"onUpdate:modelValue":r.handleObsoleteUpdate,"allow-add":!1},null,8,["model-value","onUpdate:modelValue"])])),_:1}),(0,l.bF)(d,{label:"Into",errors:i.errors.authority_id,vertical:""},{label:(0,l.k6)((()=>[x,(0,l.bF)(a,{class:"inline"},{default:(0,l.k6)((()=>[L])),_:1})])),default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:i.authorityId,"onUpdate:modelValue":t[0]||(t[0]=e=>i.authorityId=e),"allow-add":!1},null,8,["modelValue"])])),_:1},8,["errors"]),(0,l.bF)(u,{"submit-text":"Merge",onSubmitted:r.commitMerge,onCanceled:r.cancelMerge},null,8,["onSubmitted","onCanceled"])])}o(1339);var q={name:"InstitutionMergeForm",props:{authority:{type:Object,required:!1},obsoletes:{type:Array,default:()=>[]}},emits:["saved","canceled"],data(){return{authorityId:null,obsoleteIds:[],errors:{}}},watch:{authority:{immediate:!0,handler(e){e&&(this.authorityId=e.id)}},obsoletes:{immediate:!0,deep:!0,handler(e){this.obsoleteIds=e.map((e=>e.id))}}},methods:{handleObsoleteUpdate(e){this.obsoleteIds=e?[e]:[]},async commitMerge(){try{this.errors={},await(0,y.m_)(this.authorityId,this.obsoleteIds),this.authorityId=null,this.obsoleteIds=[],this.$emit("saved")}catch(e){(0,_.Ah)(e)&&(this.errors=e.response.data.errors)}},cancelMerge(){this.authorityId=null,this.obsoleteIds=[],this.$emit("canceled")}}};const N=(0,V.A)(q,[["render",X]]);var j=N,Y={name:"InstitutionList",components:{InstitutionUpdateForm:W,InstitutionApprovalForm:A,InstitutionMergeForm:j},data(){return{items:[],fields:[{name:"id",label:"ID",type:Number,sortable:!0},{name:"name",type:String,sortable:!0},{name:"abbreviation",type:String,sortable:!0},{name:"country.name",label:"Country",type:String,sortable:!0},{name:"people_count",label:"# People",type:Number,sortable:!0},{name:"approved",type:Boolean,sortable:!0,resolveValue(e){return e.approved?"Approved":null},resolveSort(e){return e.approved}},{name:"actions",label:"",sortable:!1}],currentItem:{country:{}},showApproveDialog:!1,showEditDialog:!1,showMergeDialog:!1,showDeleteConfirmation:!1}},computed:{filteredItems(){if(!this.filter)return this.items;const e=new RegExp(`.*${this.filter}.*`,"i");return this.items.filter((t=>t.name.match(e)||t.abbreviation&&t.abbreviation.match(e)||t.country&&t.country.name.match(e)))},currentIndex(){return this.items.findIndex((e=>e.id==this.currentItem.id))}},methods:{edit(e){this.showEditDialog=!0,this.currentItem=e},initApprove(e){this.showApproveDialog=!0,this.currentItem=e},initMerge(e){this.currentItem=e,this.showMergeDialog=!0},async getInstitutions(){this.items=await(0,y.r7)()},handleSaved(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}},this.$store.commit("pushSuccess","Institution saved.")},handleCancel(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},handleMerge(){this.items.splice(this.currentIndex,1),this.showMergeDialog=!1,this.$store.commit("pushSuccess","Institution merged.")},updateItem(){this.currentItem.id&&this.currentIndex>-1&&(this.items[this.currentIndex]={...this.currentItem})},initDelete(e){this.showDeleteConfirmation=!0,this.currentItem=e},async deleteItem(){this.currentItem.id&&(this.currentItem.people_count>0&&alert("You cannot delete an institution because it is in use.  Pelaes edit the institution or merge it into another."),await(0,y.O0)(this.currentItem),this.items.splice(this.currentIndex,1),this.showDeleteConfirmation=!1,this.$store.commit("pushSuccess",`${this.currentItem.name} deleted.`))}},setup(){const{sort:e,filter:t}=(0,I.A)({field:"name",desc:!1});return{sort:e,filter:t}},mounted(){this.getInstitutions()}};const B=(0,V.A)(Y,[["render",f]]);var P=B}}]);
//# sourceMappingURL=institution-list.f8dd07f8.js.map