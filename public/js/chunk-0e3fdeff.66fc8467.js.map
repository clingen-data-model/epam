{"version":3,"sources":["webpack:///./src/http/is_validation_error.js","webpack:///./src/views/Coi.vue","webpack:///./src/survey.js","webpack:///./src/views/Coi.vue?de94"],"names":["error","response","status","data","errors","class","codeIsValid","title","verifying","coiTitle","saved","epName","$store","getters","isAuthed","redirectCountdown","$router","go","survey","questions","question","key","name","label","question_text","vertical","type","options","option","value","showQuestion","show-cancel","storeResponse","saving","Question","this","validationRules","validation","show","YesNoQuestion","makeQuestion","questionDef","Survey","surveyDefinition","_name","_questions","map","q","rsp","forEach","coi","props","code","required","String","coiDef","getResponseTemplate","computed","methods","Array","isArray","console","log","indexOf","verifyCode","api","get","then","dispatch","coiData","setInterval","setTimeout","is_validation_error","mounted","render"],"mappings":"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","file":"js/chunk-0e3fdeff.66fc8467.js","sourcesContent":["export default function (error) {\n    return error.response && error.response.status == 422 && error.response.data.errors\n}","<template>\n    <div>\n        <card :title=\"verifying ? `Loading COI Form` : `COI Form not found`\" v-if=\"!codeIsValid\">\n            <div v-if=\"!verifying\">We couldn't find this COI.</div>\n        </card>\n        <card :title=\"coiTitle\"  class=\"w-3/4 mx-auto relative\" v-if=\"codeIsValid\">\n            <div v-if=\"saved\">\n                Thanks for completing the conflict of interest form for {{epName}}!\n                <small v-if=\"$store.getters.isAuthed\">\n                    <p>You'll be redirected back in {{redirectCountdown}} seconds.</p>\n                    <button @click=\"$router.go(-1)\" class=\"text-blue-500\">Go back</button>\n                </small>\n            </div>\n            <div v-else class=\"relative\">\n                <div \n                    v-for=\"question in survey.questions\"\n                    :key=\"question.name\"\n                            :class=\"question.class\"\n                >\n                    <transition name=\"slide-fade-down\">\n                        <input-row\n                            :label=\"question.question_text\"\n                            :errors=\"errors[question.name]\"\n                            :vertical=\"true\"\n                            v-show=\"showQuestion(question)\"\n                        >\n                        \n                            <textarea  v-if=\"question.type == 'text'\"\n                                class=\"w-full h-24\"\n                                v-model=\"response[question.name]\"\n                                :name=\"question.name\"\n                            ></textarea>\n\n                            <div v-if=\"question.type == 'multiple-choice'\">\n                                <label v-for=\"option in question.options\" :key=\"option.value\" class=\"block\">\n                                    <input type=\"radio\" \n                                        :value=\"option.value\" \n                                        :name=\"question.name\"\n                                        v-model=\"response[question.name]\">\n                                    {{option.label}}\n                                </label>\n                            </div>\n\n                            <input \n                                type=\"text\" \n                                v-if=\"question.type == 'string'\"\n                                v-model=\"response[question.name]\"\n                                :name=\"question.name\"\n                            >\n                        </input-row>\n                    </transition>\n                </div>\n                <button-row :show-cancel=\"false\" @submitClicked=\"storeResponse()\">\n                    <slot v-if=\"saving\">\n                        Saving...\n                    </slot>\n                </button-row>\n            </div>\n        </card>\n    </div>\n</template>\n<script>\nimport coiDef from '../../../surveys/coi.json'\nimport Survey from '../survey'\nimport api from '../http/api'\nimport is_validation_error from '../http/is_validation_error';\n\nconst survey = new Survey(coiDef);\n\nexport default {\n    props: {\n        code: {\n            required: true,\n            type: String\n        }\n    },\n    data() {\n        return {\n            coiDef: coiDef,\n            survey: survey,\n            response: survey.getResponseTemplate(),\n            errors: {},\n            epName: null,\n            verifying: false,\n            saved: false,\n            saving: false,\n            redirectCountdown: 5\n        }\n    },\n    computed: {\n        codeIsValid() {\n            return this.epName !== null;\n        },\n        coiTitle() {\n            return survey.name+' for '+this.epName;\n        }\n    },\n    methods: {\n        showQuestion(question) {\n            if (!question.show) {\n                return true;\n            }\n            if (Array.isArray(question.show.value)) {\n                console.log(question.show.value);\n                return question.show.value.indexOf(this.response[question.show.name]) > -1;\n            }\n            return (this.response[question.show.name] == question.show.value);\n        },\n        verifyCode() {\n            this.verifying = true;\n            api.get(`/api/coi/${this.code}/application`)\n                .then(response => {\n                    this.epName = response.data.name\n\n                })\n                .then(() => {\n                    this.verifying = false;\n                })\n        },\n        async storeResponse() {\n            this.saving = true;\n            try {\n                await this.$store.dispatch('storeCoi', {code: this.code, coiData: this.response});\n                this.saved = true;\n                if (this.$store.getters.isAuthed) {\n                    setInterval(() => {this.redirectCountdown--}, 1000)\n                    setTimeout(() => {\n                        this.$router.go(-1)\n                    }, 5000)\n                }\n            } catch (error) {\n                if (is_validation_error(error)) {\n                    this.errors = error.response.data.errors\n                }\n            }\n            this.saving = false;\n        }\n    },\n    mounted() {\n        this.verifyCode();\n    }\n}\n</script>","class Question {\n    constructor(question) {\n        this.question_text = question.question;\n        this.name = question.name;\n        this.options = question.options;\n        this.validationRules = question.validation;\n        this.type = question.type;\n        this.show = question.show;\n        this.class = question.class;\n    }\n}\n\nclass YesNoQuestion extends Question {\n    constructor(question) {\n        super(question)\n        this.type = 'multiple-choice';\n        this.options = [{\n                label: 'Yes',\n                value: 1\n            },\n            {\n                label: 'No',\n                value: 0\n            }\n        ];\n    }\n\n\n}\n\nfunction makeQuestion(questionDef) {\n    if (questionDef.type == 'yes-no') {\n        return new YesNoQuestion(questionDef);\n    }\n\n    return new Question(questionDef);\n}\n\nclass Survey {\n    constructor(surveyDefinition) {\n        this._name = surveyDefinition.name;\n        this._questions = surveyDefinition.questions.map(q => makeQuestion(q));\n\n    }\n\n    get name() {\n        return this._name;\n    }\n\n    get questions() {\n        return this._questions\n    }\n\n    responseIsValid(response) {\n        response;\n        return true;\n    }\n\n    getResponseTemplate() {\n        const rsp = {};\n        this.questions.forEach(q => {\n            rsp[q.name] = null\n        });\n        return rsp;\n\n    }\n}\n\nexport default Survey","import { render } from \"./Coi.vue?vue&type=template&id=b6630016\"\nimport script from \"./Coi.vue?vue&type=script&lang=js\"\nexport * from \"./Coi.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}