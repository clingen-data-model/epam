{"version":3,"file":"js/998.e9140a22.js","mappings":"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","sources":["webpack://epam/./src/views/Coi.vue","webpack://epam/./src/survey.js","webpack://epam/./src/components/coi/CoiPolicy.vue","webpack://epam/./src/views/Coi.vue?6bb8"],"sourcesContent":["<template>\n    <div>\n        <card :title=\"verifying ? `Loading COI Form` : `COI Form not found`\" v-if=\"!codeIsValid\">\n            <div v-if=\"!verifying\">We couldn't find this COI.</div>\n        </card>\n        <card title=\"There's a problem\" v-if=\"!groupMemberId\">\n            We can't seem to find your membership for this group id.  Please try refreshing.\n        </card>\n\n        <card :title=\"coiTitle\"  class=\"mx-auto relative\" style=\"max-width:800px\" v-else-if=\"codeIsValid\">\n            <CoiPolicy />\n            <hr>\n            <h2>COI</h2>\n            <div class=\"relative\">\n                <div\n                    v-for=\"question in survey.questions\"\n                    :key=\"question.name\"\n                    :class=\"question.class\"\n                >\n                    <transition name=\"slide-fade-down\">\n                        <div v-if=\"question.type == 'content'\">\n                            <MarkdownBlock\n                                :markdown=\"question.content\"\n                            />\n                        </div>\n                        <input-row\n                            v-else\n                            :label=\"question.question_text\"\n                            :errors=\"errors[question.name]\"\n                            :vertical=\"true\"\n                            v-show=\"showQuestion(question)\"\n                        >\n\n                            <textarea  v-if=\"question.type == 'text'\"\n                                class=\"w-full h-24\"\n                                v-model=\"response[question.name]\"\n                                :name=\"question.name\"\n                            ></textarea>\n\n                            <div v-if=\"question.type == 'multiple-choice'\">\n                                <label v-for=\"option in question.options\" :key=\"option.value\" class=\"mb-1\">\n                                    <input type=\"radio\"\n                                        :value=\"option.value\"\n                                        :name=\"question.name\"\n                                        v-model=\"response[question.name]\"\n                                    >\n                                    <div>{{option.label}}</div>\n                                </label>\n                            </div>\n\n                            <input\n                                type=\"text\"\n                                v-if=\"question.type == 'string'\"\n                                v-model=\"response[question.name]\"\n                                :name=\"question.name\"\n                            >\n                        </input-row>\n                    </transition>\n                </div>\n                <button-row :show-cancel=\"false\" @submitClicked=\"storeResponse()\">\n                    <slot v-if=\"saving\">\n                         Saving...\n                    </slot>\n                </button-row>\n            </div>\n        </card>\n\n        <note class=\"container\">GroupMemberId: {{groupMemberId}}</note>\n    </div>\n</template>\n<script>\nimport coiDef from '../../../surveys/coi_v2.json'\nimport Survey from '@/survey'\nimport api from '@/http/api'\nimport is_validation_error from '@/http/is_validation_error';\nimport CoiPolicy from '@/components/coi/CoiPolicy'\nimport MarkdownBlock from '@/components/MarkdownBlock'\n\nconst survey = new Survey(coiDef);\n\nexport default {\n    name: 'Coi',\n    components: {\n        CoiPolicy,\n        MarkdownBlock\n    },\n    props: {\n        code: {\n            required: true,\n            type: String\n        }\n    },\n    data() {\n        return {\n            coiDef: coiDef,\n            survey: survey,\n            response: survey.getResponseTemplate(),\n            errors: {},\n            groupName: null,\n            verifying: false,\n            saved: false,\n            saving: false,\n            redirectCountdown: 5\n        }\n    },\n    computed: {\n        codeIsValid() {\n            return this.groupName !== null;\n        },\n        coiTitle() {\n            return survey.name+' for '+this.groupName;\n        },\n        membership () {\n            return this.$store.getters\n                    .currentUser\n                    .person.memberships.find(m => {\n                        return m.group\n                            && m.group.coi_code === this.code\n                    });\n        },\n        groupMemberId() {\n            if (this.membership) {\n                return this.membership.id;\n            }\n\n            return null;\n        },\n    },\n    watch: {\n        code: {\n            immediate: true,\n            handler () {\n                this.initResponseValues()\n            }\n        }\n    },\n    methods: {\n        initResponseValues() {\n            if (this.membership && this.membership.cois.length > 0) {\n                const lastResponse = {...this.membership.cois[this.membership.cois.length -1]};\n\n                const v2ResponseData = (lastResponse.version == '1.0.0')\n                    ? this.transformV1Response(lastResponse.data)\n                    : {...lastResponse.data};\n\n                v2ResponseData.coi_attestation = null\n                v2ResponseData.data_policy_attestation = null\n                this.response = v2ResponseData;\n            }\n\n            return {}\n        },\n\n        transformV1Response (lastResponse) {\n            const v2Response = {\n                work_fee_lab: lastResponse.work_fee_lab,\n                contributions_to_gd_in_group: lastResponse.contributions_to_gd_in_ep,\n                contributions_to_genes: lastResponse.contributions_to_genes,\n                coi: (lastResponse.independent_efforts == 0 && lastResponse.coi == 0) ? 0 : 1,\n                coi_details: [\n                                lastResponse.independent_efforts_details,\n                                lastResponse.coi_details\n                            ].join(\";\\n\")\n            }\n\n            if ((lastResponse.independent_efforts == 2 || lastResponse.coi == 2)) {\n                v2Response.coi = 2;\n            }\n\n            return v2Response;\n        },\n\n        showQuestion(question) {\n            if (!question.show) {\n                return true;\n            }\n            if (Array.isArray(question.show.value)) {\n                return question.show.value.indexOf(this.response[question.show.name]) > -1;\n            }\n            return (this.response[question.show.name] == question.show.value);\n        },\n        verifyCode() {\n            this.verifying = true;\n            api.get(`/api/coi/${this.code}/group`)\n                .then(response => {\n                    this.groupName = response.data.display_name\n                })\n                .then(() => {\n                    this.verifying = false;\n                })\n        },\n        async storeResponse() {\n            this.saving = true;\n            try {\n                await this.$store.dispatch(\n                    'storeCoi',\n                    {\n                        code: this.code,\n                        groupMemberId: this.groupMemberId,\n                        coiData: this.response,\n                    }\n                );\n                this.saved = true;\n                await this.$store.dispatch('forceGetCurrentUser');\n                this.$router.push({name: 'Dashboard'});\n            } catch (error) {\n                if (is_validation_error(error)) {\n                    this.errors = error.response.data.errors\n                } else {\n                    this.$store.commit('pushError', `You can not complete a COI for ${this.groupName} because you are not a member.`)\n                }\n            }\n            this.saving = false;\n        },\n    },\n    async mounted() {\n        this.verifyCode();\n        await this.$store.dispatch('getCurrentUser')\n    }\n}\n</script>\n","class Question {\n    constructor(question) {\n        this.question_text = question.question;\n        this.name = question.name;\n        this.options = question.options;\n        this.validationRules = question.validation;\n        this.type = question.type;\n        this.show = question.show;\n        this.class = question.class;\n        this.content = question.content;\n    }\n}\n\nclass YesNoQuestion extends Question {\n    constructor(question) {\n        super(question)\n        this.type = 'multiple-choice';\n        this.options = [{\n                label: 'Yes',\n                value: 1\n            },\n            {\n                label: 'No',\n                value: 0\n            }\n        ];\n    }\n}\n\nfunction makeQuestion(questionDef) {\n    if (questionDef.type == 'yes-no') {\n        return new YesNoQuestion(questionDef);\n    }\n\n    return new Question(questionDef);\n}\n\nclass Survey {\n    constructor(surveyDefinition) {\n        this._name = surveyDefinition.name;\n        this._questions = surveyDefinition.questions.map(q => makeQuestion(q));\n\n    }\n\n    get name() {\n        return this._name;\n    }\n\n    get questions() {\n        return this._questions\n    }\n\n    getResponseTemplate() {\n        const rsp = {};\n        this.questions\n            .filter(q => q.type == 'content')\n            .forEach(q => {\n                rsp[q.name] = null\n            });\n        return rsp;\n\n    }\n}\n\nexport default Survey\n","import script from \"./CoiPolicy.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./CoiPolicy.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./CoiPolicy.vue?vue&type=style&index=0&id=d87f1f48&scoped=true&lang=css\"\n\nimport exportComponent from \"/home/bpow/src/clingen/gpm/resources/app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-d87f1f48\"]])\n\nexport default __exports__","import { render } from \"./Coi.vue?vue&type=template&id=93da2f3e\"\nimport script from \"./Coi.vue?vue&type=script&lang=js\"\nexport * from \"./Coi.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/bpow/src/clingen/gpm/resources/app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","class","_createElementBlock","$options","_createBlock","_component_card","title","$data","style","_createVNode","_component_CoiPolicy","_hoisted_3","_hoisted_4","_hoisted_5","_Fragment","questions","question","key","name","_Transition","type","_component_MarkdownBlock","markdown","content","_component_input_row","label","question_text","errors","vertical","options","option","value","_component_button_row","onSubmitClicked","_renderSlot","_ctx","_component_note","Question","constructor","this","validationRules","validation","show","YesNoQuestion","super","makeQuestion","questionDef","Survey","surveyDefinition","_name","_questions","map","q","getResponseTemplate","rsp","filter","forEach","__exports__","survey","coiDef","components","CoiPolicy","MarkdownBlock","props","code","required","String","data","response","groupName","verifying","saved","saving","redirectCountdown","computed","codeIsValid","coiTitle","membership","$store","getters","currentUser","person","memberships","find","m","group","coi_code","groupMemberId","id","watch","immediate","handler","initResponseValues","methods","cois","length","lastResponse","v2ResponseData","version","transformV1Response","coi_attestation","data_policy_attestation","v2Response","work_fee_lab","contributions_to_gd_in_group","contributions_to_gd_in_ep","contributions_to_genes","coi","independent_efforts","coi_details","independent_efforts_details","join","showQuestion","Array","isArray","indexOf","verifyCode","api","get","then","display_name","storeResponse","dispatch","coiData","$router","push","error","is_validation_error","commit","mounted","render"],"sourceRoot":""}