"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[700],{2790:function(e,t,o){o.d(t,{Z:function(){return n}});o(6699);var l=o(2119),i=o(6252);function n(e=null){const t=(0,l.tv)(),o=(0,l.yj)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const n=(0,i.Fl)({immediate:!0,get(){return Object.keys(o.query).includes("sort-field")?{field:o.query["sort-field"],desc:Boolean(parseInt(o.query["sort-desc"]))}:e},set(e){const l={"sort-field":e.field,"sort-desc":e.desc?1:0},i={...o.query,...l};t.replace({path:o.path,query:i})}}),a=(0,i.Fl)({set(e){let l=o.query,i=o.path,n={...l};e?n={...l,filter:e}:delete n.filter,t.replace({path:i,query:n})},get(){return o.query.filter},immediate:!0});return{sort:n,filter:a}}},9366:function(e,t,o){o.r(t),o.d(t,{default:function(){return z}});var l=o(6252),i=o(9963);const n=(0,l._)("h1",null,"Institutions",-1),a=(0,l.Uk)(" Filter: "),r=(0,l._)("button",{class:"btn btn-xs"},"â€¦",-1),s=(0,l.Uk)("Edit"),d=(0,l.Uk)("Approve"),u=(0,l.Uk)("Merge into another");function m(e,t,o,m,c,p){const h=(0,l.up)("dropdown-item"),b=(0,l.up)("dropdown-menu"),w=(0,l.up)("data-table"),v=(0,l.up)("institution-approval-form"),f=(0,l.up)("modal-dialog"),g=(0,l.up)("institution-update-form"),y=(0,l.up)("institution-merge-form");return(0,l.wg)(),(0,l.iD)("div",null,[n,(0,l.Wm)(w,{paginated:"",data:p.filteredItems,fields:c.fields,sort:m.sort,"onUpdate:sort":t[1]||(t[1]=e=>m.sort=e)},{header:(0,l.w5)((()=>[(0,l._)("label",null,[a,(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>m.filter=e)},null,512),[[i.nr,m.filter]])])])),"cell-actions":(0,l.w5)((({item:e})=>[(0,l.Wm)(b,{"hide-cheveron":""},{label:(0,l.w5)((()=>[r])),default:(0,l.w5)((()=>[(0,l.Wm)(h,{onClick:t=>p.edit(e)},{default:(0,l.w5)((()=>[s])),_:2},1032,["onClick"]),(0,l.Wm)(h,{onClick:t=>p.initApprove(e)},{default:(0,l.w5)((()=>[d])),_:2},1032,["onClick"]),(0,l.Wm)(h,{onClick:t=>p.initMerge(e)},{default:(0,l.w5)((()=>[u])),_:2},1032,["onClick"])])),_:2},1024)])),_:1},8,["data","fields","sort"]),((0,l.wg)(),(0,l.j4)(l.lR,{to:"body"},[(0,l.Wm)(f,{modelValue:c.showApproveDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>c.showApproveDialog=e),title:`Approve ${c.currentItem.name}`},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{modelValue:c.currentItem,"onUpdate:modelValue":t[2]||(t[2]=e=>c.currentItem=e),onSaved:p.handleSaved,onCanceled:p.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,l.Wm)(f,{modelValue:c.showEditDialog,"onUpdate:modelValue":t[5]||(t[5]=e=>c.showEditDialog=e),title:`Edit ${c.currentItem.name}`},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{modelValue:c.currentItem,"onUpdate:modelValue":t[4]||(t[4]=e=>c.currentItem=e),onSaved:p.handleSaved,onCanceled:p.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,l.Wm)(f,{modelValue:c.showMergeDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>c.showMergeDialog=e),title:"Merge Institutions"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{obsoletes:[c.currentItem],onSaved:p.handleMerge,onCanceled:t[6]||(t[6]=e=>c.showMergeDialog=!1)},null,8,["obsoletes","onSaved"])])),_:1},8,["modelValue"])]))])}var c=o(2790),p=o(8171),h=o(3577);const b=(0,l.Uk)(" Are you sure you want to approve this institution? ");function w(e,t,o,i,n,a){const r=(0,l.up)("dictionary-row"),s=(0,l.up)("button-row");return(0,l.wg)(),(0,l.iD)("div",null,[b,(0,l.Wm)(r,{label:"Name"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,h.zw)(o.modelValue.name),1)])),_:1}),(0,l.Wm)(r,{label:"Abbreviation"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,h.zw)(o.modelValue.abbreviation||"--"),1)])),_:1}),(0,l.Wm)(r,{label:"URL"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,h.zw)(o.modelValue.url||"--"),1)])),_:1}),(0,l.Wm)(r,{label:"Country"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,h.zw)(o.modelValue.country?o.modelValue.country.name:"--"),1)])),_:1}),(0,l.Wm)(r,{label:"Reportable"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,h.zw)(o.modelValue.reportable?"Yes":"No"),1)])),_:1}),(0,l.Wm)(s,{"submit-text":"Approve",onSubmitted:a.approve,onCancel:a.cancelApproval},null,8,["onSubmitted","onCancel"])])}var v={name:"ComponentName",props:{modelValue:{type:Object,required:!0}},emits:["saved","canceled","update:modelValue"],methods:{async approve(){const e=await(0,p.xp)(this.modelValue);this.$emit("update:modelValue",e),this.$emit("saved",e)},cancelApproval(){this.$emit("canceled")}}},f=o(3744);const g=(0,f.Z)(v,[["render",w]]);var y=g;function I(e,t,o,i,n,a){const r=(0,l.up)("data-form"),s=(0,l.up)("button-row");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(r,{fields:i.fields,errors:n.errors,modelValue:i.workingCopy,"onUpdate:modelValue":t[0]||(t[0]=e=>i.workingCopy=e)},null,8,["fields","errors","modelValue"]),(0,l.Wm)(s,{"submit-text":"Save",onSubmitted:a.save,onCancel:a.cancel},null,8,["onSubmitted","onCancel"])])}var V=o(1076),k=o(9028),C={name:"InstitutionCreateForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","saved","canceled"],data(){return{errors:{}}},methods:{async save(){try{this.initErrors();const e=await this.updateInstitution(this.workingCopy);this.$emit("update:modelValue",e),this.$emit("saved",e)}catch(e){(0,k.z1)(e)&&(this.errors=e.response.data.errors)}},cancel(){this.$emit("canceled"),this.initInstitution()},initErrors(){this.errors={}}},setup(e,t){const{workingCopy:o}=(0,V.kM)(e,t);return{fields:p.XU,getCountries:p.ox,countries:p.hW,updateInstitution:p.TK,workingCopy:o}},mounted(){this.getCountries()}};const U=(0,f.Z)(C,[["render",I]]);var W=U;const _=(0,l._)("p",{class:"mb-8"},[(0,l.Uk)(" Merging institutions will do the following: "),(0,l._)("ol",{class:"list-decimal ml-6"},[(0,l._)("li",null,"Transfer all people with the obsolete institution to the authoritiative institution."),(0,l._)("li",null,"Delete the obsolete institution.")])],-1),D=(0,l.Uk)(" Merge "),M=(0,l.Uk)("(Obsolete institution that will be deleted)"),S=(0,l.Uk)("Into "),A=(0,l.Uk)("(Authoritative institution)");function E(e,t,o,i,n,a){const r=(0,l.up)("note"),s=(0,l.up)("institution-search-select"),d=(0,l.up)("input-row"),u=(0,l.up)("button-row");return(0,l.wg)(),(0,l.iD)("div",null,[_,(0,l.Wm)(d,{label:"Merge",vertical:""},{label:(0,l.w5)((()=>[D,(0,l.Wm)(r,{class:"inline-block"},{default:(0,l.w5)((()=>[M])),_:1})])),default:(0,l.w5)((()=>[(0,l.Wm)(s,{"model-value":n.obsoleteIds,"onUpdate:modelValue":a.handleObsoleteUpdate,"allow-add":!1},null,8,["model-value","onUpdate:modelValue"])])),_:1}),(0,l.Wm)(d,{label:"Into",errors:n.errors.authority_id,vertical:""},{label:(0,l.w5)((()=>[S,(0,l.Wm)(r,{class:"inline"},{default:(0,l.w5)((()=>[A])),_:1})])),default:(0,l.w5)((()=>[(0,l.Wm)(s,{modelValue:n.authorityId,"onUpdate:modelValue":t[0]||(t[0]=e=>n.authorityId=e),"allow-add":!1},null,8,["modelValue"])])),_:1},8,["errors"]),(0,l.Wm)(u,{"submit-text":"Merge",onSubmitted:a.commitMerge,onCanceled:a.cancelMerge},null,8,["onSubmitted","onCanceled"])])}var q={name:"InstitutionMergeForm",props:{authority:{type:Object,required:!1},obsoletes:{type:Array,default:()=>[]}},emits:["saved","canceled"],data(){return{authorityId:null,obsoleteIds:[],errors:{}}},watch:{authority:{immediate:!0,handler(e){e&&(this.authorityId=e.id)}},obsoletes:{immediate:!0,deep:!0,handler(e){this.obsoleteIds=e.map((e=>e.id))}}},methods:{handleObsoleteUpdate(e){this.obsoleteIds=e?[e]:[]},async commitMerge(){try{this.errors={},await(0,p.EP)(this.authorityId,this.obsoleteIds),this.authorityId=null,this.obsoleteIds=[],this.$emit("saved")}catch(e){(0,k.z1)(e)&&(this.errors=e.response.data.errors)}},cancelMerge(){this.authorityId=null,this.obsoleteIds=[],this.$emit("canceled")}}};const $=(0,f.Z)(q,[["render",E]]);var x=$,F={name:"InstitutionList",components:{InstitutionUpdateForm:W,InstitutionApprovalForm:y,InstitutionMergeForm:x},data(){return{items:[],fields:[{name:"id",label:"ID",type:Number,sortable:!0},{name:"name",type:String,sortable:!0},{name:"abbreviation",type:String,sortable:!0},{name:"country.name",label:"Country",type:String,sortable:!0},{name:"people_count",label:"# People",type:Number,sortable:!0},{name:"approved",type:Boolean,sortable:!0,resolveValue(e){return e.approved?"Approved":null},resolveSort(e){return e.approved}},{name:"actions",label:"",sortable:!1}],currentItem:{country:{}},showApproveDialog:!1,showEditDialog:!1,showMergeDialog:!1}},computed:{filteredItems(){if(!this.filter)return this.items;const e=new RegExp(`.*${this.filter}.*`,"i");return this.items.filter((t=>t.name.match(e)||t.abbreviation&&t.abbreviation.match(e)||t.country&&t.country.name.match(e)))}},methods:{edit(e){this.showEditDialog=!0,this.currentItem=e},initApprove(e){this.showApproveDialog=!0,this.currentItem=e},initMerge(e){this.currentItem=e,this.showMergeDialog=!0},async getInstitutions(){this.items=await(0,p.iE)()},handleSaved(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},handleCancel(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},handleMerge(){this.getInstitutions(),this.showMergeDialog=!1},updateItem(){if(!this.currentItem.id)return;const e=this.items.findIndex((e=>e.id==this.currentItem.id));e>-1&&(this.items[e]={...this.currentItem})}},setup(){const{sort:e,filter:t}=(0,c.Z)({field:"name",desc:!1});return{sort:e,filter:t}},mounted(){this.getInstitutions()}};const j=(0,f.Z)(F,[["render",m]]);var z=j}}]);
//# sourceMappingURL=institution-list.c71f1914.js.map