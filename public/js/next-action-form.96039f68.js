"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[266],{4100:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var a=n(641),o=n(33),i=n(3751);const s=(0,a.Lk)("option",{value:null},"Select...",-1),l=["value"],r=(0,a.eW)("    "),d=(0,a.Lk)("div",{class:"ml-4"},null,-1);function c(e,t,n,c,u,p){const m=(0,a.g2)("input-row"),_=(0,a.g2)("step-input"),h=(0,a.g2)("rich-text-editor"),A=(0,a.g2)("checkbox"),g=(0,a.g2)("button-row"),w=(0,a.g2)("form-container");return(0,a.uX)(),(0,a.Wv)(w,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{label:"Creation Date",errors:u.errors.date_created,type:"date",modelValue:u.newAction.date_created,"onUpdate:modelValue":t[0]||(t[0]=e=>u.newAction.date_created=e)},null,8,["errors","modelValue"]),2==p.application.expert_panel_type_id?((0,a.uX)(),(0,a.Wv)(_,{key:0,modelValue:u.newAction.step,"onUpdate:modelValue":t[1]||(t[1]=e=>u.newAction.step=e),errors:u.errors.step},null,8,["modelValue","errors"])):(0,a.Q3)("",!0),(0,a.bF)(m,{label:"Target",Date:"",errors:u.errors.target_date,type:"date",modelValue:u.newAction.target_date,"onUpdate:modelValue":t[2]||(t[2]=e=>u.newAction.target_date=e)},null,8,["errors","modelValue"]),(0,a.bF)(m,{label:"Entry",errors:u.errors.entry},{default:(0,a.k6)((()=>[(0,a.bF)(h,{modelValue:u.newAction.entry,"onUpdate:modelValue":t[3]||(t[3]=e=>u.newAction.entry=e)},null,8,["modelValue"])])),_:1},8,["errors"]),(0,a.bF)(m,{label:"Assigned To",errors:p.assignmentErrors},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.Lk)("select",{id:"","onUpdate:modelValue":t[4]||(t[4]=e=>u.newAction.assigned_to=e)},[s,((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.assignees,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e.id,value:e.id},(0,o.v_)(e.name),9,l)))),128))],512),[[i.u1,u.newAction.assigned_to]]),r,(0,a.bo)((0,a.Lk)("input",{type:"text",label:"Name","onUpdate:modelValue":t[5]||(t[5]=e=>u.newAction.assigned_to_name=e),placeholder:"Name (optional)"},null,512),[[i.Jo,u.newAction.assigned_to_name]])])),_:1},8,["errors"]),d,(0,a.bF)(A,{modelValue:u.completed,"onUpdate:modelValue":t[6]||(t[6]=e=>u.completed=e),label:"This is already completed",class:"ml-36"},null,8,["modelValue"]),u.completed?((0,a.uX)(),(0,a.Wv)(m,{key:1,label:"Date Completed",errors:u.errors.date_completed,class:"ml-36"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.Lk)("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=e=>u.newAction.date_completed=e)},null,512),[[i.Jo,u.newAction.date_completed]])])),_:1},8,["errors"])):(0,a.Q3)("",!0),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.Lk)("button",{class:"btn",onClick:t[8]||(t[8]=(...e)=>p.cancel&&p.cancel(...e))},"Cancel"),(0,a.Lk)("button",{class:"btn blue",onClick:t[9]||(t[9]=(...e)=>p.save&&p.save(...e))},"Save")])),_:1})])),_:1})}n(3725),n(2598);var u=n(1606),p=n(6278),m=n(5079),_=n(1877),h=n(7752),A={name:"NextActionForm",components:{StepInput:u["default"],RichTextEditor:m["default"]},props:{id:{required:!1,default:null}},emits:["saved","closed","formCleared","canceled"],data(){return{errors:{},newAction:{date_created:new Date,step:null,date_completed:null,entry:"",assigned_to:null,assigned_to_name:null},completed:!1}},computed:{...(0,p.L8)({group:"groups/currentItemOrNew"}),application(){return this.group.expert_panel},title(){return this.newAction.id?"Update Action":"Add Next Action"},steps(){return[1,2,3,4]},assignmentErrors(){let e=[];return this.errors.assigned_to&&(e=[...e,...this.errors.assigned_to]),this.errors.assigned_to_name&&(e=[...e,...this.errors.assigned_to_name]),e},assignees(){return Object.values(h.nextActions.assignees)}},watch:{id:{immediate:!0,handler:function(){const e=this.findAction();e&&this.syncAction(e)}},application:{immediate:!0,handler:function(){const e=this.findAction();e&&this.syncAction(e)}}},methods:{cancel(){this.clearForm(),this.$emit("canceled")},clearForm(){this.initNewAction(),this.$emit("formCleared")},initNewAction(){this.newAction={date_created:new Date,step:null,target_date:null,date_completed:null,entry:"",assigned_to:null,assigned_to_name:null}},findAction(){return null===this.id?null:this.application.next_actions?this.application.next_actions.find((e=>e.id==this.id)):void 0},syncAction(e){e&&(this.newAction={id:e.id,uuid:e.uuid,date_created:(0,_.Yq)(e.created_at),step:e.step,target_date:(0,_.Yq)(e.target_date),date_completed:(0,_.Yq)(e.date_completed),entry:e.entry??"",assigned_to:e.assigned_to,assigned_to_name:e.assigned_to_name})},async save(){try{this.newAction.id?(await this.$store.dispatch("applications/updateNextAction",{application:this.application,updatedAction:this.newAction}),this.$emit("saved"),this.clearForm()):(await this.$store.dispatch("applications/addNextAction",{application:this.application,nextActionData:this.newAction}),this.$emit("saved"),this.clearForm())}catch(e){if(e.response&&422==e.response.status&&e.response.data.errors)return void(this.errors=e.response.data.errors)}}},unmounted(){this.initNewAction()},mounted(){}},g=n(6262);const w=(0,g.A)(A,[["render",c]]);var b=w}}]);
//# sourceMappingURL=next-action-form.96039f68.js.map