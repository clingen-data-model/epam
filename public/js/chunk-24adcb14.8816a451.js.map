{"version":3,"sources":["webpack:///./src/views/PersonEdit.vue","webpack:///./src/views/PersonEdit.vue?1701","webpack:///./src/components/people/ProfilePhotoForm.vue","webpack:///./src/components/people/ProfilePhotoForm.vue?8a9d","webpack:///./src/forms/profile_form.js","webpack:///./src/components/people/ProfileForm.vue","webpack:///./src/components/people/ProfileForm.vue?eb3a"],"names":["_createElementBlock","_createVNode","_component_profile_form","person","$options","$event","onSaved","onCanceled","name","components","ProfileForm","props","uuid","required","type","String","computed","this","$store","getters","watch","immediate","handler","dispatch","methods","goBack","$router","go","__exports__","render","class","$data","_createElementVNode","src","alt","onClick","_createBlock","_Teleport","to","_component_modal_dialog","title","_component_ImageCropper","image-src","onCropped","_component_input_row","hideLabel","errors","profile_photo","onChange","ref","_hoisted_3","_component_button_row","submit-text","onSubmitted","ImageCropper","Object","data","showForm","file","croppedImageBlob","saving","deep","fetchProfileImage","srcPath","console","log","URL","createObjectURL","profilePhoto","altText","profile_photo_path","initUpload","$nextTick","window","dispatchEvent","Event","setFile","$refs","fileInput","files","setCroppedImageBlob","blob","url","options","Accept","timeout","responseType","api","get","then","rsp","Blob","saveCropped","size","width","img","Image","addEventListener","canvas","document","createElement","ctx","getContext","oc","octx","height","cur","Math","floor","drawImage","toBlob","storeImage","formData","FormData","append","post","catch","error","isValidationError","response","cancelCropped","lookups","countries","primaryOccupations","races","ethnicities","genders","profileFields","label","component","InstitutionSearchSelect","notes","AddressInput","value","TimezoneSearchSelect","demographicFields","placeholder","show","primary_occupation_id","race_id","enthnicity_id","gender_id","getLookups","keys","forEach","lkup","kebabCase","map","i","id","_hoisted_1","_component_profile_photo_form","$props","style","_component_data_form","fields","ProfilePhotoForm","emits","profile","page","institutionId","timezone","editableFields","hasPermission","userIsPerson","filter","f","includes","initProfile","attributes","save","force","commit","$emit","cancel","setup","onMounted","mounted"],"mappings":"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","file":"js/chunk-24adcb14.8816a451.js","sourcesContent":["<template>\n    <div>\n        <profile-form :person=\"person\"\n            v-model=\"person\"\n            @saved=\"goBack()\"\n            @canceled=\"goBack()\"\n        ></profile-form>\n    </div>\n</template>\n<script>\nimport ProfileForm from '@/components/people/ProfileForm.vue'\n\nexport default {\n    name: 'PersonEdit',\n    components: {\n        ProfileForm\n    },\n    props: {\n        uuid: {\n            required: true,\n            type: String\n        }\n    },\n    computed: {\n        person () {\n            return this.$store.getters['people/currentItem'];\n        }\n    },\n    watch: {\n        uuid: {\n            immediate: true,\n            handler () {\n                this.$store.dispatch('people/getPerson', {uuid: this.uuid});\n            }\n        }\n    },\n    methods: {\n        goBack () {\n            this.$router.go(-1);\n        }\n    }\n}\n</script>","import { render } from \"./PersonEdit.vue?vue&type=template&id=7ddf0198\"\nimport script from \"./PersonEdit.vue?vue&type=script&lang=js\"\nexport * from \"./PersonEdit.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/yugen/code/epam/resources/app/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\n    <div :class=\"{'cursor-wait': saving}\">\n        <div class=\"border border-gray-200 rounded-lg\">\n            <img \n                :src=\"srcPath\" \n                :alt=\"altText\"\n                class=\"rounded-t-lg w-full\"\n                @click=\"initUpload\"\n            >\n            <button \n                @click=\"initUpload\"\n                class=\"border border-t-0 bg-gray-200 block w-full\"\n            >\n                Edit\n            </button>\n        </div>\n\n        <teleport to='body'>\n            <modal-dialog v-model=\"showForm\" title=\"Upload a new profile photo\">\n                <ImageCropper \n                    :image-src=\"srcPath\" \n                    @cropped=\"setCroppedImageBlob\"\n                />\n\n                <input-row hideLabel :errors=\"errors.profile_photo\">\n                    <input type=\"file\" @change=\"setFile\" ref=\"fileInput\">\n                </input-row>\n\n                <button-row submit-text=\"Save\" @submitted=\"saveCropped\" @canceled=\"cancelCropped\" v-if=\"!saving\"/>\n                <div v-else>Saving...</div>\n            </modal-dialog>\n        </teleport>\n    </div>\n</template>\n<script>\nimport ImageCropper from '@/components/ImageCropper.vue'\nimport {api, isValidationError} from '@/http'\n\nexport default {\n    name: 'ProfilePhotoForm',\n    components: {\n        ImageCropper\n    },\n    props: {\n        person: {\n            type: Object,\n            required: true\n        }\n    },\n    data() {\n        return {\n            showForm: false,\n            file: null,\n            croppedImageBlob: null,\n            errors: {},\n            saving: false\n        }\n    },\n    watch: {\n        person: {\n            immediate: true,\n            deep: true,\n            handler (to) {\n                if (to.profile_photo) {\n                    this.fetchProfileImage();\n                }\n            }\n        }\n    },\n    computed: {\n        srcPath () {\n            if (this.file) {\n                console.log('create from this.file');\n                return URL.createObjectURL(this.file);\n            }\n            if (this.person.profile_photo) {\n                return `/profile-photos/${this.person.profile_photo}`\n            }\n            return '/images/default_profile.jpg';\n        },\n        profilePhoto () {\n            if (this.person.profile_photo) {\n                return `/profile-photos/${this.person.profile_photo}`\n            }\n            return '/images/default_profile.jpg';\n        },\n        altText () {\n            return this.person.profile_photo_path \n                ? `${this.person.name} profile photo.` \n                : 'Default profile image';\n        },\n    },\n    methods: {\n        initUpload () {\n            this.showForm = true;\n            this.$nextTick(() => {\n                window.dispatchEvent(new Event('resize'));\n            });\n        },\n        setFile () {\n            this.file = this.$refs.fileInput.files[0]\n        },\n        setCroppedImageBlob (blob) {            \n            this.croppedImageBlob = blob;\n        },\n        async fetchProfileImage () {\n            const url = `/api/people/${this.person.uuid}/profile-photo`;\n            const options = {\n                Accept: 'application/octet-stream',\n                timeout: 30000,\n                responseType: 'blob'\n            };\n            this.file = await api.get(url, options)\n                            .then(rsp => {\n                                if( !(rsp.data instanceof Blob)) return;\n\n                                return new Blob([rsp.data]);\n                            });\n        },\n        saveCropped () {\n            if (this.croppedImageBlob.size > 2000000) {\n                const width = 400;\n                const img = new Image();\n                img.src = URL.createObjectURL(this.croppedImageBlob);\n\n                img.addEventListener('load', () => {\n                    var canvas = document.createElement('canvas'),\n                    ctx = canvas.getContext(\"2d\"),\n\n                    oc = document.createElement('canvas'),\n                    octx = oc.getContext('2d');\n\n                    canvas.width = width; // destination canvas size\n                    canvas.height = canvas.width * img.height / img.width;\n\n                    var cur = {\n                        width: Math.floor(img.width * 0.5),\n                        height: Math.floor(img.height * 0.5)\n                    }\n\n                    oc.width = cur.width;\n                    oc.height = cur.height;\n\n                    octx.drawImage(img, 0, 0, cur.width, cur.height);\n\n                    while (cur.width * 0.5 > width) {\n                        cur = {\n                            width: Math.floor(cur.width * 0.5),\n                            height: Math.floor(cur.height * 0.5)\n                        };\n                        octx.drawImage(oc, 0, 0, cur.width * 2, cur.height * 2, 0, 0, cur.width, cur.height);\n                    }\n                    ctx.drawImage(oc, 0, 0, cur.width, cur.height, 0, 0, canvas.width, canvas.height);\n                    canvas.toBlob(blob => {\n                        console.log(blob.size/1000/1000);\n                        this.storeImage(blob);\n                    }, null, .5)\n                });\n\n                return;\n            }\n\n            this.storeImage(this.croppedImageBlob)\n        },\n        storeImage (blob) {\n            this.saving = true;\n            const formData = new FormData();\n\n            formData.append('profile_photo', blob);\n\n            api.post(`/api/people/${this.person.uuid}/profile-photo`, formData)\n                .then(() => {\n                    this.$store.dispatch('people/getPerson', {uuid: this.person.uuid});\n                    this.showForm = false;\n                    this.file = null;\n                    this.saving = false;\n                })\n                .catch(error => {\n                    if (isValidationError(error)) {\n                        this.errors = error.response.data.errors;\n                        this.saving = false;\n                        return;\n                    }\n                    this.saving = false;\n                    throw (error);\n                })\n        },\n        cancelCropped () {\n            this.showForm = false;\n            this.file = null;\n        }\n    }\n}\n</script>","import { render } from \"./ProfilePhotoForm.vue?vue&type=template&id=4be868c8\"\nimport script from \"./ProfilePhotoForm.vue?vue&type=script&lang=js\"\nexport * from \"./ProfilePhotoForm.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/yugen/code/epam/resources/app/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import {ref, computed} from 'vue';\nimport api from '@/http/api';\nimport {kebabCase} from '@/utils'\nimport TimezoneSearchSelect from '@/components/forms/TimezoneSearchSelect.vue'\nimport InstitutionSearchSelect from '@/components/forms/InstitutionSearchSelect.vue'\nimport AddressInput from '@/components/forms/AddressInput.vue'\n\nexport const lookups = ref({\n    countries:[],\n    primaryOccupations:[],\n    races:[],\n    ethnicities:[],\n    genders:[],\n});\n\nexport const profileFields = computed(() => [\n    { name: 'first_name'},\n    { name: 'last_name'},\n    { name: 'email'},\n    {\n        name: 'institution_id',\n        label: 'Institution',\n        type: 'component',\n        component: InstitutionSearchSelect\n    },\n    { \n        name: 'credentials', \n        type: 'large-text',\n        notes: 'Include degrees and certifications such as PhD, MD, CGC, etc. Please include professional roles and associations in your biography.'\n    },\n    { name: 'biography', type: 'large-text'},\n    {\n        name: '*', // specifies passing entire modelValue to component.\n        type: 'component',\n        label: 'Address',\n        component: AddressInput\n    },\n    { \n        name: 'country_id', \n        label: 'Country',\n        type: 'select', \n        options: lookups.value.countries\n    },\n    { name: 'phone'},\n    { \n        name: 'timezone', \n        label: 'Timezone',\n        type: 'component', \n        component: TimezoneSearchSelect\n    },\n]);\n\nexport const demographicFields = computed(() => [\n    {\n        name: 'primary_occupation_id',\n        label: 'Primary Occupation',\n        type: 'select',\n        options: lookups.value.primaryOccupations\n    },\n    {\n        name: 'primary_occupation_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.primary_occupation_id == 100\n        }\n    },\n    {\n        name: 'race_id',\n        label: 'Race',\n        type: 'select',\n        options: lookups.value.races\n    },\n    {\n        name: 'race_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.race_id == 100\n        }\n    },\n    {\n        name: 'ethnicity_id',\n        label: 'Ethnicity',\n        type: 'select',\n        options: lookups.value.ethnicities\n    },\n    {\n        name: 'enthnicity_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.enthnicity_id == 100\n        }\n    },\n    {\n        name: 'gender_id',\n        label: 'Gender',\n        type: 'select',\n        options: lookups.value.genders\n    },\n    {\n        name: 'gender_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.gender_id == 100\n        }\n    },\n]);\n\nexport const getLookups = () => {\n    Object.keys(lookups.value).forEach(lkup => {\n        api.get(`/api/people/lookups/${kebabCase(lkup)}`)\n            .then(response => {\n                lookups.value[lkup] = response.data.data.map(i => ({value: i.id, label: i.name}));\n            })\n            .catch(error => console.error(error));\n    })\n}\n\nexport default {\n    profileFields,\n    demographicFields,\n    lookups,\n    getLookups,\n}","<template>\n    <div>\n        <h3>Profile</h3>\n        <div class=\"float-right\">\n            <profile-photo-form :person=\"person\" style=\"width: 100px; height: 100px;\" />\n        </div>\n        <data-form \n            :fields=\"fields\" \n            v-model=\"profile\" \n            :errors=\"errors\"\n        ></data-form>\n        <hr class=\"my-4\">\n\n        <!-- <h3>Demographics</h3>\n        <data-form \n            :fields=\"demographicFields\" \n            v-model=\"profile\" \n            :errors=\"errors\"\n        ></data-form> -->\n\n        <button-row @submitted=\"save\" @canceled=\"cancel()\" submit-text=\"Save\"></button-row>\n    </div>\n</template>\n<script>\nimport isValidationError from '@/http/is_validation_error'\nimport {onMounted} from 'vue'\nimport {getLookups, profileFields, demographicFields, lookups} from '@/forms/profile_form';\nimport ProfilePhotoForm from '@/components/people/ProfilePhotoForm.vue';\nexport default {\n    name: 'ProfileForm',\n    components: {\n        ProfilePhotoForm\n    },\n    props: {\n        person: {\n            type: Object,\n            required: true\n        }\n    },\n    emits: [\n        'saved',\n        'canceled'\n    ],\n    data() {\n        return {\n            errors: {},\n            profile: {},\n            page: 'profile',\n            institutionId: null,\n            timezone: null\n        }\n    },\n    computed: {\n        fields () {\n            let editableFields = [...this.profileFields];\n            if (!this.hasPermission('people-manage') && !this.userIsPerson(this.person)) {\n                editableFields =  editableFields.filter(f => ['first_name', 'last_name', 'email'].includes(f.name));\n            }\n            return editableFields;\n\n            // return (this.page == 'profile') ? this.profileFields : this.demographicFields;\n        },\n        title () {\n            return this.page == 'profile' ? 'Please fill out your profile' : 'Please share your demographic information.'\n        }\n    },\n    watch: {\n        person () {\n            this.initProfile();\n        }\n    },\n    methods: {\n        initProfile () {\n            this.profile = {...this.person.attributes};\n        },\n        async save () {\n            try {\n                await this.$store.dispatch(\n                        'people/updateProfile', \n                        {uuid: this.person.uuid, attributes: this.profile}\n                    )                \n                    .then(() => {\n                        this.$store.dispatch('getCurrentUser', {force: true})\n                        this.$store.commit('pushSuccess', 'Your profile has been updated.')\n                    })\n                    \n                this.errors = {};\n                this.$emit('saved');\n            } catch (error) {\n                if (isValidationError(error)) {\n                    this.errors = error.response.data.errors;\n                }\n            }\n        },\n        cancel () {\n            this.initProfile();\n            this.errors = {};\n            this.$emit('canceled');\n        }\n    },\n    setup () {\n        onMounted(() => getLookups());\n\n        return {\n            profileFields,\n            demographicFields,\n            getLookups,\n            lookups,\n        }\n    },\n    async mounted () {\n        this.initProfile()\n    }\n}\n</script>","import { render } from \"./ProfileForm.vue?vue&type=template&id=3ede90a3\"\nimport script from \"./ProfileForm.vue?vue&type=script&lang=js\"\nexport * from \"./ProfileForm.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/yugen/code/epam/resources/app/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}