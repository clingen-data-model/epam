(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["new-contact-form"],{"457f":function(e,t,r){"use strict";r.r(t);r("b0c0");var n=r("7a23"),o=function(e){return Object(n["pushScopeId"])("data-v-5d5e0015"),e=e(),Object(n["popScopeId"])(),e},i={class:"flex"},s={class:"flex-1"},c={key:0},a={class:"flex space-x-2"},l=["errors"],u={key:1},d={class:"border-t mt-4 pt-2"},m=o((function(){return Object(n["createElementVNode"])("h3",null,"Group Roles",-1)})),b={class:"flex flex-col h-24 flex-wrap"},p={key:0,class:"border-t mt-2 pt-2 pl-2"},f=o((function(){return Object(n["createElementVNode"])("h4",null,"Training",-1)})),g={class:"flex justify-between w-full items-center"},v=Object(n["createTextVNode"])(" Group Permissions "),h={class:"flex flex-col h-24 flex-wrap"},w={class:"px-2 py-1 bg-gray-100 border relative text-xs"},O={class:"flex space-x-2"},j=o((function(){return Object(n["createElementVNode"])("strong",null,"Legend: ",-1)})),x=o((function(){return Object(n["createElementVNode"])("div",{class:"absolute top-0 left-0 w-full h-full bg-pink-500 opacity-0"},"Â ",-1)})),k={key:0,class:"pt-2 border-l pl-2 flex-1"},M=o((function(){return Object(n["createElementVNode"])("h5",{class:"font-bold border-b mb-1 pb-1"},"Matching people",-1)}));function V(e,t,r,o,V,_){var N=Object(n["resolveComponent"])("input-row"),y=Object(n["resolveComponent"])("dictionary-row"),E=Object(n["resolveComponent"])("static-alert"),C=Object(n["resolveComponent"])("checkbox"),S=Object(n["resolveComponent"])("badge"),P=Object(n["resolveComponent"])("collapsible"),B=Object(n["resolveComponent"])("member-suggestions"),I=Object(n["resolveComponent"])("button-row");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[Object(n["createElementVNode"])("div",i,[Object(n["createElementVNode"])("div",s,[V.newMember.id||V.newMember.person_id?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",c,[Object(n["createVNode"])(N,{label:"Name",errors:_.nameErrors},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",a,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=function(e){return V.newMember.person.first_name=e}),placeholder:"First",class:"block w-1/2",onInput:t[1]||(t[1]=function(){return _.getSuggestedPeople&&_.getSuggestedPeople.apply(_,arguments)})},null,544),[[n["vModelText"],V.newMember.person.first_name]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=function(e){return V.newMember.person.last_name=e}),placeholder:"Last",class:"block w-1/2",onInput:t[3]||(t[3]=function(){return _.getSuggestedPeople&&_.getSuggestedPeople.apply(_,arguments)}),errors:V.errors.last_name},null,40,l),[[n["vModelText"],V.newMember.person.last_name]])])]})),_:1},8,["errors"]),Object(n["createVNode"])(N,{label:"Email",modelValue:V.newMember.person.email,"onUpdate:modelValue":t[4]||(t[4]=function(e){return V.newMember.person.email=e}),placeholder:"example@example.com","input-class":"w-full",onInput:_.getSuggestedPeople,errors:V.errors.email},null,8,["modelValue","onInput","errors"])])),V.newMember.id||V.newMember.person_id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",u,[Object(n["createVNode"])(y,{label:"Name"},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(V.newMember.person.first_name)+" "+Object(n["toDisplayString"])(V.newMember.person.last_name),1)]})),_:1}),Object(n["createVNode"])(y,{label:"Email"},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(V.newMember.person.email),1)]})),_:1}),V.newMember.id?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createBlock"])(E,{key:0},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(" Adding existing person, "+Object(n["toDisplayString"])(V.newMember.person.name)+", as a group member. ",1)]})),_:1}))])):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(N,{label:"Expertise",errors:V.errors.expertise},{default:Object(n["withCtx"])((function(){return[Object(n["withDirectives"])(Object(n["createElementVNode"])("textarea",{rows:"5","onUpdate:modelValue":t[5]||(t[5]=function(e){return V.newMember.expertise=e}),class:"w-full"},null,512),[[n["vModelText"],V.newMember.expertise]])]})),_:1},8,["errors"]),Object(n["createVNode"])(N,{label:"Notes",errors:V.errors.notes},{default:Object(n["withCtx"])((function(){return[Object(n["withDirectives"])(Object(n["createElementVNode"])("textarea",{rows:"5","onUpdate:modelValue":t[6]||(t[6]=function(e){return V.newMember.notes=e}),class:"w-full"},null,512),[[n["vModelText"],V.newMember.notes]])]})),_:1},8,["errors"]),Object(n["createVNode"])(y,{label:""},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(C,{modelValue:V.newMember.is_contact,"onUpdate:modelValue":t[7]||(t[7]=function(e){return V.newMember.is_contact=e}),label:"Receives notifications about group"},null,8,["modelValue"])]})),_:1}),Object(n["createElementVNode"])("div",d,[m,Object(n["createElementVNode"])("div",b,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(o.roles,(function(r){return Object(n["openBlock"])(),Object(n["createBlock"])(C,{key:r.id,modelValue:V.newMember.roles,"onUpdate:modelValue":t[8]||(t[8]=function(e){return V.newMember.roles=e}),value:r,label:e.titleCase(r.name)},null,8,["modelValue","value","label"])})),128))]),Object(n["createVNode"])(n["Transition"],{name:"fade-down"},{default:Object(n["withCtx"])((function(){return[V.newMember.hasRole("biocurator")&&o.group.isVcep()?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",p,[f,(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])([1,2],(function(e){return Object(n["createVNode"])(C,{key:e,modelValue:V.newMember["training_level_".concat(e)],"onUpdate:modelValue":function(t){return V.newMember["training_level_".concat(e)]=t},value:1,label:"Level ".concat(e)},null,8,["modelValue","onUpdate:modelValue","label"])})),64))])):Object(n["createCommentVNode"])("",!0)]})),_:1})]),Object(n["createVNode"])(P,{class:"border-t mt-4 pt-2"},{title:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("h3",g,[v,V.newMember.permissions.length>0?(Object(n["openBlock"])(),Object(n["createBlock"])(S,{key:0,color:"gray"},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(V.newMember.permissions.length),1)]})),_:1})):Object(n["createCommentVNode"])("",!0)])]})),default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",h,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(o.permissions,(function(e){return Object(n["openBlock"])(),Object(n["createBlock"])(C,{key:e.id,modelValue:V.newMember.permissions,"onUpdate:modelValue":t[9]||(t[9]=function(e){return V.newMember.permissions=e}),value:e,disabled:V.newMember.hasPermissionThroughRole(e),checked:V.newMember.hasPermissionThroughRole(e),id:"permission-".concat(e.id),title:V.newMember.hasPermissionThroughRole(e)?"granted with role":"grant permission",label:e.name},null,8,["modelValue","value","disabled","checked","id","title","label"])})),128))]),Object(n["createElementVNode"])("div",w,[Object(n["createElementVNode"])("div",O,[j,Object(n["createVNode"])(C,{label:"Not granted"}),Object(n["createVNode"])(C,{checked:"",label:"Granted"}),Object(n["createVNode"])(C,{checked:"",disabled:"",label:"Granted w/ role"})]),x])]})),_:1})]),Object(n["createVNode"])(n["Transition"],{name:"slide-fade"},{default:Object(n["withCtx"])((function(){return[V.suggestedPeople.length>0&&null===V.newMember.person_id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",k,[M,Object(n["createVNode"])(B,{suggestions:V.suggestedPeople,onSelected:_.useExistingPerson},null,8,["suggestions","onSelected"])])):Object(n["createCommentVNode"])("",!0)]})),_:1})]),Object(n["createVNode"])(I,{onSubmit:_.save,onCancel:_.cancel,"submit-text":"Save"},null,8,["onSubmit","onCancel"])])}var _=r("1da1"),N=(r("96cf"),r("4de4"),r("0481"),r("a630"),r("3ca3"),r("d3b7"),r("6062"),r("ddb0"),r("d81d"),r("caad"),r("2532"),r("159b"),r("4a91")),y=r("5502"),E=r("86ed"),C=["onClick"];function S(e,t,r,o,i,s){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(r.suggestions,(function(t){return Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t.uuid,class:"flex justify-between my-2"},[Object(n["renderSlot"])(e.$slots,"default",{},(function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.name)+" ",1),Object(n["createElementVNode"])("button",{class:"btn btn-xs",onClick:function(e){return s.useSuggestion(t)}}," Add as member ",8,C)]}))])})),128))])])}var P={name:"ComponentName",props:{suggestions:{required:!0,type:Array}},emits:["selected"],data:function(){return{}},computed:{},methods:{useSuggestion:function(e){this.$emit("selected",e)}}};P.render=S;var B=P,I=r("033d"),R={name:"AddMemberForm",components:{MemberSuggestions:B},props:{uuid:{required:!0,type:String},memberId:{required:!1,default:null}},emits:["saved","canceled","closed"],data:function(){return{newMember:new E["a"],errors:{},suggestedPeople:[]}},computed:{originalMember:function(){return this.group.findMember(this.memberId)},nameErrors:function(){return[this.errors.first_name,this.errors.last_name].flat().filter((function(e){return e}))}},setup:function(){var e=Object(y["d"])(),t=Object(n["computed"])((function(){return e.getters["groups/currentItemOrNew"]||{}})),r=Object(n["computed"])((function(){return e.getters["people/all"]||{}})),o=N["groups"].roles,i=N["groups"].permissions;return{group:t,people:r,roles:o,permissions:i}},watch:{group:function(){this.syncMember()}},methods:{getSuggestedPeople:function(){var e=this,t=this.people.filter((function(t){return t.matchesKeyword(e.newMember.person.first_name)||t.matchesKeyword(e.newMember.person.last_name)||t.matchesKeyword(e.newMember.person.email)})).filter((function(t){return!e.isAlreadyMember(t)}));this.suggestedPeople=Array.from(new Set(t))},initNewMember:function(){this.newMember=new E["a"]},syncMember:function(){try{this.memberId&&(this.newMember=this.originalMember.clone())}catch(e){this.group.isPersisted()&&alert(e)}},clearForm:function(){this.initNewMember()},cancel:function(){this.clearForm(),this.$emit("canceled")},save:function(){var e=this;return Object(_["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.newMember.isPersisted()){t.next=8;break}if(e.newMember.person.isPersisted()){t.next=5;break}return t.next=5,e.inviteNewMember(e.group,e.newMember);case 5:if(!e.newMember.person.isPersisted()){t.next=8;break}return t.next=8,e.addPersonAsMember(e.group,e.newMember);case 8:if(!e.newMember.isPersisted()){t.next=11;break}return t.next=11,e.updateExistingMember(e.group,e.newMember);case 11:e.clearForm(),e.$emit("saved"),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](0),Object(I["a"])(t.t0)&&(e.errors=t.t0.response.data.errors);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},inviteNewMember:function(e,t){var r=this;return Object(_["a"])(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.$store.dispatch("groups/memberInvite",{uuid:e.uuid,data:{firstName:t.person.first_name,lastName:t.person.last_name,email:t.person.email,roleIds:t.roles.map((function(e){return e.id})),isContact:t.is_contact,expertise:t.expertise,notes:t.notes,training_level_1:t.training_level_1,training_level_2:t.training_level_2}});case 3:if(o=n.sent,!(t.permissions.length>0)){n.next=7;break}return n.next=7,r.$store.dispatch("groups/memberGrantPermission",{uuid:e.uuid,memberId:o.data.id,permissionIds:t.permissions.map((function(e){return e.id}))});case 7:n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](0),Object(I["a"])(n.t0)&&(r.errors=n.t0.response.data.errors);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})))()},addPersonAsMember:function(e,t){var r=this;return Object(_["a"])(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.$store.dispatch("groups/memberAdd",{uuid:e.uuid,personId:t.person_id,roleIds:t.roles.map((function(e){return e.id})),isContact:t.is_contact,expertise:t.expertise,notes:t.notes,training_level_1:t.training_level_1,training_level_2:t.training_level_2});case 3:if(o=n.sent,!(t.permissions.length>0)){n.next=7;break}return n.next=7,r.$store.dispatch("groups/memberGrantPermission",{uuid:e.uuid,memberId:o.id,permissionIds:t.permissions.map((function(e){return e.id}))});case 7:n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](0),Object(I["a"])(n.t0)&&(r.errors=n.t0.response.data.errors);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})))()},updateExistingMember:function(e,t){var r=this;return Object(_["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.$store.dispatch("groups/memberUpdate",{groupUuid:e.uuid,memberId:t.id,data:{is_contact:r.newMember.is_contact,expertise:r.newMember.expertise,notes:r.newMember.notes,training_level_1:r.newMember.training_level_1,training_level_2:r.newMember.training_level_2}});case 2:return n.next=4,r.$store.dispatch("groups/memberSyncRoles",{group:e,member:t});case 4:return n.next=6,r.syncPermissions(e,t);case 6:case"end":return n.stop()}}),n)})))()},syncPermissions:function(e,t){var r=this;return Object(_["a"])(regeneratorRuntime.mark((function n(){var o,i,s,c,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o=e.findMember(r.memberId),i=o.permissions.map((function(e){return e.id})),s=t.permissions.map((function(e){return e.id})),c=s.filter((function(e){return!i.includes(e)})),a=i.filter((function(e){return!s.includes(e)})),c.length>0&&r.$store.dispatch("groups/memberGrantPermission",{uuid:e.uuid,memberId:t.id,permissionIds:c}),a.forEach((function(n){r.$store.dispatch("groups/memberRevokePermission",{uuid:e.uuid,memberId:t.id,permissionId:n})}));case 7:case"end":return n.stop()}}),n)})))()},useExistingPerson:function(e){this.newMember.person_id=e.id,this.newMember.person=e.clone()},isAlreadyMember:function(e){return this.group.members.map((function(e){return e.person.id})).includes(e.id)}},mounted:function(){this.$store.dispatch("people/getAll",{}),this.initNewMember(),this.syncMember()}};r("7d27");R.render=V,R.__scopeId="data-v-5d5e0015";t["default"]=R},6062:function(e,t,r){"use strict";var n=r("6d61"),o=r("6566");e.exports=n("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),o)},6566:function(e,t,r){"use strict";var n=r("9bf2").f,o=r("7c73"),i=r("e2cc"),s=r("0366"),c=r("19aa"),a=r("2266"),l=r("7dd0"),u=r("2626"),d=r("83ab"),m=r("f1839").fastKey,b=r("69f3"),p=b.set,f=b.getterFor;e.exports={getConstructor:function(e,t,r,l){var u=e((function(e,n){c(e,u,t),p(e,{type:t,index:o(null),first:void 0,last:void 0,size:0}),d||(e.size=0),void 0!=n&&a(n,e[l],{that:e,AS_ENTRIES:r})})),b=f(t),g=function(e,t,r){var n,o,i=b(e),s=v(e,t);return s?s.value=r:(i.last=s={index:o=m(t,!0),key:t,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=s),n&&(n.next=s),d?i.size++:e.size++,"F"!==o&&(i.index[o]=s)),e},v=function(e,t){var r,n=b(e),o=m(t);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==t)return r};return i(u.prototype,{clear:function(){var e=this,t=b(e),r=t.index,n=t.first;while(n)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete r[n.index],n=n.next;t.first=t.last=void 0,d?t.size=0:e.size=0},delete:function(e){var t=this,r=b(t),n=v(t,e);if(n){var o=n.next,i=n.previous;delete r.index[n.index],n.removed=!0,i&&(i.next=o),o&&(o.previous=i),r.first==n&&(r.first=o),r.last==n&&(r.last=i),d?r.size--:t.size--}return!!n},forEach:function(e){var t,r=b(this),n=s(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:r.first){n(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!v(this,e)}}),i(u.prototype,r?{get:function(e){var t=v(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),d&&n(u.prototype,"size",{get:function(){return b(this).size}}),u},setStrong:function(e,t,r){var n=t+" Iterator",o=f(t),i=f(n);l(e,t,(function(e,t){p(this,{type:n,target:e,state:o(e),kind:t,last:void 0})}),(function(){var e=i(this),t=e.kind,r=e.last;while(r&&r.removed)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),u(t)}}},"6d61":function(e,t,r){"use strict";var n=r("23e7"),o=r("da84"),i=r("94ca"),s=r("6eeb"),c=r("f1839"),a=r("2266"),l=r("19aa"),u=r("861d"),d=r("d039"),m=r("1c7e"),b=r("d44e"),p=r("7156");e.exports=function(e,t,r){var f=-1!==e.indexOf("Map"),g=-1!==e.indexOf("Weak"),v=f?"set":"add",h=o[e],w=h&&h.prototype,O=h,j={},x=function(e){var t=w[e];s(w,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(g&&!u(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!u(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!u(e))&&t.call(this,0===e?0:e)}:function(e,r){return t.call(this,0===e?0:e,r),this})},k=i(e,"function"!=typeof h||!(g||w.forEach&&!d((function(){(new h).entries().next()}))));if(k)O=r.getConstructor(t,e,f,v),c.enable();else if(i(e,!0)){var M=new O,V=M[v](g?{}:-0,1)!=M,_=d((function(){M.has(1)})),N=m((function(e){new h(e)})),y=!g&&d((function(){var e=new h,t=5;while(t--)e[v](t,t);return!e.has(-0)}));N||(O=t((function(t,r){l(t,O,e);var n=p(new h,t,O);return void 0!=r&&a(r,n[v],{that:n,AS_ENTRIES:f}),n})),O.prototype=w,w.constructor=O),(_||y)&&(x("delete"),x("has"),f&&x("get")),(y||V)&&x(v),g&&w.clear&&delete w.clear}return j[e]=O,n({global:!0,forced:O!=h},j),b(O,e),g||r.setStrong(O,e,f),O}},"7d27":function(e,t,r){"use strict";r("b2ee")},b2ee:function(e,t,r){},bb2f:function(e,t,r){var n=r("d039");e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},f1839:function(e,t,r){var n=r("23e7"),o=r("d012"),i=r("861d"),s=r("5135"),c=r("9bf2").f,a=r("241c"),l=r("057f"),u=r("90e3"),d=r("bb2f"),m=!1,b=u("meta"),p=0,f=Object.isExtensible||function(){return!0},g=function(e){c(e,b,{value:{objectID:"O"+p++,weakData:{}}})},v=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,b)){if(!f(e))return"F";if(!t)return"E";g(e)}return e[b].objectID},h=function(e,t){if(!s(e,b)){if(!f(e))return!0;if(!t)return!1;g(e)}return e[b].weakData},w=function(e){return d&&m&&f(e)&&!s(e,b)&&g(e),e},O=function(){j.enable=function(){},m=!0;var e=a.f,t=[].splice,r={};r[b]=1,e(r).length&&(a.f=function(r){for(var n=e(r),o=0,i=n.length;o<i;o++)if(n[o]===b){t.call(n,o,1);break}return n},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:l.f}))},j=e.exports={enable:O,fastKey:v,getWeakData:h,onFreeze:w};o[b]=!0}}]);
//# sourceMappingURL=new-contact-form.1d31f843.js.map