"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[377],{796:function(e,t,a){a.d(t,{sO:function(){return i}});var r=a(953),s=a(8751),o=a(7684);const i=(0,r.KR)({}),u=(0,r.KR)(!1),l=()=>{u.value=!1,i.value={}},n=async({method:e,url:t,data:a})=>{try{return await(0,o.A)({method:e,url:t,data:a}).then((e=>e.data.data))}catch(r){(0,s.A)(r)&&(i.value={...i,...r.response.data.errors})}},p=()=>{i.value={}};t.Ay=()=>({errors:i,editing:u,hideForm:l,submitFormData:n,resetErrors:p})},8461:function(e,t,a){a.d(t,{A:function(){return V}});var r=a(641),s=a(33),o=a(3751);const i={key:0},u={key:0},l=(0,r.eW)(" Affiliation ID "),n=(0,r.eW)("admin-only"),p={key:0},d={key:1,class:"text-gray-400"},m={key:1},h={key:2},g=(0,r.eW)(" Status: "),_=(0,r.eW)("admin-only"),c=(0,r.eW)(" Parent group: "),b=(0,r.eW)("admin-only");function f(e,t,a,f,y,v){const k=(0,r.g2)("input-row"),C=(0,r.g2)("dictionary-row"),F=(0,r.g2)("note");return(0,r.uX)(),(0,r.CE)("div",null,[v.canSetType?((0,r.uX)(),(0,r.Wv)(k,{key:0,modelValue:v.group.group_type_id,"onUpdate:modelValue":t[0]||(t[0]=e=>v.group.group_type_id=e),errors:f.errors.group_type_id,type:"select",options:v.typeOptions,label:"Type"},null,8,["modelValue","errors","options"])):((0,r.uX)(),(0,r.Wv)(C,{key:1,label:"Type"},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(this.group?.type?.display_name),1)])),_:1})),(0,r.bF)(o.eB,{name:"slide-fade-down",mode:"out-in"},{default:(0,r.k6)((()=>[v.group.group_type_id>2&&v.group.expert_panel?((0,r.uX)(),(0,r.CE)("div",i,[(0,r.bF)(k,{label:"Long Base Name",modelValue:v.group.expert_panel.long_base_name,"onUpdate:modelValue":[t[1]||(t[1]=e=>v.group.expert_panel.long_base_name=e),v.emitUpdate],placeholder:"Long base name",errors:f.errors.long_base_name,"input-class":"w-full"},null,8,["modelValue","onUpdate:modelValue","errors"]),(0,r.bF)(k,{label:"Short Base Name",modelValue:v.group.expert_panel.short_base_name,"onUpdate:modelValue":[t[2]||(t[2]=e=>v.group.expert_panel.short_base_name=e),v.emitUpdate],placeholder:"Short base name",errors:f.errors.short_base_name,"input-class":"w-full"},null,8,["modelValue","onUpdate:modelValue","errors"]),e.hasAnyPermission(["groups-manage"])?((0,r.uX)(),(0,r.CE)("div",u,[(0,r.bF)(k,{label:"Affiliation ID",modelValue:v.group.expert_panel.affiliation_id,"onUpdate:modelValue":[t[3]||(t[3]=e=>v.group.expert_panel.affiliation_id=e),v.emitUpdate],placeholder:v.affiliationIdPlaceholder,errors:f.errors.affiliation_id,"input-class":"w-full"},{label:(0,r.k6)((()=>[l,(0,r.bF)(F,null,{default:(0,r.k6)((()=>[n])),_:1})])),_:1},8,["modelValue","placeholder","errors","onUpdate:modelValue"])])):((0,r.uX)(),(0,r.Wv)(C,{key:1,label:"Affiliation ID"},{default:(0,r.k6)((()=>[v.group.expert_panel.affiliation_id?((0,r.uX)(),(0,r.CE)("span",p,(0,s.v_)(v.group.expert_panel.affiliation_id),1)):((0,r.uX)(),(0,r.CE)("span",d,(0,s.v_)("Not yet assigend")))])),_:1}))])):((0,r.uX)(),(0,r.CE)("div",m,[(0,r.bF)(k,{modelValue:v.group.name,"onUpdate:modelValue":[t[4]||(t[4]=e=>v.group.name=e),v.emitUpdate],placeholder:"Name",label:"Name","input-class":"w-full",errors:f.errors.name},null,8,["modelValue","errors","onUpdate:modelValue"])]))])),_:1}),e.hasPermission("groups-manage")?((0,r.uX)(),(0,r.CE)("div",h,[(0,r.bF)(k,{modelValue:v.group.group_status_id,"onUpdate:modelValue":[t[5]||(t[5]=e=>v.group.group_status_id=e),v.emitUpdate],type:"select",options:v.statusOptions,errors:f.errors.group_status_id},{label:(0,r.k6)((()=>[g,(0,r.bF)(F,null,{default:(0,r.k6)((()=>[_])),_:1})])),_:1},8,["modelValue","options","errors","onUpdate:modelValue"]),(0,r.bF)(k,{modelValue:v.group.parent_id,"onUpdate:modelValue":[t[6]||(t[6]=e=>v.group.parent_id=e),v.emitUpdate],type:"select",options:v.parentOptions,errors:f.errors.parent_id},{label:(0,r.k6)((()=>[c,(0,r.bF)(F,null,{default:(0,r.k6)((()=>[b])),_:1})])),_:1},8,["modelValue","options","errors","onUpdate:modelValue"])])):(0,r.Q3)("",!0)])}a(1339),a(3725),a(9838),a(5019);var y=a(2543),v=a(696),k=a(367),C=a(7752),F=a(796),w={name:"GroupForm",emits:["canceled","saved","update"],data(){return{groupTypes:C.groups.types,groupStatuses:C.groups.statuses,newGroup:new k.A,parents:[]}},computed:{group:{get(){const e=this.$store.getters["groups/currentItem"];return e||this.newGroup},set(e){try{this.$store.commit("groups/addItem",e)}catch(t){this.newGroup=e}}},statusOptions(){return Object.values(this.groupStatuses).map((e=>({value:e.id,label:this.titleCase(e.name)})))},typeOptions(){return Object.values(this.groupTypes).map((e=>({value:e.id,label:e.display_name})))},canSetType(){return this.hasPermission("groups-manage")&&!this.group.id},affiliationIdPlaceholder(){return 5e4},cdwgs(){return this.$store.getters["cdwgs/all"]},namesDirty(){return this.group.expert_panel.isDirty("long_base_name")||this.group.expert_panel.isDirty("short_base_name")},affiliationIdDirty(){return this.group.expert_panel.isDirty("affiliation_id")},parentOptions(){const e=[{value:0,label:"None"}];return this.parents.filter((e=>e.type.can_be_parent)).forEach((t=>{e.push({value:t.id,label:t.displayName})})),(0,y.sortBy)(e,"label")}},methods:{async save(){this.resetErrors();try{if(this.group.id)return await this.updateGroup(),void this.$emit("saved");const e=await this.createGroup().then((e=>e.data.data));this.$emit("saved"),this.$store.commit("pushSuccess","Group created."),this.$router.push({name:"AddMember",params:{uuid:e.uuid}})}catch(e){throw(0,v.Ah)(e)&&(this.errors=e.response.data.errors),e}},createGroup(){let{name:e,parent_id:t,group_type_id:a,group_status_id:r}=this.group.attributes;const{short_base_name:s}=this.group.expert_panel;return null===e&&this.group.expert_panel&&(e=this.group.expert_panel.long_base_name),this.$store.dispatch("groups/create",{name:e,parent_id:t,group_type_id:a,group_status_id:r,short_base_name:s})},updateGroup(){const e=[];return e.push(this.saveGroupData()),this.group.expert_panel&&e.push(this.saveEpData()),Promise.all(e)},saveGroupData(){const e=[];return this.group.isDirty("parent_id")&&e.push(this.saveParent()),this.group.isDirty("name")&&e.push(this.saveName()),this.group.isDirty("group_status_id")&&e.push(this.saveStatus()),Promise.all(e)},async saveEpData(){const e=[];if(this.namesDirty){const{long_base_name:t,short_base_name:a}=this.group.expert_panel;e.push(this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/expert-panel/name`,data:{long_base_name:t,short_base_name:a}}))}return this.affiliationIdDirty&&e.push(this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/expert-panel/affiliation-id`,data:{affiliation_id:this.group.expert_panel.affiliation_id}})),await Promise.all(e)},isDirty(e){return this.group[e]!=this.group[e]},saveParent(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/parent`,data:{parent_id:this.group.parent_id}})},saveName(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/name`,data:{name:this.group.name}})},saveStatus(){return this.submitFormData({method:"put",url:`/api/groups/${this.group.uuid}/status`,data:{status_id:this.group.group_status_id}})},resetData(){this.group.uuid&&this.$store.dispatch("groups/find",this.group.uuid)},cancel(){this.group.uuid&&this.resetData(),this.$emit("canceled")},async getParentOptions(){const e={"where[group_type_id]":[1,2],without:["coordinators","expertPanel"]};this.parents=await v.FH.get("/api/groups",{params:e}).then((e=>e.data.filter((e=>e.id!=this.group.id)).map((e=>new k.A(e)))))},emitUpdate(){this.$emit("update")}},beforeMount(){this.getParentOptions(),this.$store.dispatch("cdwgs/getAll")},setup(e,t){const{errors:a,submitFormData:r,resetErrors:s}=(0,F.Ay)(e,t);return{errors:a,submitFormData:r,resetErrors:s}}},D=a(6262);const x=(0,D.A)(w,[["render",f]]);var V=x},3990:function(e,t,a){a.r(t),a.d(t,{default:function(){return w}});a(3725),a(5019);var r=a(641),s=a(3751),o=a(33);const i={class:"flex justify-between items-center"},u=(0,r.eW)(" Groups "),l={key:0,class:"text-center w-full"},n={key:1},p={class:"mb-2"},d=(0,r.eW)(" Filter: "),m={key:0},h={key:0},g={key:0};function _(e,t,a,_,c,b){const f=(0,r.g2)("badge"),y=(0,r.g2)("router-link"),v=(0,r.g2)("data-table"),k=(0,r.g2)("tab-item"),C=(0,r.g2)("tabs-container"),F=(0,r.g2)("group-form"),w=(0,r.g2)("submission-wrapper"),D=(0,r.g2)("modal-dialog"),x=(0,r.gN)("remaining-height");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("h1",i,[u,e.hasPermission("groups-manage")?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-xs",onClick:t[0]||(t[0]=(...e)=>b.startCreateGroup&&b.startCreateGroup(...e))},"Create a group")):(0,r.Q3)("",!0)]),(0,r.bF)(C,{onTabChanged:b.getGroupsForType},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(_.tabDefinitions,(e=>((0,r.uX)(),(0,r.Wv)(k,{label:e.label,key:e.label},{default:(0,r.k6)((()=>[c.loading?((0,r.uX)(),(0,r.CE)("div",l,"Loading...")):((0,r.uX)(),(0,r.CE)("div",n,[(0,r.Lk)("div",p,[d,(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>_.filterString=e),placeholder:"name,id,status,coordinator name"},null,512),[[s.Jo,_.filterString]])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{data:_.filteredGroups.filter(e.filter),fields:c.fields,sort:c.sort,"onUpdate:sort":t[3]||(t[3]=e=>c.sort=e),"row-click-handler":_.goToGroup,"row-class":"cursor-pointer active:bg-blue-100"},{"cell-displayStatus":(0,r.k6)((({item:e})=>[(0,r.bF)(f,{class:"text-xs",color:e.statusColor},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(e.displayStatus),1),1==e.status.id&&e.is_ep?((0,r.uX)(),(0,r.CE)("span",m," - "+(0,o.v_)(e.expert_panel.currentStepAbbr),1)):(0,r.Q3)("",!0)])),_:2},1032,["color"])])),"cell-coordinators":(0,r.k6)((({value:e})=>[0==e.length?((0,r.uX)(),(0,r.CE)("div",h)):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e,((e,a)=>((0,r.uX)(),(0,r.CE)("span",{key:e.id},[a>0?((0,r.uX)(),(0,r.CE)("span",g,", ")):(0,r.Q3)("",!0),(0,r.bF)(y,{to:{name:"PersonDetail",params:{uuid:e.person.uuid}},class:"link",onClick:t[2]||(t[2]=(0,s.D$)((()=>{}),["stop"]))},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(e.person.name),1)])),_:2},1032,["to"])])))),128))])),_:2},1032,["data","fields","sort","row-click-handler"])),[[x]])]))])),_:2},1032,["label"])))),128))])),_:1},8,["onTabChanged"]),(0,r.bF)(D,{modelValue:c.showCreateForm,"onUpdate:modelValue":t[8]||(t[8]=e=>c.showCreateForm=e),title:"Create a New Group",size:"sm"},{default:(0,r.k6)((()=>[(0,r.bF)(w,{onSubmitted:t[6]||(t[6]=t=>e.$refs.groupForm.save()),onCanceled:t[7]||(t[7]=t=>e.$refs.groupForm.cancel())},{default:(0,r.k6)((()=>[(0,r.bF)(F,{ref:"groupForm",onCanceled:t[4]||(t[4]=e=>c.showCreateForm=!1),onSaved:t[5]||(t[5]=e=>c.showCreateForm=!1)},null,512)])),_:1})])),_:1},8,["modelValue"])])}a(2598);var c=a(6278),b=a(6166),f=a(953),y=a(8461),v=a(1533),k={name:"ComponentName",components:{GroupForm:y.A,SubmissionWrapper:v.A},props:{},data(){return{loading:!1,showCreateForm:!1,loadedFor:{VCEPs:!1,GCEPs:!1,CDWGs:!1,WGs:!1},sort:{field:"id",desc:!1},fields:[{name:"id",label:"ID",sortable:!0},{name:"name",label:"Name",sortable:!0,resolveValue:e=>e.displayName},{name:"coordinators",sortable:!1},{name:"displayStatus",sortable:!0,label:"status"}]}},methods:{startCreateGroup(){this.showCreateForm=!0},async getGroupsForType(e){const t=this.tabDefinitions.find((t=>t.label===e));this.loadedFor[e]||(this.loading=!0,await this.$store.dispatch("groups/getItems",{where:{group_type_id:t.typeId}}),this.loadedFor[e]=!0,this.loading=!1)}},setup(){const e=(0,c.Pj)(),t=(0,b.rd)(),a=(0,r.EW)((()=>{const e=[{label:"VCEPs",typeId:4,filter:e=>e.is_vcep_or_scvcep},{label:"GCEPs",typeId:3,filter:e=>e.is_gcep},{label:"CDWGs",typeId:2,filter:e=>e.isCdwg()},{label:"WGs",typeId:1,filter:e=>e.isWg()}];return e})),s=(0,f.KR)(null),o=(0,r.EW)((()=>e.getters["groups/all"])),i=(0,r.EW)((()=>o.value.filter((e=>{if(!s.value)return!0;const t=new RegExp(`.*${s.value}.*`,"i");return e.name&&e.name.match(t)||e.displayName&&e.displayName.match(t)||e.expert_panel&&e.expert_panel.full_short_base_name&&e.expert_panel.full_short_base_name.match(t)||e.id==s.value||e.status.name.match(t)||e.expert_panel&&e.expert_panel.currentStepName&&e.expert_panel.currentStepName.match(t)||e.coordinators.filter((e=>e.person.name.match(t))).length>0})))),u=e=>{t.push({name:"GroupDetail",params:{uuid:e.uuid}})};return{filterString:s,groups:o,filteredGroups:i,tabDefinitions:a,goToItem:u,goToGroup:u}}},C=a(6262);const F=(0,C.A)(k,[["render",_]]);var w=F}}]);
//# sourceMappingURL=group-list.40fe4c9c.js.map