"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[937],{4582:function(e,t,r){r.d(t,{A:function(){return i}});r(3725),r(5019);var a=r(6166),n=r(641);function i(e=null){const t=(0,a.rd)(),r=(0,a.lq)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const i=(0,n.EW)({immediate:!0,get(){return Object.keys(r.query).includes("sort-field")?{field:r.query["sort-field"],desc:Boolean(parseInt(r.query["sort-desc"]))}:e},set(e){const a={"sort-field":e.field,"sort-desc":e.desc?1:0},n={...r.query,...a};t.replace({path:r.path,query:n})}}),o=(0,n.EW)({set(e){let a=r.query,n=r.path,i={...a};e?i={...a,filter:e}:delete i.filter,t.replace({path:n,query:i})},get(){return r.query.filter},immediate:!0});return{sort:i,filter:o}}},1886:function(e,t,r){r.r(t),r.d(t,{default:function(){return L}});r(3725),r(5019);var a=r(641),n=r(3751),i=r(33);const o={class:"flex justify-between items-center"},l=(0,a.Lk)("h1",null,"Expertises",-1),s=(0,a.eW)(" Filter: "),d=(0,a.Lk)("button",{class:"btn btn-xs"},"â€¦",-1),u=(0,a.eW)("Edit"),c=(0,a.eW)("Delete"),m={key:0},h=(0,a.Lk)("p",null,"You cannot delete an expertise people are using.",-1),p=(0,a.Lk)("p",null,"Either edit this this expertise or remove all people that have claimed it as an expertise.",-1),b=[h,p],f={key:1};function C(e,t,r,h,p,C){const g=(0,a.g2)("dropdown-item"),v=(0,a.g2)("dropdown-menu"),w=(0,a.g2)("data-table"),k=(0,a.g2)("ExpertiseUpdateForm"),y=(0,a.g2)("modal-dialog"),I=(0,a.g2)("button-row"),x=(0,a.g2)("ExpertiseCreateForm");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("div",o,[l,(0,a.Lk)("button",{class:"btn btn-sm",onClick:t[0]||(t[0]=e=>p.showCreateDialog=!0)},"Add Expertise")]),(0,a.bF)(w,{paginated:"",data:C.filteredItems,fields:p.fields,sort:h.sort,"onUpdate:sort":t[2]||(t[2]=e=>h.sort=e),"reset-page-on-data-change":!1},{header:(0,a.k6)((()=>[(0,a.Lk)("label",null,[s,(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>h.filter=e)},null,512),[[n.Jo,h.filter]])])])),"cell-actions":(0,a.k6)((({item:e})=>[(0,a.bF)(v,{"hide-cheveron":""},{label:(0,a.k6)((()=>[d])),default:(0,a.k6)((()=>[(0,a.bF)(g,{onClick:t=>C.edit(e)},{default:(0,a.k6)((()=>[u])),_:2},1032,["onClick"]),(0,a.bF)(g,{onClick:t=>C.initDelete(e)},{default:(0,a.k6)((()=>[c])),_:2},1032,["onClick"])])),_:2},1024)])),_:1},8,["data","fields","sort"]),((0,a.uX)(),(0,a.Wv)(a.Im,{to:"body"},[(0,a.bF)(y,{modelValue:p.showEditDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>p.showEditDialog=e),title:`Edit ${p.currentItem.name}`},{default:(0,a.k6)((()=>[(0,a.bF)(k,{modelValue:p.currentItem,"onUpdate:modelValue":t[3]||(t[3]=e=>p.currentItem=e),onSaved:C.handleSaved,onCanceled:C.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,a.bF)(y,{modelValue:p.showDeleteConfirmation,"onUpdate:modelValue":t[6]||(t[6]=e=>p.showDeleteConfirmation=e),title:"Delete Expertise",size:"sm"},{default:(0,a.k6)((()=>[p.currentItem.people_count>0?((0,a.uX)(),(0,a.CE)("div",m,b)):((0,a.uX)(),(0,a.CE)("div",f,[(0,a.eW)(" You are about to delete the "+(0,i.v_)(p.currentItem.name)+" ",1),(0,a.bF)(I,{"submit-text":"Delete",onSubmitted:C.deleteItem,onCanceled:t[5]||(t[5]=e=>p.showDeleteConfirmation=!1)},null,8,["onSubmitted"])]))])),_:1},8,["modelValue"]),(0,a.bF)(y,{modelValue:p.showCreateDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>p.showCreateDialog=e),title:"Add a New Expertise."},{default:(0,a.k6)((()=>[(0,a.bF)(x,{onSaved:C.handleSaved,onCanceled:C.handleCancel},null,8,["onSaved","onCanceled"])])),_:1},8,["modelValue"])]))])}var g=r(4582);function v(e,t,r,n,i,o){const l=(0,a.g2)("input-row"),s=(0,a.g2)("button-row");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(l,{label:"Name",modelValue:n.workingCopy.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.workingCopy.name=e),errors:i.errors.name},null,8,["modelValue","errors"]),(0,a.bF)(s,{"submit-text":"Save",onSubmitted:o.save,onCancel:o.cancel},null,8,["onSubmitted","onCancel"])])}var w=r(5169),k=r(696),y={name:"InstitutionCreateForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","saved","canceled"],data(){return{errors:{}}},methods:{async save(){try{this.initErrors();const e=await this.$store.dispatch("expertises/update",this.workingCopy).then((e=>e.data));this.$emit("update:modelValue",e),this.$emit("saved",e)}catch(e){(0,k.Ah)(e)&&(this.errors=e.response.data.errors)}},cancel(){this.$emit("canceled"),this.initInstitution()},initErrors(){this.errors={}}},setup(e,t){const{workingCopy:r}=(0,w.L5)(e,t);return{workingCopy:r}}},I=r(6262);const x=(0,I.A)(y,[["render",v]]);var E=x,D=r(953),V=r(6278),F={__name:"ExpertiseCreateForm",props:{starterString:{type:String,required:!1}},emits:["saved","canceled"],setup(e,{emit:t}){const r=e,n=(0,V.Pj)(),i=(0,D.KR)({}),o=(0,D.KR)(null);(0,a.wB)((()=>r.starterString),(e=>{o.value=e}));const l=async()=>{try{const e=await n.dispatch("expertises/create",{name:o.value}).then((e=>e.data));o.value=null,t("saved",e)}catch(e){(0,k.Ah)(e)&&(i.value=e.response.data.errors)}},s=()=>{o.value=null,t("canceled")};return(e,t)=>{const r=(0,a.g2)("input-row"),n=(0,a.g2)("button-row");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(r,{label:"Name",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),errors:i.value.name},null,8,["modelValue","errors"]),(0,a.bF)(n,{onSubmitted:l,onCancel:s,"submit-text":"Create Credential"})])}}};const S=F;var _=S,$={name:"CredentialList",components:{ExpertiseUpdateForm:E,ExpertiseCreateForm:_},data(){return{fields:[{name:"id",label:"ID",type:Number,sortable:!0,class:"w-12"},{name:"name",type:String,sortable:!0},{name:"people_count",label:"# People",type:Number,sortable:!0},{name:"actions",label:"",sortable:!1}],currentItem:{},showCreateDialog:!1,showEditDialog:!1,showDeleteConfirmation:!1}},computed:{items(){return this.$store.getters["expertises/items"]},filteredItems(){if(!this.filter)return this.items;const e=new RegExp(`.*${this.filter}.*`,"i");return this.items.filter((t=>t.name.match(e)||t.abbreviation&&t.abbreviation.match(e)||t.country&&t.country.name.match(e)))},currentIndex(){return this.items.findIndex((e=>e.id==this.currentItem.id))}},methods:{edit(e){this.showEditDialog=!0,this.currentItem=e},handleSaved(){this.showCreateDialog=!1,this.showEditDialog=!1,this.updateItem(),this.$store.commit("pushSuccess","Expertise saved.")},handleCancel(){this.showCreateDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},updateItem(){this.currentItem.id&&this.currentIndex>-1&&(this.items[this.currentIndex]={...this.currentItem})},initDelete(e){this.showDeleteConfirmation=!0,this.currentItem=e},async deleteItem(){if(this.currentItem.id){this.currentItem.people_count>0&&alert("You cannot delete this expertise because it is in use.  Please edit the expertise or remove it from all people using it.");try{await this.$store.dispatch("expertises/delete",this.currentItem),this.showDeleteConfirmation=!1,this.$store.commit("pushSuccess",`${this.currentItem.name} deleted.`)}catch(e){throw console.error(e),e}}}},setup(){const{sort:e,filter:t}=(0,g.A)({field:"name",desc:!1});return{sort:e,filter:t}},mounted(){this.$store.dispatch("expertises/getItems")}};const q=(0,I.A)($,[["render",C]]);var L=q}}]);
//# sourceMappingURL=expertise-list.689611e9.js.map