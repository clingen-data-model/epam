"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[700],{2790:function(e,t,o){o.d(t,{Z:function(){return l}});o(6699);var i=o(2119),n=o(6252);function l(e=null){const t=(0,i.tv)(),o=(0,i.yj)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const l=(0,n.Fl)({immediate:!0,get(){return Object.keys(o.query).includes("sort-field")?{field:o.query["sort-field"],desc:Boolean(parseInt(o.query["sort-desc"]))}:e},set(e){const i={"sort-field":e.field,"sort-desc":e.desc?1:0},n={...o.query,...i};t.replace({path:o.path,query:n})}}),r=(0,n.Fl)({set(e){let i=o.query,n=o.path,l={...i};e?l={...i,filter:e}:delete l.filter,t.replace({path:n,query:l})},get(){return o.query.filter},immediate:!0});return{sort:l,filter:r}}},3046:function(e,t,o){o.r(t),o.d(t,{default:function(){return Y}});var i=o(6252),n=o(9963),l=o(3577);const r=(0,i._)("h1",null,"Institutions",-1),a=(0,i.Uk)(" Filter: "),s=(0,i._)("button",{class:"btn btn-xs"},"â€¦",-1),u=(0,i.Uk)("Edit"),d=(0,i.Uk)("Approve"),m=(0,i.Uk)("Merge into another"),c=(0,i.Uk)("Delete"),h={key:0},p=(0,i._)("p",null,"You cannot delete an institution people are using.",-1),w=(0,i._)("p",null,"Either edit this this institution or merge it into another.",-1),b=[p,w],g={key:1};function f(e,t,o,p,w,f){const v=(0,i.up)("dropdown-item"),I=(0,i.up)("dropdown-menu"),y=(0,i.up)("data-table"),C=(0,i.up)("institution-approval-form"),V=(0,i.up)("modal-dialog"),k=(0,i.up)("institution-update-form"),D=(0,i.up)("institution-merge-form"),U=(0,i.up)("button-row");return(0,i.wg)(),(0,i.iD)("div",null,[r,(0,i.Wm)(y,{paginated:"",data:f.filteredItems,fields:w.fields,sort:p.sort,"onUpdate:sort":t[1]||(t[1]=e=>p.sort=e),"reset-page-on-data-change":!1},{header:(0,i.w5)((()=>[(0,i._)("label",null,[a,(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>p.filter=e)},null,512),[[n.nr,p.filter]])])])),"cell-actions":(0,i.w5)((({item:e})=>[(0,i.Wm)(I,{"hide-cheveron":""},{label:(0,i.w5)((()=>[s])),default:(0,i.w5)((()=>[(0,i.Wm)(v,{onClick:t=>f.edit(e)},{default:(0,i.w5)((()=>[u])),_:2},1032,["onClick"]),(0,i.Wm)(v,{onClick:t=>f.initApprove(e)},{default:(0,i.w5)((()=>[d])),_:2},1032,["onClick"]),(0,i.Wm)(v,{onClick:t=>f.initMerge(e)},{default:(0,i.w5)((()=>[m])),_:2},1032,["onClick"]),(0,i.Wm)(v,{onClick:t=>f.initDelete(e)},{default:(0,i.w5)((()=>[c])),_:2},1032,["onClick"])])),_:2},1024)])),_:1},8,["data","fields","sort"]),((0,i.wg)(),(0,i.j4)(i.lR,{to:"body"},[(0,i.Wm)(V,{modelValue:w.showApproveDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>w.showApproveDialog=e),title:`Approve ${w.currentItem.name}`},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{modelValue:w.currentItem,"onUpdate:modelValue":t[2]||(t[2]=e=>w.currentItem=e),onSaved:f.handleSaved,onCanceled:f.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,i.Wm)(V,{modelValue:w.showEditDialog,"onUpdate:modelValue":t[5]||(t[5]=e=>w.showEditDialog=e),title:`Edit ${w.currentItem.name}`},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{modelValue:w.currentItem,"onUpdate:modelValue":t[4]||(t[4]=e=>w.currentItem=e),onSaved:f.handleSaved,onCanceled:f.handleCancel},null,8,["modelValue","onSaved","onCanceled"])])),_:1},8,["modelValue","title"]),(0,i.Wm)(V,{modelValue:w.showMergeDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>w.showMergeDialog=e),title:"Merge Institutions"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{obsoletes:[w.currentItem],onSaved:f.handleMerge,onCanceled:t[6]||(t[6]=e=>w.showMergeDialog=!1)},null,8,["obsoletes","onSaved"])])),_:1},8,["modelValue"]),(0,i.Wm)(V,{modelValue:w.showDeleteConfirmation,"onUpdate:modelValue":t[9]||(t[9]=e=>w.showDeleteConfirmation=e),title:"Delete Institution",size:"sm"},{default:(0,i.w5)((()=>[w.currentItem.people_count>0?((0,i.wg)(),(0,i.iD)("div",h,b)):((0,i.wg)(),(0,i.iD)("div",g,[(0,i.Uk)(" You are about to delete the "+(0,l.zw)(w.currentItem.name)+" ",1),(0,i.Wm)(U,{"submit-text":"Delete",onSubmitted:f.deleteItem,onCanceled:t[8]||(t[8]=e=>w.showDeleteConfirmation=!1)},null,8,["onSubmitted"])]))])),_:1},8,["modelValue"])]))])}var v=o(2790),I=o(8171);const y=(0,i.Uk)(" Are you sure you want to approve this institution? ");function C(e,t,o,n,r,a){const s=(0,i.up)("dictionary-row"),u=(0,i.up)("button-row");return(0,i.wg)(),(0,i.iD)("div",null,[y,(0,i.Wm)(s,{label:"Name"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(o.modelValue.name),1)])),_:1}),(0,i.Wm)(s,{label:"Abbreviation"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(o.modelValue.abbreviation||"--"),1)])),_:1}),(0,i.Wm)(s,{label:"URL"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(o.modelValue.url||"--"),1)])),_:1}),(0,i.Wm)(s,{label:"Country"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(o.modelValue.country?o.modelValue.country.name:"--"),1)])),_:1}),(0,i.Wm)(s,{label:"Reportable"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(o.modelValue.reportable?"Yes":"No"),1)])),_:1}),(0,i.Wm)(u,{"submit-text":"Approve",onSubmitted:a.approve,onCancel:a.cancelApproval},null,8,["onSubmitted","onCancel"])])}var V={name:"ComponentName",props:{modelValue:{type:Object,required:!0}},emits:["saved","canceled","update:modelValue"],methods:{async approve(){const e=await(0,I.xp)(this.modelValue);this.$emit("update:modelValue",e),this.$emit("saved",e)},cancelApproval(){this.$emit("canceled")}}},k=o(3744);const D=(0,k.Z)(V,[["render",C]]);var U=D;function _(e,t,o,n,l,r){const a=(0,i.up)("data-form"),s=(0,i.up)("button-row");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(a,{fields:n.fields,errors:l.errors,modelValue:n.workingCopy,"onUpdate:modelValue":t[0]||(t[0]=e=>n.workingCopy=e)},null,8,["fields","errors","modelValue"]),(0,i.Wm)(s,{"submit-text":"Save",onSubmitted:r.save,onCancel:r.cancel},null,8,["onSubmitted","onCancel"])])}var W=o(1076),S=o(9028),M={name:"InstitutionCreateForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","saved","canceled"],data(){return{errors:{}}},methods:{async save(){try{this.initErrors();const e=await this.updateInstitution(this.workingCopy);this.$emit("update:modelValue",e),this.$emit("saved",e)}catch(e){(0,S.z1)(e)&&(this.errors=e.response.data.errors)}},cancel(){this.$emit("canceled"),this.initInstitution()},initErrors(){this.errors={}}},setup(e,t){const{workingCopy:o}=(0,W.kM)(e,t);return{fields:I.XU,getCountries:I.ox,countries:I.hW,updateInstitution:I.TK,workingCopy:o}},mounted(){this.getCountries()}};const A=(0,k.Z)(M,[["render",_]]);var x=A;const $=(0,i._)("p",{class:"mb-8"},[(0,i.Uk)(" Merging institutions will do the following: "),(0,i._)("ol",{class:"list-decimal ml-6"},[(0,i._)("li",null,"Transfer all people with the obsolete institution to the authoritiative institution."),(0,i._)("li",null,"Delete the obsolete institution.")])],-1),E=(0,i.Uk)(" Merge "),q=(0,i.Uk)("(Obsolete institution that will be deleted)"),z=(0,i.Uk)("Into "),F=(0,i.Uk)("(Authoritative institution)");function j(e,t,o,n,l,r){const a=(0,i.up)("note"),s=(0,i.up)("institution-search-select"),u=(0,i.up)("input-row"),d=(0,i.up)("button-row");return(0,i.wg)(),(0,i.iD)("div",null,[$,(0,i.Wm)(u,{label:"Merge",vertical:""},{label:(0,i.w5)((()=>[E,(0,i.Wm)(a,{class:"inline-block"},{default:(0,i.w5)((()=>[q])),_:1})])),default:(0,i.w5)((()=>[(0,i.Wm)(s,{"model-value":l.obsoleteIds,"onUpdate:modelValue":r.handleObsoleteUpdate,"allow-add":!1},null,8,["model-value","onUpdate:modelValue"])])),_:1}),(0,i.Wm)(u,{label:"Into",errors:l.errors.authority_id,vertical:""},{label:(0,i.w5)((()=>[z,(0,i.Wm)(a,{class:"inline"},{default:(0,i.w5)((()=>[F])),_:1})])),default:(0,i.w5)((()=>[(0,i.Wm)(s,{modelValue:l.authorityId,"onUpdate:modelValue":t[0]||(t[0]=e=>l.authorityId=e),"allow-add":!1},null,8,["modelValue"])])),_:1},8,["errors"]),(0,i.Wm)(d,{"submit-text":"Merge",onSubmitted:r.commitMerge,onCanceled:r.cancelMerge},null,8,["onSubmitted","onCanceled"])])}var O={name:"InstitutionMergeForm",props:{authority:{type:Object,required:!1},obsoletes:{type:Array,default:()=>[]}},emits:["saved","canceled"],data(){return{authorityId:null,obsoleteIds:[],errors:{}}},watch:{authority:{immediate:!0,handler(e){e&&(this.authorityId=e.id)}},obsoletes:{immediate:!0,deep:!0,handler(e){this.obsoleteIds=e.map((e=>e.id))}}},methods:{handleObsoleteUpdate(e){this.obsoleteIds=e?[e]:[]},async commitMerge(){try{this.errors={},await(0,I.EP)(this.authorityId,this.obsoleteIds),this.authorityId=null,this.obsoleteIds=[],this.$emit("saved")}catch(e){(0,S.z1)(e)&&(this.errors=e.response.data.errors)}},cancelMerge(){this.authorityId=null,this.obsoleteIds=[],this.$emit("canceled")}}};const Z=(0,k.Z)(O,[["render",j]]);var N=Z,P={name:"InstitutionList",components:{InstitutionUpdateForm:x,InstitutionApprovalForm:U,InstitutionMergeForm:N},data(){return{items:[],fields:[{name:"id",label:"ID",type:Number,sortable:!0},{name:"name",type:String,sortable:!0},{name:"abbreviation",type:String,sortable:!0},{name:"country.name",label:"Country",type:String,sortable:!0},{name:"people_count",label:"# People",type:Number,sortable:!0},{name:"approved",type:Boolean,sortable:!0,resolveValue(e){return e.approved?"Approved":null},resolveSort(e){return e.approved}},{name:"actions",label:"",sortable:!1}],currentItem:{country:{}},showApproveDialog:!1,showEditDialog:!1,showMergeDialog:!1,showDeleteConfirmation:!1}},computed:{filteredItems(){if(!this.filter)return this.items;const e=new RegExp(`.*${this.filter}.*`,"i");return this.items.filter((t=>t.name.match(e)||t.abbreviation&&t.abbreviation.match(e)||t.country&&t.country.name.match(e)))},currentIndex(){return this.items.findIndex((e=>e.id==this.currentItem.id))}},methods:{edit(e){this.showEditDialog=!0,this.currentItem=e},initApprove(e){this.showApproveDialog=!0,this.currentItem=e},initMerge(e){this.currentItem=e,this.showMergeDialog=!0},async getInstitutions(){console.log("**Get institutions"),this.items=await(0,I.iE)()},handleSaved(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}},this.$store.commit("pushSuccess","Institution saved.")},handleCancel(){this.showApproveDialog=!1,this.showEditDialog=!1,this.updateItem(),this.currentItem={country:{}}},handleMerge(){console.log("handle merge"),this.items.splice(this.currentIndex,1),this.showMergeDialog=!1,console.log("handled merge"),this.$store.commit("pushSuccess","Institution merged.")},updateItem(){this.currentItem.id&&this.currentIndex>-1&&(this.items[this.currentIndex]={...this.currentItem})},initDelete(e){this.showDeleteConfirmation=!0,this.currentItem=e},async deleteItem(){this.currentItem.id&&(this.currentItem.people_count>0&&alert("You cannot delete an institution because it is in use.  Pelaes edit the institution or merge it into another."),await(0,I.m4)(this.currentItem),this.items.splice(this.currentIndex,1),this.showDeleteConfirmation=!1,this.$store.commit("pushSuccess",`${this.currentItem.name} deleted.`))}},setup(){const{sort:e,filter:t}=(0,v.Z)({field:"name",desc:!1});return{sort:e,filter:t}},mounted(){this.getInstitutions()}};const R=(0,k.Z)(P,[["render",f]]);var Y=R}}]);
//# sourceMappingURL=institution-list.9c24dde7.js.map