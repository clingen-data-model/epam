"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[106],{4582:function(e,s,t){t.d(s,{A:function(){return a}});t(3725),t(5019);var r=t(6166),i=t(641);function a(e=null){const s=(0,r.rd)(),t=(0,r.lq)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const a=(0,i.EW)({immediate:!0,get(){return Object.keys(t.query).includes("sort-field")?{field:t.query["sort-field"],desc:Boolean(parseInt(t.query["sort-desc"]))}:e},set(e){const r={"sort-field":e.field,"sort-desc":e.desc?1:0},i={...t.query,...r};s.replace({path:t.path,query:i})}}),l=(0,i.EW)({set(e){let r=t.query,i=t.path,a={...r};e?a={...r,filter:e}:delete a.filter,s.replace({path:i,query:a})},get(){return t.query.filter},immediate:!0});return{sort:a,filter:l}}},3606:function(e,s,t){t.r(s),t.d(s,{default:function(){return R}});var r=t(641),i=t(33);const a=(0,r.Lk)("h2",{class:"mt-8 mb-2"},"Memberships",-1),l=(0,r.Lk)("h3",{class:"border-b mb-1"},"Roles",-1),o={class:"flex flex-wrap"},n=(0,r.Lk)("h3",{class:"border-b mb-1"},"Permissions",-1),d={class:"flex flex-wrap"},m={class:"px-2 py-1 mb-2 mt-4 bg-gray-100 border relative text-xs"},u={class:"flex space-x-2"},c=(0,r.Lk)("strong",null,"Legend: ",-1),h=(0,r.Lk)("div",{class:"absolute top-0 left-0 w-full h-full bg-pink-500 opacity-0"}," ",-1);function p(e,s,t,p,b,f){const g=(0,r.g2)("object-dictionary"),y=(0,r.g2)("data-table"),k=(0,r.g2)("checkbox"),v=(0,r.g2)("button-row"),R=(0,r.g2)("modal-dialog");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("h1",null,(0,i.v_)(b.user.person.name||"loading..."),1),(0,r.bF)(g,{obj:f.userInfo},null,8,["obj"]),f.canEditUser?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn btn-xs",onClick:s[0]||(s[0]=(...e)=>f.initEdit&&f.initEdit(...e))},"Edit system roles & permissions")):(0,r.Q3)("",!0),a,(0,r.bF)(y,{fields:b.membershipFields,data:f.membershipInfo},null,8,["fields","data"]),((0,r.uX)(),(0,r.Wv)(r.Im,{to:"body"},[(0,r.bF)(R,{modelValue:b.showEditForm,"onUpdate:modelValue":s[3]||(s[3]=e=>b.showEditForm=e),title:"Edit System Roles & Permissions"},{default:(0,r.k6)((()=>[l,(0,r.Lk)("ul",o,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(f.availableSystemRoles,(t=>((0,r.uX)(),(0,r.CE)("li",{key:t.id,class:"w-1/3 h-12"},[(0,r.bF)(k,{modelValue:b.checkedRoles,"onUpdate:modelValue":s[1]||(s[1]=e=>b.checkedRoles=e),label:e.titleCase(t.display_name),value:t.id},null,8,["modelValue","label","value"])])))),128))]),n,(0,r.Lk)("ul",d,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(f.availableSystemPermissions,(t=>((0,r.uX)(),(0,r.CE)("li",{key:t.id,class:"w-1/3 h-12"},[f.checkedRolePermissionIds.includes(t.id)?((0,r.uX)(),(0,r.Wv)(k,{key:0,modelValue:!0,disabled:!0,label:t.display_name},null,8,["label"])):((0,r.uX)(),(0,r.Wv)(k,{key:1,modelValue:b.checkedPermissions,"onUpdate:modelValue":s[2]||(s[2]=e=>b.checkedPermissions=e),label:e.titleCase(t.display_name),value:t.id},null,8,["modelValue","label","value"]))])))),128))]),(0,r.Lk)("div",m,[(0,r.Lk)("div",u,[c,(0,r.bF)(k,{label:"Not granted"}),(0,r.bF)(k,{value:1,modelValue:!0,label:"Granted"}),(0,r.bF)(k,{value:2,modelValue:!0,disabled:"",label:"Granted w/ role"})]),h]),(0,r.bF)(v,{"submit-text":"Save",onSubmitted:f.saveRolesAndPermissions,onCanceled:f.closeEditForm},null,8,["onSubmitted","onCanceled"])])),_:1},8,["modelValue"])]))])}t(1339),t(3725),t(5019);var b=t(8577),f=t(696),g=t(7752),y={name:"UserDetail",props:{id:{require:!0}},data(){return{user:new b.A,membershipFields:[{name:"id"},{name:"group"},{name:"roles"},{name:"extra_permissions"}],showEditForm:!1,systemRoles:[],systemPermissions:Object.values(g.system.permissions),configs:g,checkedRoles:[],checkedPermissions:[]}},computed:{userInfo(){return{name:this.user.person.name,email:this.user.person.email,roles:this.user.roles.map((e=>e.name)).join(", "),additional_permissions:this.user.permissions.map((e=>e.name)).join(", "),registered:this.formatDate(this.user.created_at)}},membershipInfo(){return this.user.person.memberships.map((e=>({id:e.id,group:e.group.display_name,roles:e.roles.map((e=>e.name)).join(", "),extra_permissions:e.permissions.map((e=>e.name)).join(", ")||"",is_contact:e.is_contact?"Yes":"No"})))},checkedRolePermissionIds(){if(!this.systemRoles)return[];const e=this.systemRoles.filter((e=>this.checkedRoles.includes(e.id))).map((e=>e.permissions)).flat().map((e=>e.id));return[...new Set(e)]},availableSystemRoles(){return this.systemRoles.filter((e=>!!this.hasRole("super-user")||!!this.hasRole("super-admin")&&"super-user"!==e.name))},availableSystemPermissions(){return this.systemPermissions.filter((e=>!!this.hasRole("super-user")||!!this.hasRole("super-admin")&&"logs-view"!==e.name))},canEditUser(){const e=this.$store.getters.currentUser;return!!this.hasPermission("users-manage")&&(!!this.currentUserIsUser||(!!e.hasRole("super-user")||!(!e.hasRole("super-admin")||!this.user.hasRole("admin")&&!this.user.hasNoRole())))},currentUserIsUser(){return this.$store.getters.currentUser.id==this.user.id}},watch:{id:{immediate:!0,handler(){this.getUser()}}},methods:{async getUser(){this.user=await f.FH.get(`/api/users/${this.id}`).then((e=>new b.A(e.data))),this.resetCheckedRolesAndPermissions()},resetCheckedRolesAndPermissions(){this.checkedRoles=this.user.roles.map((e=>e.id)),this.checkedPermissions=this.user.permissions.map((e=>e.id))},async getSystemRoles(){this.systemRoles=await f.FH.get("/api/roles").then((e=>e.data))},initEdit(){this.showEditForm=!0},async saveRolesAndPermissions(){const e={role_ids:this.checkedRoles,permission_ids:this.checkedPermissions};await f.FH.put(`/api/users/${this.user.id}/roles-and-permissions`,e),this.showEditForm=!1,this.getUser()},closeEditForm(){this.resetCheckedRolesAndPermissions(),this.showEditForm=!1}},mounted(){this.getSystemRoles()}},k=t(6262);const v=(0,k.A)(y,[["render",p]]);var R=v},466:function(e,s,t){t.r(s),t.d(s,{default:function(){return p}});t(3725),t(5019);var r=t(641),i=t(3751);const a=(0,r.Lk)("h1",null,"Users",-1),l=(0,r.eW)("Filter:  ");function o(e,s,t,o,n,d){const m=(0,r.g2)("data-table");return(0,r.uX)(),(0,r.CE)("div",null,[a,(0,r.bF)(m,{fields:n.fields,data:d.getUsers,sort:o.sort,"onUpdate:sort":s[1]||(s[1]=e=>o.sort=e),onRowClick:d.goToUser,"row-class":"cursor-pointer",ref:"dataTable",paginated:""},{header:(0,r.k6)((()=>[(0,r.Lk)("div",null,[l,(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=e=>o.filter=e),placeholder:"name, email"},null,512),[[i.Jo,o.filter]])])])),_:1},8,["fields","data","sort","onRowClick"])])}t(1339);var n=t(696),d=t(2425),m=t(4582),u={name:"ComponentName",props:{},data(){return{users:[],fields:[{name:"id",type:Number,sortable:!0},{name:"person.name",label:"Name",type:String,sortable:!0},{name:"person.email",label:"Email",type:String,sortable:!0},{name:"roles",label:"System Roles",type:String,sortable:!1,resolveValue(e){return e.roles.map((e=>e.display_name)).join(", ")}},{name:"permissions",label:"+ Permissions",type:String,sortable:!1,resolveValue(e){return e.permissions.map((e=>e.display_name)).join(", ")},class:"text-xs"}]}},computed:{filteredUsers(){if(!this.filter)return this.users;const e=new RegExp(`.*${this.filter}.*`,"i");return this.users.filter((s=>s.person.name.match(e)||s.person.email.match(e)))}},watch:{filter:{immediate:!0,handler(){this.triggerSearch&&this.triggerSearch()}},sort:{immediate:!0,handler(){this.triggerSearch&&this.triggerSearch()}}},methods:{async getUsers(e,s,t,r){const i={page:e,page_size:s,"sort[field]":t.field.name,"sort[dir]":t.desc?"DESC":"ASC","where[filterString]":this.filter,with:["roles","permissions"],paginated:!0},a=await n.FH.get("/api/users",{params:i}).then((e=>e.data));return r(a.meta.total),a.data},goToUser(e){this.$router.push({name:"UserDetail",params:{id:e.id}})}},setup(){const{sort:e,filter:s}=(0,m.A)({field:"person.name",desc:!1});return{sort:e,filter:s}},created(){this.triggerSearch=(0,d.A)((()=>this.$refs.dataTable.getItems()),500)}},c=t(6262);const h=(0,c.A)(u,[["render",o]]);var p=h}}]);
//# sourceMappingURL=user-management.8bc3ffbd.js.map