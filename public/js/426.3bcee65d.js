"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[309,426],{6932:function(e,t,l){l.d(t,{Jd:function(){return s},KB:function(){return p},W8:function(){return u},l8:function(){return i},wn:function(){return d}});var o=l(953),n=l(641),a=l(7684);const r=(0,o.KR)([]),s=(0,n.EW)((()=>r.value)),i=async e=>{r.value=await a.A.get(e).then((e=>e.data.data))},d=async(e,t)=>await a.A.post(e,t).then((e=>(r.value.push(e.data),e.data))),u=async(e,t)=>await a.A.put(e,t).then((e=>{const t=r.value.findIndex((t=>t.id==e.data.id));return r.value[t]=e.data,e.data})),p=async(e,t)=>await a.A.delete(`${e}/${t}`).then((e=>{const l=r.value.findIndex((e=>e.id==t));return r.value.splice(l,1),e}))},415:function(e,t,l){l.d(t,{A:function(){return I}});var o=l(641);const n={key:0,class:"px-3 py-2 rounded border border-gray-300 text-gray-500 bg-gray-200"},a={key:0,class:"flex space-x-1"},r=["onClick"],s=["onClick"],i=["innerHTML"];function d(e,t,l,d,u,p){const c=(0,o.g2)("icon-edit"),m=(0,o.g2)("icon-trash"),g=(0,o.g2)("data-table"),b=(0,o.g2)("log-entry-form"),h=(0,o.g2)("modal-dialog"),y=(0,o.g2)("activity-log-delete-confirmation");return(0,o.uX)(),(0,o.CE)("div",null,[d.hasLogEntries?((0,o.uX)(),(0,o.Wv)(g,{key:1,fields:d.fields,data:l.logEntries,sort:d.sort,"onUpdate:sort":t[0]||(t[0]=e=>d.sort=e)},{"cell-id":(0,o.k6)((({item:t})=>[e.hasPermission("groups-manage")?((0,o.uX)(),(0,o.CE)("div",a,[(0,o.Lk)("button",{class:"btn btn-xs inline-block",onClick:e=>d.editLogEntry(t)},[(0,o.bF)(c,{width:"12"})],8,r),null===t.activity_type?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:e=>d.confirmDelete(t),class:"btn btn-xs inline-block"},[(0,o.bF)(m,{width:"12"})],8,s)):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)])),"cell-description":(0,o.k6)((({item:e})=>[(0,o.Lk)("div",{innerHTML:e.description,class:"links-blue"},null,8,i)])),_:1},8,["fields","data","sort"])):((0,o.uX)(),(0,o.CE)("div",n," No log entries to display ")),(0,o.bF)(h,{modelValue:d.editingEntry,"onUpdate:modelValue":t[1]||(t[1]=e=>d.editingEntry=e),title:"Edit log entry"},{default:(0,o.k6)((()=>[(0,o.bF)(b,{"log-entry":d.selectedEntry,"api-url":l.apiUrl,onSaved:d.closeEntryForm,onCanceled:d.closeEntryForm},null,8,["log-entry","api-url","onSaved","onCanceled"])])),_:1},8,["modelValue"]),(0,o.bF)(h,{modelValue:d.showDeleteConfirmation,"onUpdate:modelValue":t[2]||(t[2]=e=>d.showDeleteConfirmation=e),title:"Delete this log entry?"},{default:(0,o.k6)((()=>[(0,o.bF)(y,{logEntry:d.selectedEntry,"api-url":l.apiUrl,onCanceled:d.closeDeleteConfirmation,onDeleted:d.closeDeleteConfirmation},null,8,["logEntry","api-url","onCanceled","onDeleted"])])),_:1},8,["modelValue"])])}var u=l(953),p=l(6278),c=l(5079),m=l(1606),g=l(6932),b={__name:"ActivityLogEntryForm",props:{logEntry:{required:!1,default:()=>({log_date:(new Date).toISOString(),step:null,entry:""})},apiUrl:{required:!0,type:String}},emits:["saved"],setup(e,{emit:t}){const l=e,n=(0,p.Pj)(),a=(0,u.KR)({log_date:(new Date).toISOString(),step:null,entry:""}),r=(0,u.KR)({}),s=(0,o.EW)((()=>n.getters["groups/currentItemOrNew"])),i=e=>{e&&e.created_at&&(a.value={id:e.id,log_date:new Date(Date.parse(e.created_at)).toISOString(),step:e.step,entry:e.description})},d=()=>{a.value={log_date:(new Date).toISOString(),step:null,entry:""}},b=async()=>{try{a.value.id?await(0,g.W8)(`${l.apiUrl}/${a.value.id}`,a.value):await(0,g.wn)(l.apiUrl,a.value),await(0,g.l8)(l.apiUrl),d(),t("saved",a.value)}catch(e){if(e.response&&422==e.response.status&&e.response.data.errors)return void(r.value=e.response.data.errors)}},h=()=>{d(),t("canceled")};return(0,o.wB)((()=>l.logEntry),(e=>{i(e)}),{immediate:!0}),(e,t)=>{const l=(0,o.g2)("input-row"),n=(0,o.g2)("button-row"),i=(0,o.g2)("form-container");return(0,o.uX)(),(0,o.Wv)(i,{class:"log-entry-form",ref:"form-container"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{label:"Log Date",modelValue:a.value.log_date,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.log_date=e),errors:r.value.log_date,type:"date",ref:"logdate"},null,8,["modelValue","errors"]),(0,u.R1)(s).isVcep()?((0,o.uX)(),(0,o.Wv)(m["default"],{key:0,errors:r.value.step,modelValue:a.value.step,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.step=e)},null,8,["errors","modelValue"])):(0,o.Q3)("",!0),(0,o.bF)(l,{label:"Entry",errors:r.value.entry},{default:(0,o.k6)((()=>[(0,o.bF)(c["default"],{modelValue:a.value.entry,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.entry=e)},null,8,["modelValue"])])),_:1},8,["errors"]),(0,o.bF)(n,null,{default:(0,o.k6)((()=>[(0,o.Lk)("button",{class:"btn",onClick:h},"Cancel"),(0,o.Lk)("button",{class:"btn blue",onClick:b},"Save")])),_:1})])),_:1},512)}}};const h=b;var y=h,v=l(33);const f=(0,o.Lk)("p",null,"You are about to delete the following log entry:",-1),k={class:"border-y py-2"},L=["innerHTML"],C={key:0,class:"ml-4 mt-2 mb-4 text-gray-700 text-sm"},w=(0,o.Lk)("div",null,"This can not be undone. Are you sure you want to continue?",-1),E={key:0,class:"bg-red-200 text-red-900 rounded p-2 my-2"};function _(e,t,l,n,a,r){const s=(0,o.g2)("button-row");return(0,o.uX)(),(0,o.CE)("div",null,[f,(0,o.Lk)("div",k,[(0,o.Lk)("blockquote",null,[(0,o.Lk)("div",{innerHTML:l.logEntry.description},null,8,L)]),l.logEntry.causer?((0,o.uX)(),(0,o.CE)("div",C,"Logged by "+(0,v.v_)(l.logEntry.causer.name)+", "+(0,v.v_)(n.logDate),1)):(0,o.Q3)("",!0)]),w,n.flattenedErrors.length>0?((0,o.uX)(),(0,o.CE)("div",E,[(0,o.Lk)("ul",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.flattenedErrors,((e,t)=>((0,o.uX)(),(0,o.CE)("li",{key:t},(0,v.v_)(e),1)))),128))])])):(0,o.Q3)("",!0),(0,o.bF)(s,{onCanceled:t[0]||(t[0]=t=>e.$emit("canceled")),onSubmitted:n.deleteLogEntry,submitText:"Delete Log Entry"},null,8,["onSubmitted"])])}var F=l(1877),D=l(8751),M={name:"ConfirmDeleteLogEntry",props:{logEntry:{required:!0,type:Object},apiUrl:{required:!0,type:String}},emits:["deleted","canceled"],setup(e,t){const l=(0,u.KR)({}),n=(0,o.EW)((()=>(0,F.Yq)(e.logEntry.log_date))),a=(0,o.EW)((()=>Object.values(l.value).flat())),r=async()=>{try{await(0,g.KB)(e.apiUrl,e.logEntry.id),t.emit("deleted"),await(0,g.l8)(e.apiUrl)}catch(o){if((0,D.A)(o))return void(l.value=o.response.data.errors);l.value={a:o.message}}};return{errors:l,logDate:n,flattenedErrors:a,deleteLogEntry:r}}},V=l(6262);const x=(0,V.A)(M,[["render",_]]);var P=x;const S=[{name:"created_at",label:"Date & Time",sortName:"created_at",sortable:!0,resolveValue({created_at:e}){return e?(0,F.Yq)(e):null},type:Date,colspan:2,class:"w-16"},{name:"created_at",label:"Time",sortName:"created_at",hideHeader:!0,sortable:!1,resolveValue({created_at:e}){return e?(0,F.fU)(e):null},class:"w-28",type:Date},{name:"description",label:"Entry",sortable:!0,type:String},{name:"causer.name",label:"User",sortable:!0},{name:"id",label:"",sortable:!1}];var W={components:{LogEntryForm:y,ActivityLogDeleteConfirmation:P},props:{logEntries:{required:!0,type:Array},apiUrl:{required:!0,type:String}},setup(e){const t=(0,u.KR)({field:"created_at",desc:!0}),l=(0,u.KR)({}),n=(0,u.KR)(!1),a=(0,u.KR)(!1),r=(0,o.EW)((()=>e.logEntries.length>0)),s=e=>{n.value=!0,l.value=e},i=()=>{n.value=!1,l.value={}},d=e=>{l.value=e,a.value=!0},p=()=>{a.value=!1,l.value={}};return{fields:(0,u.KR)(S),sort:t,selectedEntry:l,editingEntry:n,hasLogEntries:r,editLogEntry:s,closeEntryForm:i,showDeleteConfirmation:a,confirmDelete:d,closeDeleteConfirmation:p}}};const A=(0,V.A)(W,[["render",d]]);var I=A},8962:function(e,t,l){l.r(t),l.d(t,{default:function(){return ce}});var o=l(641),n=l(33);const a={class:"pb-4"},r={class:"flex space-x-4"},s={class:"flex-1"},i=(0,o.eW)("People"),d={class:"flex justify-between items-center"},u=(0,o.Lk)("h2",null,"Groups",-1),p=(0,o.Lk)("h2",null,"Profile",-1),c={class:"flex space-x-4 items-center"},m={class:"flex space-x-4 items-center"},g=(0,o.Lk)("h2",null,"Log Entries",-1),b={class:"border my-4 p-4 bg-red-100 border-red-200 rounded"},h=(0,o.Lk)("h2",{class:"mb-4 text-red-800"}," Here be dragons. Proceed with caution. ",-1),y=(0,o.Lk)("p",null,"You are about to delete this person. All related data will also be deleted including:",-1),v=(0,o.Lk)("ul",{class:"list-disc pl-6"},[(0,o.Lk)("li",null,"User record, system roles, and system permissions (if account is activated)"),(0,o.Lk)("li",null,"Invite"),(0,o.Lk)("li",null,"Group Memberships and group roles (if any)")],-1),f=(0,o.Lk)("div",{class:"border my-4 px-2 py-1 font-bold bg-red-100 border-red-200 rounded text-red-800"}," This cannot be undone. ",-1);function k(e,t,l,k,L,C){const w=(0,o.g2)("profile-picture"),E=(0,o.g2)("router-link"),_=(0,o.g2)("note"),F=(0,o.g2)("icon-edit"),D=(0,o.g2)("dictionary-row"),M=(0,o.g2)("membership-list"),V=(0,o.g2)("tab-item"),x=(0,o.g2)("person-profile"),P=(0,o.g2)("demographics-form"),S=(0,o.g2)("coi-list"),W=(0,o.g2)("refresh-button"),A=(0,o.g2)("person-mail-log"),I=(0,o.g2)("activity-log"),$=(0,o.g2)("tabs-container"),U=(0,o.g2)("router-view"),X=(0,o.g2)("modal-dialog"),R=(0,o.g2)("button-row"),T=(0,o.g2)("person-merge-form");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("header",a,[(0,o.Lk)("div",r,[(0,o.bF)(w,{person:e.person,style:{width:"155px"},class:"rounded-lg"},null,8,["person"]),(0,o.Lk)("div",s,[(0,o.bF)(E,{class:"note",to:"/people"},{default:(0,o.k6)((()=>[i])),_:1}),(0,o.Lk)("h1",d,[(0,o.Lk)("div",null,[(0,o.eW)((0,n.v_)(e.person.name)+" ",1),(0,o.bF)(_,null,{default:(0,o.k6)((()=>[(0,o.eW)("ID: "+(0,n.v_)(e.person.id),1)])),_:1})]),e.hasPermission("people-manage")||e.userIsPerson(e.person)||e.coordinatesPerson(e.person)?((0,o.uX)(),(0,o.Wv)(E,{key:0,to:`/people/${l.uuid}/edit`,class:"btn btn-xs flex-grow-0"},{default:(0,o.k6)((()=>[(0,o.bF)(F,{width:"16",heigh:"16"})])),_:1},8,["to"])):(0,o.Q3)("",!0)]),(0,o.bF)(D,{label:"Email","label-class":"w-24 font-bold"},{default:(0,o.k6)((()=>[(0,o.eW)((0,n.v_)(e.person.email),1)])),_:1}),(0,o.bF)(D,{label:"Institution","label-class":"w-24 font-bold"},{default:(0,o.k6)((()=>[(0,o.eW)((0,n.v_)(e.person.institution?e.person.institution.name:null),1)])),_:1})])])]),(0,o.bF)($,null,{default:(0,o.k6)((()=>[(0,o.bF)(V,{label:"groups"},{default:(0,o.k6)((()=>[u,(0,o.bF)(M,{person:e.person},null,8,["person"])])),_:1}),(0,o.bF)(V,{label:"Info"},{default:(0,o.k6)((()=>[p,(0,o.bF)(x,{person:e.person},null,8,["person"])])),_:1}),(0,o.bF)(V,{label:"Demographics",visible:e.hasRole("super-admin")||e.userIsPerson(e.person)},{default:(0,o.k6)((()=>[(0,o.bF)(P,{person:e.person},null,8,["person"])])),_:1},8,["visible"]),(0,o.bF)(V,{label:"Conflict of Interest"},{default:(0,o.k6)((()=>[(0,o.bF)(S,{person:e.person},null,8,["person"])])),_:1}),(0,o.bF)(V,{label:"Email Log",visible:e.hasPermission("people-manage")||e.userIsPerson(e.person)||e.coordinatesPerson(e.person)},{default:(0,o.k6)((()=>[(0,o.Lk)("header",c,[(0,o.Lk)("h2",null,"Mail sent to "+(0,n.v_)(e.person.first_name),1),(0,o.bF)(W,{loading:L.mailLoading,onClick:C.getMailLog},null,8,["loading","onClick"])]),(0,o.bF)(A,{person:e.person,mail:C.sortedMailLog},null,8,["person","mail"])])),_:1},8,["visible"]),(0,o.bF)(V,{label:"Log",visible:e.hasPermission("people-manage")||e.coordinatesPerson(e.person)},{default:(0,o.k6)((()=>[(0,o.Lk)("div",m,[g,(0,o.bF)(W,{loading:L.logsLoading,onClick:C.getLogEntries},null,8,["loading","onClick"])]),(0,o.bF)(I,{"log-entries":k.logEntries,"api-url":`/api/people/${e.person.uuid}/activity-logs`,"log-updated":C.getLogEntries},null,8,["log-entries","api-url","log-updated"])])),_:1},8,["visible"]),(0,o.bF)(V,{label:"Admin",visible:e.hasPermission("people-manage")},{default:(0,o.k6)((()=>[(0,o.Lk)("section",b,[h,(0,o.Lk)("p",null,[(0,o.Lk)("button",{class:"btn btn red",onClick:t[0]||(t[0]=(...e)=>C.initMerge&&C.initMerge(...e))},"Merge Person into another")]),(0,o.Lk)("p",null,[(0,o.Lk)("button",{class:"btn btn red",onClick:t[1]||(t[1]=(...e)=>C.initDelete&&C.initDelete(...e))},"Delete Person")])])])),_:1},8,["visible"])])),_:1}),((0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[(0,o.bF)(X,{modelValue:C.showModal,"onUpdate:modelValue":t[2]||(t[2]=e=>C.showModal=e),title:e.$route.meta.title},{default:(0,o.k6)((()=>[(0,o.bF)(U,{name:"modal"})])),_:1},8,["modelValue","title"]),(0,o.bF)(X,{title:`You are about to delete ${e.person.name}`,modelValue:L.showDeleteConfirmation,"onUpdate:modelValue":t[3]||(t[3]=e=>L.showDeleteConfirmation=e)},{default:(0,o.k6)((()=>[y,v,f,(0,o.bF)(R,{"submit-text":`Delete ${e.person.name}`,onSubmitted:C.commitDelete,onCanceled:C.cancelDelete,"submit-variant":"red"},null,8,["submit-text","onSubmitted","onCanceled"])])),_:1},8,["title","modelValue"]),(0,o.bF)(X,{title:`Merge ${e.person.name} into another person`,modelValue:L.showMergeForm,"onUpdate:modelValue":t[4]||(t[4]=e=>L.showMergeForm=e)},{default:(0,o.k6)((()=>[(0,o.bF)(T,{obsolete:e.person,onSaved:C.handleMerged,onCanceled:C.handleMergeCanceled},null,8,["obsolete","onSaved","onCanceled"])])),_:1},8,["title","modelValue"])]))])}var L=l(6278),C=l(1877),w=l(6932),E=l(5261);function _(e,t,l,n,a,r){const s=(0,o.g2)("data-table");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(s,{fields:a.fields,data:r.memberships,sort:a.sort,"onUpdate:sort":t[0]||(t[0]=e=>a.sort=e),rowClickHandler:r.goToGroup,"row-class":()=>"cursor-pointer"},null,8,["fields","data","sort","rowClickHandler","row-class"])])}l(1339);var F=l(4437),D={name:"MembershipList",props:{person:{type:Object,required:!0}},data(){return{sort:{field:"group.displayName",desc:!1},fields:[{name:"group.displayName",type:String,sortable:!0,label:"Name"},{name:"group.type.name",type:String,sortable:!0,label:"Type"},{name:"roles",type:String,sortable:!1,label:"Roles",resolveValue(e){return e.roles.map((e=>e.name)).join(", ")}},{name:"permissions",type:String,sortable:!1,label:"Permissions",resolveValue(e){return e.permissions.map((e=>e.name)).join(", ")}},{name:"start_date",type:Date,sortable:!0,label:"Started"},{name:"end_date",type:Date,sortable:!0,label:"Ended"}]}},computed:{memberships(){return this.person.memberships?this.person.memberships.map((e=>(e.group&&(e.group=new F.YJ(e.group)),e))):[]}},methods:{goToGroup(e){this.$router.push({name:"GroupDetail",params:{uuid:e.group.uuid}})}}},M=l(6262);const V=(0,M.A)(D,[["render",_]]);var x=V,P=l(5554);const S=(0,o.Lk)("p",{class:"mb-8"},[(0,o.eW)(" Merging peple will do the following: "),(0,o.Lk)("ol",{class:"list-decimal ml-6"},[(0,o.Lk)("li",null,"Add the authoritative person to all groups of which the obsolete person is a member."),(0,o.Lk)("li",null,"Delete the obsolete person, their memberships, their invite, and their user account (if activated).")])],-1),W=(0,o.eW)(" Merge "),A=(0,o.eW)("(Obsolete person that will be deleted)"),I=(0,o.eW)("Into "),$=(0,o.eW)("(Authoritative person)");function U(e,t,l,n,a,r){const s=(0,o.g2)("note"),i=(0,o.g2)("person-search-select"),d=(0,o.g2)("input-row"),u=(0,o.g2)("button-row");return(0,o.uX)(),(0,o.CE)("div",null,[S,(0,o.bF)(d,{label:"Merge",vertical:""},{label:(0,o.k6)((()=>[W,(0,o.bF)(s,{class:"inline-block"},{default:(0,o.k6)((()=>[A])),_:1})])),default:(0,o.k6)((()=>[(0,o.bF)(i,{modelValue:a.obsoleteCopy,"onUpdate:modelValue":t[0]||(t[0]=e=>a.obsoleteCopy=e),"allow-add":!1},null,8,["modelValue"])])),_:1}),(0,o.bF)(d,{label:"Into",errors:a.errors.authority_id,vertical:""},{label:(0,o.k6)((()=>[I,(0,o.bF)(s,{class:"inline"},{default:(0,o.k6)((()=>[$])),_:1})])),default:(0,o.k6)((()=>[(0,o.bF)(i,{modelValue:a.authorityCopy,"onUpdate:modelValue":t[1]||(t[1]=e=>a.authorityCopy=e),"allow-add":!1},null,8,["modelValue"])])),_:1},8,["errors"]),(0,o.bF)(u,{"submit-text":"Merge",onSubmitted:r.commitMerge,onCanceled:r.cancelMerge},null,8,["onSubmitted","onCanceled"])])}var X=l(696),R={name:"PersonMergeForm",props:{authority:{type:Object,required:!1},obsolete:{type:Object,default:()=>({})}},emits:["saved","canceled"],data(){return{authorityCopy:null,obsoleteCopy:null,errors:{}}},watch:{authority:{immediate:!0,handler(e){e&&(this.authorityCopy={...e.attributes})}},obsolete:{immediate:!0,handler(e){e&&(this.obsoleteCopy={...e.attributes})}}},methods:{async commitMerge(){try{this.errors={},await this.$store.dispatch("people/mergePeople",{authority:this.authorityCopy,obsolete:this.obsoleteCopy}),this.authorityId=null,this.obsoleteIds=null,this.$emit("saved")}catch(e){if((0,X.Ah)(e))return void(this.errors=e.response.data.errors)}},cancelMerge(){this.authorityId=null,this.obsoleteId=null,this.$emit("canceled")}}};const T=(0,M.A)(R,[["render",U]]);var j=T,q=l(8950),K=l(415),O=l(3751);const H={key:0,class:"well"},Q=(0,o.Lk)("span",{class:"text-gray-600"},"Sent at",-1),N=(0,o.Lk)("span",{class:"text-gray-600"},"To:",-1),G={key:0},Y=(0,o.Lk)("span",{class:"text-gray-600"},"CC:",-1),B={key:1},J=(0,o.Lk)("span",{class:"text-gray-600"},"BCC:",-1),z={class:"mt-1"},Z=(0,o.Lk)("span",{class:"text-gray-600"},"Subject:",-1),ee=(0,o.Lk)("hr",null,null,-1),te=["innerHTML"],le=(0,o.Lk)("hr",null,null,-1),oe=["onClick"];function ne(e,t,l,a,r,s){const i=(0,o.g2)("custom-email-form"),d=(0,o.g2)("modal-dialog");return(0,o.uX)(),(0,o.CE)("div",null,[0==l.mail.length?((0,o.uX)(),(0,o.CE)("div",H,(0,n.v_)(l.person.first_name)+" has not received any mail via the GPM. ",1)):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.mail,(t=>((0,o.uX)(),(0,o.CE)("div",{class:"w-3/4 my-4 p-4 border",key:t.id},[Q,(0,o.eW)(" "+(0,n.v_)(e.formatDate(t.created_at))+" ",1),(0,o.Lk)("div",null,[N,(0,o.eW)(" "+(0,n.v_)(t.to.map((e=>e.address)).join(", ")),1)]),t.cc?((0,o.uX)(),(0,o.CE)("div",G,[Y,(0,o.eW)(" "+(0,n.v_)(t.cc.map((e=>e.address)).join(", ")),1)])):(0,o.Q3)("",!0),t.bcc?((0,o.uX)(),(0,o.CE)("div",B,[J,(0,o.eW)(" "+(0,n.v_)(t.bcc.map((e=>e.address)).join(", ")),1)])):(0,o.Q3)("",!0),(0,o.Lk)("div",z,[Z,(0,o.eW)(" "+(0,n.v_)(t.subject),1)]),ee,(0,o.Lk)("div",{innerHTML:t.body},null,8,te),le,e.hasPermission("people-manage")||e.coordinatesPerson(l.person)?((0,o.uX)(),(0,o.CE)("button",{key:2,onClick:(0,O.D$)((e=>s.initResend(t)),["stop"]),class:"btn btn-xs"}," Resend ",8,oe)):(0,o.Q3)("",!0)])))),128)),((0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[(0,o.bF)(d,{title:"Resend Email",modelValue:r.showResendDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>r.showResendDialog=e)},{default:(0,o.k6)((()=>[(0,o.bF)(i,{"mail-data":r.currentEmail,onSent:s.cleanupResend,onCanceled:s.cleanupResend},null,8,["mail-data","onSent","onCanceled"])])),_:1},8,["modelValue"])]))])}var ae={name:"ComponentName",props:{person:{type:Object,required:!0},mail:{type:Array,required:!0}},data(){return{currentEmail:{},showResendDialog:null}},computed:{},methods:{initResend(e){this.currentEmail={...e},this.showResendDialog=!0},cleanupResend(){this.currentEmail={},this.showResendDialog=!1,this.$store.dispatch("people/getMail",this.person)}}};const re=(0,M.A)(ae,[["render",ne]]);var se=re,ie=l(4201),de=l(8114),ue={name:"PersonDetail",components:{TabsContainer:E["default"],MembershipList:x,PersonProfile:P.A,DemographicsForm:de["default"],PersonMergeForm:j,CoiList:q.A,ActivityLog:K.A,PersonMailLog:se,ProfilePicture:ie.A},props:{uuid:{required:!0,type:String}},data(){return{showDeleteConfirmation:!1,showMergeForm:!1,mailLoading:!1,logsLoading:!1}},watch:{uuid:{immediate:!0,handler:async function(){await this.$store.dispatch("people/getPerson",{uuid:this.uuid}),this.coordinatesPerson(this.person)&&(this.getLogEntries(),this.getMailLog())}},"person.memberships":function(e){e.length>0&&(this.getLogEntries(),this.getMailLog())}},computed:{...(0,L.L8)({person:"people/currentItem"}),showModal:{get(){return this.$route.meta.showModal},set(e){e&&this.$router.push({name:"PersonEdit",params:{uuid:this.person.uuid}}),this.$router.push({name:"PersonDetail",params:{uuid:this.person.uuid}})}},sortedMailLog(){return[...this.person.mailLog].sort(((e,t)=>e.created_at==t.created_at?0:Date.parse(e.created_at)>Date.parse(t.created_at)?-1:1))}},methods:{initDelete(){this.showDeleteConfirmation=!0},async commitDelete(){await this.$store.dispatch("people/deletePerson",this.person),this.showDeleteConfirmation=!1,this.$router.go(-1)},cancelDelete(){this.showDeleteConfirmation=!1},initMerge(){this.showMergeForm=!0},handleMerged(){this.showMergeForm=!1,this.$router.go(-1)},handleMergeCanceled(){this.showMergeForm=!1},async getMailLog(){this.mailLoading=!0,await this.$store.dispatch("people/getMail",this.person),this.mailLoading=!1},async getLogEntries(){this.logsLoading=!0,await this.fetchEntries(`/api/people/${this.uuid}/activity-logs`),this.logsLoading=!1}},setup(){return{formatDate:C.r6,logEntries:w.Jd,fetchEntries:w.l8}},onmounted(){this.$store.dispatch("people/clearCurrentItem")}};const pe=(0,M.A)(ue,[["render",k]]);var ce=pe}}]);
//# sourceMappingURL=426.3bcee65d.js.map