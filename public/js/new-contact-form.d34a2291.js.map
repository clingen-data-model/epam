{"version":3,"sources":["webpack:///./src/http/is_validation_error.js","webpack:///./src/components/contacts/NewContactForm.vue","webpack:///./src/components/contacts/NewContactForm.vue?8187"],"names":["error","response","status","data","errors","class","save","type","newContact","email","placeholder","label","first_name","last_name","phone","cancel","name","suggestedPeople","length","person","key","uuid","isAlreadyContact","title","addExistingPersonAsContact","props","createNew","role","emits","computed","application","people","this","filter","p","includes","methods","clearForm","clearErrors","$emit","$store","dispatch","getter","getters","contact","is_validation_error","contacts","map","c","id","mounted","render"],"mappings":"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","file":"js/new-contact-form.d34a2291.js","sourcesContent":["export default function (error) {\n    return error.response && error.response.status == 422 && error.response.data.errors\n}","<template>\n    <form-container @keyup.enter=\"save\">\n        <h4 class=\"text-lg\">Add a contact</h4>\n        <div class=\"flex space-x-4\">\n            <div class=\"flex-1\">\n                <input-row \n                    type=\"text\" \n                    v-model=\"newContact.email\" \n                    :errors=\"errors.email\"\n                    placeholder=\"elenor@medplace.com\" \n                    label=\"Email\"\n                ></input-row>\n                <input-row \n                    type=\"text\" \n                    v-model=\"newContact.first_name\" \n                    :errors=\"errors.first_name\"\n                    placeholder=\"Elenor\" \n                    label=\"First name\"\n                ></input-row>\n                <input-row \n                    type=\"text\" \n                    v-model=\"newContact.last_name\" \n                    :errors=\"errors.last_name\"\n                    placeholder=\"Shelstrop\" \n                    label=\"Last name\"\n                ></input-row>\n                <input-row \n                    type=\"text\" \n                    v-model=\"newContact.phone\" \n                    :errors=\"errors.phone\"\n                    placeholder=\"1-555-867-5309\" \n                    label=\"Phone\"\n                ></input-row>\n                <button-row>\n                    <button class=\"btn\" @click=\"cancel\">Cancel</button>\n                    <button class=\"btn blue\" @click=\"save\">Save</button>\n                </button-row>\n            </div>\n            <transition name=\"slide-fade\">            \n                <div class=\"pt-2 border-l pl-2 flex-1\" v-if=\"suggestedPeople.length > 0\">\n                    <h5 class=\"font-bold border-b mb-1 pb-1\">Matching people</h5>\n                    <ul>\n                        <li \n                            v-for=\"person in suggestedPeople\" \n                            :key=\"person.uuid\" class=\"flex justify-between my-2\"\n                            :class=\"{'text-gray-400': isAlreadyContact(person)}\"\n                            :title=\"isAlreadyContact(person) ? `This person is already a contact for this application` : ``\"\n                        >\n                            {{person.name}} \n                            <button \n                                class=\"btn btn-xs\" \n                                @click=\"addExistingPersonAsContact(person)\"\n                                v-if=\"!isAlreadyContact(person)\"\n                            >\n                                Add as contact\n                            </button>\n                            <span v-else class=\"text-xs\">Already a contact</span>\n                        </li>\n                    </ul>\n                </div>\n            </transition>\n        </div>\n    </form-container>\n</template>\n<script>\nimport {mapGetters} from 'vuex'\nimport is_validation_error from '../../http/is_validation_error'\nimport { v4 as uuid4 } from 'uuid';\n\nexport default {\n    props: {\n        \n    },\n    data() {\n        return {\n            createNew: false,\n            newContact: {\n                first_name: null,\n                last_name: null,\n                email: null,\n                phone: null,\n                role: null,\n                uuid: null\n            },\n            errors: {}\n        }\n    },\n    emits: [\n        'canceled',\n        'saved',\n        'done'\n    ],\n    computed: {\n        ...mapGetters({\n            application: 'applications/currentItem',\n            people: 'people/all',\n        }),\n        suggestedPeople() {\n            if (this.newContact.email) {\n                return this.people\n                        .filter(p => p.email.includes(this.newContact.email));\n            }\n            return [];\n        }\n        \n    },\n    methods: {\n        clearForm () {\n            this.newContact = {\n                first_name: null,\n                last_name: null,\n                email: null,\n                phone: null,\n                role: null,\n                uuid: null\n            }\n        },\n        clearErrors () {\n            this.errors = {};\n        },\n        cancel () {\n            this.clearForm();\n            this.$emit('canceled');\n            this.$emit('done');\n        },\n        async save () {\n            this.clearErrors();\n            try {\n                const data = {...this.newContact};\n                data.uuid = uuid4();\n                await this.$store.dispatch('people/createPerson', data);\n\n                const getter = this.$store.getters['people/personWithUuid'];\n                // const addedPerson = getter(data.uuid);\n\n\n                await this.$store.dispatch('applications/addContact', {\n                    application: this.application, \n                    contact: getter(data.uuid)\n                });\n\n                this.clearForm();\n                this.$emit('saved');\n                this.$emit('done');\n            } catch (error) {\n                if (is_validation_error(error)) {\n                    this.errors = error.response.data.errors\n                    return;\n                }\n                throw error\n            }\n        },\n        async addExistingPersonAsContact(person) {\n            try {\n                await this.$store.dispatch('applications/addContact', {application: this.application, contact: person});\n                this.clearForm();\n                this.$emit('saved');\n                this.$emit('done');\n            } catch (error) {\n                if (is_validation_error(error)) {\n                    this.errors = error.response.data.errors\n                    return;\n                }\n                throw error\n            }\n        },\n        isAlreadyContact(person) {\n            return this.application.contacts.map(c => c.id).includes(person.id)\n        }\n    },\n    mounted () {\n        this.$store.dispatch('people/getAll', {});\n    }\n}\n</script>","import { render } from \"./NewContactForm.vue?vue&type=template&id=49a5acd0\"\nimport script from \"./NewContactForm.vue?vue&type=script&lang=js\"\nexport * from \"./NewContactForm.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}