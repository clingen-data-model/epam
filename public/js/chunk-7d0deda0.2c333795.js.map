{"version":3,"sources":["webpack:///./src/views/PersonEdit.vue","webpack:///./src/views/PersonEdit.vue?2e23","webpack:///./src/forms/profile_form.js","webpack:///./src/components/people/ProfileForm.vue","webpack:///./src/components/people/ProfileForm.vue?2daf"],"names":["person","goBack","name","components","ProfileForm","props","uuid","required","type","String","setup","store","router","getters","dispatch","value","go","render","lookups","ref","institutions","countries","timezones","primaryOccupations","races","ethnicities","genders","profileFields","computed","label","options","demographicFields","placeholder","show","data","primary_occupation_id","race_id","enthnicity_id","gender_id","getLookups","Object","keys","forEach","lkup","api","get","kebabCase","then","response","map","i","id","catch","error","console","class","fields","profile","errors","save","cancel","submit-text","emits","page","this","title","methods","initProfile","$store","attributes","force","commit","$emit","mounted"],"mappings":"mPACI,gCAKM,YAJF,yBAGgB,GAHDA,OAAQ,EAAAA,OAClB,QAAK,+BAAE,EAAAC,WACP,WAAQ,+BAAE,EAAAA,Y,iGAWR,GACXC,KAAM,aACNC,WAAY,CACRC,cAAA,MAEJC,MAAO,CACHC,KAAM,CACFC,UAAU,EACVC,KAAMC,SAGdC,MAXW,SAWJL,GACH,IAAMM,EAAQ,iBACRC,EAAS,iBAETZ,EAAS,uBAAU,WACrB,IAAMA,EAASW,EAAME,QAAQ,sBAC7B,OAAIb,GAGG,IAAI,UAEf,uBAAS,wCAAC,8GACAW,EAAMG,SAAS,mBAAoB,CAACR,KAAMN,EAAOe,MAAMT,OADvD,4CAGV,oBAAM,kBAAMD,EAAMC,OAAb,wCAAmB,8GACdK,EAAMG,SAAS,mBAAoB,CAACR,KAAMN,EAAOe,MAAMT,OADzC,4CAIxB,IAAML,EAAS,WACXW,EAAOI,IAAI,IAGf,MAAO,CACHhB,SACAC,YC/CZ,EAAOgB,OAASA,EAED,gB,0NCDFC,EAAUC,iBAAI,CACvBC,aAAa,GACbC,UAAU,GACVC,UAAU,GACVC,mBAAmB,GACnBC,MAAM,GACNC,YAAY,GACZC,QAAQ,KAGCC,EAAgBC,uBAAS,iBAAM,CACxC,CAAE1B,KAAM,cACR,CAAEA,KAAM,aACR,CAAEA,KAAM,SACR,CACIA,KAAM,iBACN2B,MAAO,cACPrB,KAAM,SACNsB,QAASZ,EAAQH,MAAMK,cAE3B,CAAElB,KAAM,cAAeM,KAAM,YAC7B,CAAEN,KAAM,YAAaM,KAAM,YAC3B,CAAEN,KAAM,SACR,CACIA,KAAM,WACN2B,MAAO,WACPrB,KAAM,SACNsB,QAASZ,EAAQH,MAAMO,eAIlBS,EAAoBH,uBAAS,iBAAM,CAC5C,CACI1B,KAAM,aACN2B,MAAO,UACPrB,KAAM,SACNsB,QAASZ,EAAQH,MAAMM,WAE3B,CACInB,KAAM,wBACN2B,MAAO,qBACPrB,KAAM,SACNsB,QAASZ,EAAQH,MAAMQ,oBAE3B,CACIrB,KAAM,2BACN2B,MAAO,IACPrB,KAAM,OACNwB,YAAa,UACbC,KAAM,SAACC,GACH,OAAqC,KAA9BA,EAAKC,wBAGpB,CACIjC,KAAM,UACN2B,MAAO,OACPrB,KAAM,SACNsB,QAASZ,EAAQH,MAAMS,OAE3B,CACItB,KAAM,aACN2B,MAAO,IACPrB,KAAM,OACNwB,YAAa,UACbC,KAAM,SAACC,GACH,OAAuB,KAAhBA,EAAKE,UAGpB,CACIlC,KAAM,eACN2B,MAAO,YACPrB,KAAM,SACNsB,QAASZ,EAAQH,MAAMU,aAE3B,CACIvB,KAAM,mBACN2B,MAAO,IACPrB,KAAM,OACNwB,YAAa,UACbC,KAAM,SAACC,GACH,OAA6B,KAAtBA,EAAKG,gBAGpB,CACInC,KAAM,YACN2B,MAAO,SACPrB,KAAM,SACNsB,QAASZ,EAAQH,MAAMW,SAE3B,CACIxB,KAAM,eACN2B,MAAO,IACPrB,KAAM,OACNwB,YAAa,UACbC,KAAM,SAACC,GACH,OAAyB,KAAlBA,EAAKI,gBAKXC,EAAa,WACtBC,OAAOC,KAAKvB,EAAQH,OAAO2B,SAAQ,SAAAC,GACnB,aAARA,EAQJC,OAAIC,IAAJ,8BAA+BC,eAAUH,KACpCI,MAAK,SAAAC,GACF9B,EAAQH,MAAM4B,GAAQK,EAASd,KAAKA,KAAKe,KAAI,SAAAC,GAAC,MAAK,CAACnC,MAAOmC,EAAEC,GAAItB,MAAOqB,EAAEhD,YAE7EkD,OAAM,SAAAC,GAAK,OAAIC,QAAQD,MAAMA,MAX9BT,OAAIC,IAAJ,iCACKE,MAAK,SAAAC,GACF9B,EAAQH,MAAMO,UAAY0B,EAASd,KAAKA,KAAKe,KAAI,SAAAC,GAAC,MAAK,CAACnC,MAAOmC,EAAGrB,MAAOqB,c,sDC3GrF,gCAAgB,UAAZ,WAAO,G,EAOX,gCAAiB,MAAbK,MAAM,QAAM,S,EAEhB,gCAAqB,UAAjB,gBAAY,G,uJAVpB,gCAkBM,YAjBF,EACA,yBAIa,GAHRC,OAAQ,EAAA7B,c,WACA,EAAA8B,Q,qDAAA,EAAAA,QAAO,IACfC,OAAQ,EAAAA,Q,yCAGb,EAEA,EACA,yBAIa,GAHRF,OAAQ,EAAAzB,kB,WACA,EAAA0B,Q,qDAAA,EAAAA,QAAO,IACfC,OAAQ,EAAAA,Q,yCAGb,yBAAmF,GAAtE,YAAW,EAAAC,KAAO,WAAQ,+BAAE,EAAAC,WAAUC,cAAY,Q,0FAQxD,GACX3D,KAAM,cACNG,MAAO,CACHL,OAAQ,CACJQ,KAAMgC,OACNjC,UAAU,IAGlBuD,MAAO,CACH,QACA,YAEJ5B,KAZW,WAaP,MAAO,CACHwB,OAAQ,GACRD,QAAS,GACTM,KAAM,YAGdnC,SAAU,CACN4B,OADM,WAEF,MAAqB,WAAbQ,KAAKD,KAAqBC,KAAKrC,cAAgBqC,KAAKjC,mBAEhEkC,MAJM,WAKF,MAAoB,WAAbD,KAAKD,KAAoB,+BAAiC,+CAGzEG,QAAS,CACLC,YADK,WAEDH,KAAKP,QAAL,kBAAmBO,KAAKI,OAAOvD,QAAQ,sBAAsBwD,aAE3DV,KAJD,WAIS,iLAEA,EAAKS,OAAOtD,SACV,uBACA,CAACR,KAAM,EAAKN,OAAOM,KAAM+D,WAAY,EAAKZ,UAE7CV,MAAK,WACF,EAAKqB,OAAOtD,SAAS,iBAAkB,CAACwD,OAAO,IAC/C,EAAKF,OAAOG,OAAO,cAAe,qCARpC,OAWN,EAAKC,MAAM,SAXL,kDAaF,eAAkB,EAAD,MACjB,EAAKd,OAAS,KAAMV,SAASd,KAAKwB,QAdhC,2DAkBdE,OAtBK,WAuBDI,KAAKG,cACLH,KAAKQ,MAAM,cAGnB9D,MAtDW,WAyDP,OAFA,wBAAU,kBAAM,oBAET,CACHiB,cAAA,OACAI,kBAAA,OACAQ,WAAA,SAGFkC,QA/DK,WA+DM,wJACb,EAAKN,cADQ,+CCtFrB,EAAOlD,OAASA,EAED","file":"js/chunk-7d0deda0.2c333795.js","sourcesContent":["<template>\n    <div>\n        <profile-form :person=\"person\"\n            @saved=\"goBack()\"\n            @canceled=\"goBack()\"\n        ></profile-form>\n    </div>\n</template>\n<script>\nimport {watch, computed, onMounted} from 'vue'\nimport {useStore} from 'vuex'\nimport {useRouter} from 'vue-router'\nimport ProfileForm from '@/components/people/ProfileForm'\nimport Person from '@/domain/person'\n\nexport default {\n    name: 'PersonEdit',\n    components: {\n        ProfileForm\n    },\n    props: {\n        uuid: {\n            required: true,\n            type: String\n        }\n    },\n    setup (props) {\n        const store = useStore();\n        const router = useRouter();\n\n        const person = computed( () => {\n            const person = store.getters['people/currentItem'];\n            if (person) {\n                return person;\n            }\n            return new Person();\n        });\n        onMounted(async () => {\n            await store.dispatch('people/getPerson', {uuid: person.value.uuid});\n        })\n        watch(() => props.uuid, async () => {\n            await store.dispatch('people/getPerson', {uuid: person.value.uuid});\n        })\n\n        const goBack = () => {\n            router.go(-1);\n        }\n\n        return {\n            person,\n            goBack,\n        }\n    }\n}\n</script>","import { render } from \"./PersonEdit.vue?vue&type=template&id=71f3c576\"\nimport script from \"./PersonEdit.vue?vue&type=script&lang=js\"\nexport * from \"./PersonEdit.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import {ref, computed} from 'vue';\nimport api from '@/http/api';\nimport {kebabCase} from '@/utils'\n\nexport const lookups = ref({\n    institutions:[],\n    countries:[],\n    timezones:[],\n    primaryOccupations:[],\n    races:[],\n    ethnicities:[],\n    genders:[],\n});\n\nexport const profileFields = computed(() => [\n    { name: 'first_name'},\n    { name: 'last_name'},\n    { name: 'email'},\n    {\n        name: 'institution_id',\n        label: 'Institution',\n        type: 'select',\n        options: lookups.value.institutions\n    },\n    { name: 'credentials', type: 'textarea'},\n    { name: 'biography', type: 'textarea'},\n    { name: 'phone'},\n    { \n        name: 'timezone', \n        label: 'Timezone',\n        type: 'select', \n        options: lookups.value.timezones\n    },\n]);\n\nexport const demographicFields = computed(() => [\n    { \n        name: 'country_id', \n        label: 'Country',\n        type: 'select', \n        options: lookups.value.countries\n    },\n    {\n        name: 'primary_occupation_id',\n        label: 'Primary Occupation',\n        type: 'select',\n        options: lookups.value.primaryOccupations\n    },\n    {\n        name: 'primary_occupation_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.primary_occupation_id == 100\n        }\n    },\n    {\n        name: 'race_id',\n        label: 'Race',\n        type: 'select',\n        options: lookups.value.races\n    },\n    {\n        name: 'race_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.race_id == 100\n        }\n    },\n    {\n        name: 'ethnicity_id',\n        label: 'Ethnicity',\n        type: 'select',\n        options: lookups.value.ethnicities\n    },\n    {\n        name: 'enthnicity_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.enthnicity_id == 100\n        }\n    },\n    {\n        name: 'gender_id',\n        label: 'Gender',\n        type: 'select',\n        options: lookups.value.genders\n    },\n    {\n        name: 'gender_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.gender_id == 100\n        }\n    },\n]);\n\nexport const getLookups = () => {\n    Object.keys(lookups.value).forEach(lkup => {\n        if (lkup == 'timezones') {\n            api.get(`/api/people/lookups/timezones`)\n                .then(response => {\n                    lookups.value.timezones = response.data.data.map(i => ({value: i, label: i}));\n                })\n\n            return;\n        }\n        api.get(`/api/people/lookups/${kebabCase(lkup)}`)\n            .then(response => {\n                lookups.value[lkup] = response.data.data.map(i => ({value: i.id, label: i.name}));\n            })\n            .catch(error => console.error(error));\n    })\n}\n\nexport default {\n    profileFields,\n    demographicFields,\n    lookups,\n    getLookups,\n}","<template>\n    <div>\n        <h3>Profile</h3>\n        <data-form \n            :fields=\"profileFields\" \n            v-model=\"profile\" \n            :errors=\"errors\"\n        ></data-form>\n\n        <hr class=\"my-4\">\n\n        <h3>Demographics</h3>\n        <data-form \n            :fields=\"demographicFields\" \n            v-model=\"profile\" \n            :errors=\"errors\"\n        ></data-form>\n\n        <button-row @submitted=\"save\" @canceled=\"cancel()\" submit-text=\"Save\"></button-row>\n    </div>\n</template>\n<script>\nimport isValidationError from '@/http/is_validation_error'\nimport {onMounted} from 'vue'\nimport {getLookups, profileFields, demographicFields} from '@/forms/profile_form';\n\nexport default {\n    name: 'ProfileForm',\n    props: {\n        person: {\n            type: Object,\n            required: true\n        }\n    },\n    emits: [\n        'saved',\n        'canceled'\n    ],\n    data() {\n        return {\n            errors: {},\n            profile: {},\n            page: 'profile'\n        }\n    },\n    computed: {\n        fields () {\n            return (this.page == 'profile') ? this.profileFields : this.demographicFields;\n        },\n        title () {\n            return this.page == 'profile' ? 'Please fill out your profile' : 'Please share your demographic information.'\n        }\n    },\n    methods: {\n        initProfile () {\n            this.profile = {...this.$store.getters['people/currentItem'].attributes};\n        },\n        async save () {\n            try {\n                await this.$store.dispatch(\n                        'people/updateProfile', \n                        {uuid: this.person.uuid, attributes: this.profile}\n                    )                \n                    .then(() => {\n                        this.$store.dispatch('getCurrentUser', {force: true})\n                        this.$store.commit('pushSuccess', 'Your profile has been updated.')\n                    })\n                    \n                this.$emit('saved');\n            } catch (error) {\n                if (isValidationError(error)) {\n                    this.errors = error.response.data.errors;\n                }\n            }\n        },\n        cancel () {\n            this.initProfile();\n            this.$emit('canceled');\n        }\n    },\n    setup () {\n        onMounted(() => getLookups());\n\n        return {\n            profileFields,\n            demographicFields,\n            getLookups,\n        }\n    },\n    async mounted () {\n        this.initProfile()\n    }\n}\n</script>","import { render } from \"./ProfileForm.vue?vue&type=template&id=4b69317e\"\nimport script from \"./ProfileForm.vue?vue&type=script&lang=js\"\nexport * from \"./ProfileForm.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}