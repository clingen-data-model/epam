"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[458],{4582:function(e,t,a){a.d(t,{A:function(){return i}});a(3725),a(5019);var l=a(6166),r=a(641);function i(e=null){const t=(0,l.rd)(),a=(0,l.lq)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const i=(0,r.EW)({immediate:!0,get(){return Object.keys(a.query).includes("sort-field")?{field:a.query["sort-field"],desc:Boolean(parseInt(a.query["sort-desc"]))}:e},set(e){const l={"sort-field":e.field,"sort-desc":e.desc?1:0},r={...a.query,...l};t.replace({path:a.path,query:r})}}),n=(0,r.EW)({set(e){let l=a.query,r=a.path,i={...l};e?i={...l,filter:e}:delete i.filter,t.replace({path:r,query:i})},get(){return a.query.filter},immediate:!0});return{sort:i,filter:n}}},6458:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});a(3725),a(5019);var l=a(641),r=a(3751),i=a(33);const n=(0,l.Lk)("h1",null,"Mail Log",-1),s={class:"mb-2"},o=(0,l.eW)("Filter: "),d={key:0},u=["onClick"];function c(e,t,a,c,m,h){const f=(0,l.g2)("data-table"),g=(0,l.g2)("mail-detail"),p=(0,l.g2)("modal-dialog"),b=(0,l.g2)("custom-email-form");return(0,l.uX)(),(0,l.CE)("div",null,[n,(0,l.bF)(f,{fields:m.fields,data:h.getPage,"row-class":"cursor-pointer","row-click-handler":h.showMailDetail,sort:c.sort,"onUpdate:sort":t[1]||(t[1]=e=>c.sort=e),"page-size":20,paginated:"",ref:"dataTable"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",s,[o,(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>c.filter=e)},null,512),[[r.Jo,c.filter]])])])),"cell-to":(0,l.k6)((({item:e})=>[(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.to,(e=>((0,l.uX)(),(0,l.CE)("li",{key:e.address},[e.name?((0,l.uX)(),(0,l.CE)("span",d,(0,i.v_)(e.name)+" - ",1)):(0,l.Q3)("",!0),(0,l.eW)(" "+(0,i.v_)(e.address),1)])))),128))])])),"cell-actions":(0,l.k6)((({item:t})=>[(0,l.Lk)("div",null,[e.hasPermission("people-manage")?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-xs",onClick:(0,r.D$)((e=>h.initResend(t)),["stop"])},"Resend",8,u)):(0,l.Q3)("",!0)])])),_:1},8,["fields","data","row-click-handler","sort"]),((0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[(0,l.bF)(p,{modelValue:m.showDetail,"onUpdate:modelValue":t[3]||(t[3]=e=>m.showDetail=e)},{default:(0,l.k6)((()=>[e.hasPermission("people-manage")?((0,l.uX)(),(0,l.Wv)(g,{key:0,mail:m.currentEmail,onResend:t[2]||(t[2]=e=>h.initResend(m.currentEmail))},null,8,["mail"])):(0,l.Q3)("",!0)])),_:1},8,["modelValue"]),(0,l.bF)(p,{title:"Resend Email",modelValue:m.showResendDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>m.showResendDialog=e)},{default:(0,l.k6)((()=>[(0,l.bF)(b,{"mail-data":m.currentEmail,onSent:h.cleanupResend,onCanceled:h.cleanupResend},null,8,["mail-data","onSent","onCanceled"])])),_:1},8,["modelValue"])]))])}var m=a(7684),h=a(2425),f=a(1877),g=a(4582),p={props:{},setup(){const{sort:e,filter:t}=(0,g.A)({field:"created_at",desc:!0});return{sort:e,filter:t}},data(){return{showDetail:!1,fields:[{name:"to",sortable:!0,type:Array,resolveValue(e){const t=Object.keys(e.to);return 0==t.length?"":1==t.length?t[0]:t.join("; ")}},{name:"subject",sortable:!0,type:String},{name:"created_at",label:"Sent at",sortable:!0,resolveValue(e){return(0,f.r6)(e.created_at)},resolveSort(e){return e.created_at},type:String},{name:"actions",label:"",sortable:!1}],data:[],currentEmail:{},showResendDialog:!1}},watch:{filter:{immediate:!0,handler:function(){this.triggerSearch&&this.triggerSearch()}},sort:{deep:!0,immediate:!0,handler:function(){this.triggerSearch&&this.triggerSearch()}}},methods:{async getPage(e,t,a,l){try{const r={page:e,page_size:t,"sort[field]":a.field.name,"sort[dir]":a.desc?"DESC":"ASC","where[filterString]":this.filter},i=await m.A.get("/api/mail-log",{params:r}).then((e=>e.data));return l(i.total),i.data}catch(r){alert(r)}},showMailDetail(e){this.currentEmail=e,this.showDetail=!0},initResend(e){this.currentEmail=e,this.showResendDialog=!0},cleanupResend(){this.currentEmail={},this.showResendDialog=!1,this.$refs.dataTable.getItems()}},created(){this.triggerSearch=(0,h.A)((()=>this.$refs.dataTable.getItems()),500)}},b=a(6262);const k=(0,b.A)(p,[["render",c]]);var y=k}}]);
//# sourceMappingURL=458.3416e798.js.map