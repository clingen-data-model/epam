"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[462],{2790:function(e,t,a){a.d(t,{Z:function(){return s}});a(6699);var l=a(2119),n=a(6252);function s(e=null){const t=(0,l.tv)(),a=(0,l.yj)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const s=(0,n.Fl)({immediate:!0,get(){return Object.keys(a.query).includes("sort-field")?{field:a.query["sort-field"],desc:Boolean(parseInt(a.query["sort-desc"]))}:e},set(e){const l={"sort-field":e.field,"sort-desc":e.desc?1:0},n={...a.query,...l};t.replace({path:a.path,query:n})}}),i=(0,n.Fl)({set(e){let l=a.query,n=a.path,s={...l};e?s={...l,filter:e}:delete s.filter,t.replace({path:n,query:s})},get(){return a.query.filter},immediate:!0});return{sort:s,filter:i}}},2462:function(e,t,a){a.r(t),a.d(t,{default:function(){return j}});var l=a(6252),n=a(3577),s=a(9963);const i={class:"flex justify-between items-center border-b mb-4"},r={class:"border-0 mb-0"},o=["value"],d={key:0},u={key:0};function p(e,t,a,p,c,m){const f=(0,l.up)("annual-update-table"),w=(0,l.up)("tab-item"),h=(0,l.up)("tabs-container");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("header",i,[(0,l._)("h1",r," Annual Updates for "+(0,n.zw)(m.latestWindow.for_year),1),(0,l.Uk)(" "+(0,n.zw)(e.formatDate(m.latestWindow.start))+" - "+(0,n.zw)(e.formatDate(m.latestWindow.end))+" ",1),c.windows.length>1?(0,l.wy)(((0,l.wg)(),(0,l.iD)("select",{key:0,"onUpdate:modelValue":t[0]||(t[0]=e=>c.selectedYear=e),class:"font-normal text-md"},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(m.sortedWindows,(e=>((0,l.wg)(),(0,l.iD)("option",{value:e.for_year,key:e.id},(0,n.zw)(e.for_year),9,o)))),128))],512)),[[s.bM,c.selectedYear]]):(0,l.kq)("",!0)]),(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,{label:"VCEPS"},{default:(0,l.w5)((()=>[c.loading?((0,l.wg)(),(0,l.iD)("div",d,"Loading…")):((0,l.wg)(),(0,l.j4)(f,{key:1,items:m.vcepReviews},null,8,["items"]))])),_:1}),(0,l.Wm)(w,{label:"GCEPS"},{default:(0,l.w5)((()=>[c.loading?((0,l.wg)(),(0,l.iD)("div",u,"Loading…")):((0,l.wg)(),(0,l.j4)(f,{key:1,items:m.gcepReviews},null,8,["items"]))])),_:1})])),_:1})])}var c=a(9028),m=a(6486);const f={class:"flex mb-2 items-end justify-between"},w={class:"flex space-x-4 items-end"},h=(0,l._)("option",{value:null},"Any",-1),y=(0,l._)("option",{value:2},"Only Pending",-1),b=(0,l._)("option",{value:1},"Only Completed",-1),_=[h,y,b],g=(0,l.Uk)(" view ");function v(e,t,a,n,i,r){const o=(0,l.up)("router-link"),d=(0,l.up)("data-table");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",f,[(0,l._)("div",w,[(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.filter=e),placeholder:"EP name, submitter name",class:"w-60"},null,512),[[s.nr,n.filter]]),(0,l.wy)((0,l._)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.completedFilter=e),class:"flex radio-group"},_,512),[[s.bM,r.completedFilter]])]),(0,l._)("button",{class:"btn btn-xs",onClick:t[2]||(t[2]=(...e)=>r.exportData&&r.exportData(...e))},"Export Data")]),(0,l.Wm)(d,{data:r.filteredItems,fields:i.fields,sort:n.sort,"onUpdate:sort":t[3]||(t[3]=e=>n.sort=e)},{"cell-action":(0,l.w5)((({item:e})=>[(0,l.Wm)(o,{to:{name:"AnnualUpdateDetail",params:{id:e.id}}},{default:(0,l.w5)((()=>[g])),_:2},1032,["to"])])),_:1},8,["data","fields","sort"])])}var x=a(2790),k={name:"AnnualUpdateTeable",props:{items:{type:Array,required:!0}},data(){return{fields:[{name:"id",sortable:!0,label:"ID"},{name:"expert_panel.display_name",label:"Expert Panel",sortable:!0},{name:"submitter.person.name",label:"Submitter",sortable:!0},{name:"completed_at",label:"Completed",sortable:!0,resolveValue:e=>e.completed_at?this.formatDate(e.completed_at):null},{name:"action",label:"",sortable:!1}]}},computed:{completedFilter:{get:function(){return this.$route.query.completed||null},set:function(e){let t=this.$route.query,a=this.$route.path,l={...t};e?l={...t,completed:e}:delete l.completed,this.$router.replace({path:a,query:l})}},filteredItems(){let e=JSON.parse(JSON.stringify(this.items));if(null!=this.filter){const t=new RegExp(`.*${this.filter}.*`,"i");e=this.items.filter((e=>e.expert_panel.display_name.match(t)||e.submitter&&e.submitter.person&&e.submitter.person.name.match(t)))}return null!=this.completedFilter&&(e=e.filter((e=>1==this.completedFilter?null!==e.completed_at:null==e.completed_at))),e}},methods:{exportData(){const e=this.filteredItems.map((e=>e.id));c.hi.post("/api/annual-updates/export",{annual_update_ids:e}).then((e=>{const t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.href=window.URL.createObjectURL(new Blob([e.data,{type:"text/csv"}])),t.setAttribute("download","annual_updates.csv"),t.click(),document.body.removeChild(t)}))}},setup(){const{sort:e,filter:t}=(0,x.Z)({field:"expert_panel.display_name",desc:!1});return{sort:e,filter:t}}},D=a(3744);const W=(0,D.Z)(k,[["render",v]]);var q=W,U={name:"AnnualUpdatesList",components:{AnnualUpdateTable:q},data(){return{selectedYear:null,windows:[],items:[],loading:!1}},computed:{sortedWindows(){return(0,m.orderBy)(this.windows,"for_year","desc")},latestWindow(){return this.sortedWindows[0]||{}},gcepReviews(){return this.items.filter((e=>1==e.expert_panel.expert_panel_type_id))},vcepReviews(){return this.items.filter((e=>2==e.expert_panel.expert_panel_type_id))}},methods:{async getWindows(){this.windows=await c.hi.get("/api/annual-updates/windows").then((e=>e.data)),this.selectedYear=this.latestWindow.for_year},async getItems(){this.loading=!0,this.items=await c.hi.get("/api/annual-updates").then((e=>e.data)),this.loading=!1}},mounted(){this.getWindows(),this.getItems()}};const C=(0,D.Z)(U,[["render",p],["__scopeId","data-v-51093e4a"]]);var j=C}}]);
//# sourceMappingURL=462.ab88e40b.js.map