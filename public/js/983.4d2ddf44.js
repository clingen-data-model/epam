"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[983],{4582:function(e,t,l){l.d(t,{A:function(){return s}});l(3725),l(5019);var a=l(6166),n=l(641);function s(e=null){const t=(0,a.rd)(),l=(0,a.lq)();e||(console.log('Warning: defaultSort is deprecated.  Please provide a sort object: {field: "fieldname", desc: boolean}'),e=e||{field:"name",desc:!1});const s=(0,n.EW)({immediate:!0,get(){return Object.keys(l.query).includes("sort-field")?{field:l.query["sort-field"],desc:Boolean(parseInt(l.query["sort-desc"]))}:e},set(e){const a={"sort-field":e.field,"sort-desc":e.desc?1:0},n={...l.query,...a};t.replace({path:l.path,query:n})}}),i=(0,n.EW)({set(e){let a=l.query,n=l.path,s={...a};e?s={...a,filter:e}:delete s.filter,t.replace({path:n,query:s})},get(){return l.query.filter},immediate:!0});return{sort:s,filter:i}}},983:function(e,t,l){l.r(t),l.d(t,{default:function(){return q}});var a=l(641),n=l(33),s=l(3751);const i={class:"flex justify-between items-center border-b mb-4"},d={class:"border-0 mb-0"},r=["value"],o={key:0},u={key:0};function c(e,t,l,c,p,m){const f=(0,a.g2)("annual-update-table"),h=(0,a.g2)("tab-item"),b=(0,a.g2)("tabs-container");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("header",i,[(0,a.Lk)("h1",d," Annual Updates for "+(0,n.v_)(m.selectedYear),1),(0,a.eW)(" "+(0,n.v_)(e.formatDate(m.selectedStartDate))+" - "+(0,n.v_)(e.formatDate(m.selectedEndDate))+" ",1),p.windows.length>1?(0,a.bo)(((0,a.uX)(),(0,a.CE)("select",{key:0,"onUpdate:modelValue":t[0]||(t[0]=e=>p.selectedWindow=e),class:"font-normal text-md"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(m.sortedWindows,(e=>((0,a.uX)(),(0,a.CE)("option",{value:e,key:e.id},(0,n.v_)(e.for_year),9,r)))),128))],512)),[[s.u1,p.selectedWindow]]):(0,a.Q3)("",!0)]),(0,a.bF)(b,null,{default:(0,a.k6)((()=>[(0,a.bF)(h,{label:"VCEPS"},{default:(0,a.k6)((()=>[p.loading?((0,a.uX)(),(0,a.CE)("div",o,"Loading…")):((0,a.uX)(),(0,a.Wv)(f,{key:1,items:m.vcepReviews},null,8,["items"]))])),_:1}),(0,a.bF)(h,{label:"GCEPS"},{default:(0,a.k6)((()=>[p.loading?((0,a.uX)(),(0,a.CE)("div",u,"Loading…")):((0,a.uX)(),(0,a.Wv)(f,{key:1,items:m.gcepReviews},null,8,["items"]))])),_:1})])),_:1})])}l(3725),l(5019);var p=l(696),m=l(2543);const f={class:"flex mb-2 items-end justify-between"},h={class:"flex space-x-4 items-end"},b=(0,a.Lk)("option",{value:null},"Any",-1),w=(0,a.Lk)("option",{value:2},"Only Pending",-1),y=(0,a.Lk)("option",{value:1},"Only Completed",-1),_=[b,w,y],v=(0,a.eW)(" view ");function g(e,t,l,n,i,d){const r=(0,a.g2)("router-link"),o=(0,a.g2)("data-table");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("div",f,[(0,a.Lk)("div",h,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.filter=e),placeholder:"EP name, submitter name",class:"w-60"},null,512),[[s.Jo,n.filter]]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>d.completedFilter=e),class:"flex radio-group"},_,512),[[s.u1,d.completedFilter]])]),(0,a.Lk)("button",{class:"btn btn-xs",onClick:t[2]||(t[2]=(...e)=>d.exportData&&d.exportData(...e))},"Export Data")]),(0,a.bF)(o,{data:d.filteredItems,fields:i.fields,sort:n.sort,"onUpdate:sort":t[3]||(t[3]=e=>n.sort=e)},{"cell-action":(0,a.k6)((({item:e})=>[(0,a.bF)(r,{to:{name:"AnnualUpdateDetail",params:{id:e.id}}},{default:(0,a.k6)((()=>[v])),_:2},1032,["to"])])),_:1},8,["data","fields","sort"])])}l(1339);var W=l(4582),k={name:"AnnualUpdateTeable",props:{items:{type:Array,required:!0}},data(){return{fields:[{name:"id",sortable:!0,label:"ID"},{name:"expert_panel.display_name",label:"Expert Panel",sortable:!0},{name:"submitter.person.name",label:"Submitter",sortable:!0},{name:"completed_at",label:"Completed",sortable:!0,resolveValue:e=>e.completed_at?this.formatDate(e.completed_at):null},{name:"action",label:"",sortable:!1}]}},computed:{completedFilter:{get:function(){return this.$route.query.completed||null},set:function(e){let t=this.$route.query,l=this.$route.path,a={...t};e?a={...t,completed:e}:delete a.completed,this.$router.replace({path:l,query:a})}},filteredItems(){let e=JSON.parse(JSON.stringify(this.items));if(null!=this.filter){const t=new RegExp(`.*${this.filter}.*`,"i");e=this.items.filter((e=>e.expert_panel.display_name.match(t)||e.submitter&&e.submitter.person&&e.submitter.person.name.match(t)))}return null!=this.completedFilter&&(e=e.filter((e=>1==this.completedFilter?null!==e.completed_at:null==e.completed_at))),e}},methods:{exportData(){const e=this.filteredItems.map((e=>e.id));p.FH.post("/api/annual-updates/export",{annual_update_ids:e}).then((e=>{const t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.href=window.URL.createObjectURL(new Blob([e.data,{type:"text/csv"}])),t.setAttribute("download","annual_updates.csv"),t.click(),document.body.removeChild(t)}))}},setup(){const{sort:e,filter:t}=(0,W.A)({field:"expert_panel.display_name",desc:!1});return{sort:e,filter:t}}},x=l(6262);const E=(0,x.A)(k,[["render",g]]);var C=E,L={name:"AnnualUpdatesList",components:{AnnualUpdateTable:C},data(){return{selectedWindow:null,windows:[],items:[],loading:!1}},computed:{sortedWindows(){return(0,m.orderBy)(this.windows,"for_year","desc")},latestWindow(){return this.sortedWindows[0]||{}},gcepReviews(){return this.items.filter((e=>1==e.expert_panel.expert_panel_type_id))},vcepReviews(){return this.items.filter((e=>2==e.expert_panel.expert_panel_type_id))},selectedYear(){return this.selectedWindow?this.selectedWindow.for_year:this.latestWindow.for_year},selectedStartDate(){return this.selectedWindow?this.selectedWindow.start:this.latestWindow.start},selectedEndDate(){return this.selectedWindow?this.selectedWindow.end:this.latestWindow.end}},watch:{selectedWindow(e){e&&this.getItems()}},methods:{async getWindows(){this.windows=await p.FH.get("/api/annual-updates/windows").then((e=>e.data)),this.selectedWindow=this.latestWindow},async getItems(){let e="/api/annual-updates";this.selectedWindow&&(e+=`?window_id=${this.selectedWindow.id}`),this.loading=!0,this.items=await p.FH.get(e).then((e=>e.data)),this.loading=!1}},mounted(){this.getWindows(),this.getItems()}};const F=(0,x.A)(L,[["render",c],["__scopeId","data-v-40a5b7f2"]]);var q=F}}]);
//# sourceMappingURL=983.4d2ddf44.js.map