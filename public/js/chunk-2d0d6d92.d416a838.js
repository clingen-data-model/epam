(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d6d92"],{"73ff":function(e,t,o){"use strict";o.r(t);o("b0c0");var n=o("7a23"),r={class:"pb-4"},a=Object(n["createTextVNode"])("People"),l={class:"flex justify-between items-center"},c=Object(n["createElementVNode"])("strong",null,"Email:",-1),i=Object(n["createElementVNode"])("strong",null,"Institution:",-1),s={key:0,class:"well"},u=["innerHTML"],d=["onClick"],b={class:"border my-4 p-4 bg-red-100 border-red-200 rounded"},p=Object(n["createElementVNode"])("h2",{class:"mb-4 text-red-800"}," Here be dragons. Proceed with caution. ",-1),m=Object(n["createElementVNode"])("p",null,"You are about to delete this person. All related data will also be deleted including:",-1),j=Object(n["createElementVNode"])("ul",{class:"list-disc pl-6"},[Object(n["createElementVNode"])("li",null,"User record, system roles, and system permissions (if account is activated)"),Object(n["createElementVNode"])("li",null,"Invite"),Object(n["createElementVNode"])("li",null,"Group Memberships and group roles (if any)")],-1),h=Object(n["createElementVNode"])("div",{class:"border my-4 px-2 py-1 font-bold bg-red-100 border-red-200 rounded text-red-800"}," This cannot be undone. ",-1);function O(e,t,o,O,f,g){var V=Object(n["resolveComponent"])("router-link"),w=Object(n["resolveComponent"])("note"),C=Object(n["resolveComponent"])("icon-edit"),N=Object(n["resolveComponent"])("dictionary-row"),v=Object(n["resolveComponent"])("membership-list"),y=Object(n["resolveComponent"])("tab-item"),x=Object(n["resolveComponent"])("person-profile"),M=Object(n["resolveComponent"])("coi-list"),D=Object(n["resolveComponent"])("tabs-container"),E=Object(n["resolveComponent"])("router-view"),k=Object(n["resolveComponent"])("modal-dialog"),_=Object(n["resolveComponent"])("custom-email-form"),P=Object(n["resolveComponent"])("button-row"),S=Object(n["resolveComponent"])("person-merge-form");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[Object(n["createElementVNode"])("header",r,[Object(n["createVNode"])(V,{class:"note",to:"/people"},{default:Object(n["withCtx"])((function(){return[a]})),_:1}),Object(n["createElementVNode"])("h1",l,[Object(n["createElementVNode"])("div",null,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.person.name)+" ",1),Object(n["createVNode"])(w,null,{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])("ID: "+Object(n["toDisplayString"])(e.person.id),1)]})),_:1})]),e.hasPermission("people-manage")||e.userIsPerson(e.person)?(Object(n["openBlock"])(),Object(n["createBlock"])(V,{key:0,to:"/people/".concat(o.uuid,"/edit"),class:"btn btn-xs flex-grow-0"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(C,{width:"16",heigh:"16"})]})),_:1},8,["to"])):Object(n["createCommentVNode"])("",!0)]),Object(n["createVNode"])(N,{label:"Email"},{label:Object(n["withCtx"])((function(){return[c]})),default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.person.email),1)]})),_:1}),Object(n["createVNode"])(N,{label:"Institution"},{label:Object(n["withCtx"])((function(){return[i]})),default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.person.institution?e.person.institution.name:null),1)]})),_:1})]),Object(n["createVNode"])(D,null,{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(y,{label:"groups"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(v,{person:e.person},null,8,["person"])]})),_:1}),Object(n["createVNode"])(y,{label:"Info"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(x,{person:e.person},null,8,["person"])]})),_:1}),Object(n["createVNode"])(y,{label:"Conflict of Interest"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(M,{person:e.person},null,8,["person"])]})),_:1}),Object(n["createVNode"])(y,{label:"Email Log",visible:e.hasPermission("people-manage")||e.userIsPerson(e.person)},{default:Object(n["withCtx"])((function(){return[0==g.sortedMailLog.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",s,Object(n["toDisplayString"])(e.person.first_name)+" has not received any mail via the GPM. ",1)):Object(n["createCommentVNode"])("",!0),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(g.sortedMailLog,(function(t){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{class:"w-3/4 my-4 p-4 border",key:t.id},[Object(n["createVNode"])(N,{label:"Date/Time"},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(O.formatDate(t.created_at)),1)]})),_:2},1024),Object(n["createVNode"])(N,{label:"Subject"},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.subject),1)]})),_:2},1024),Object(n["createVNode"])(N,{label:"Body"},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",{innerHTML:t.body},null,8,u)]})),_:2},1024),e.hasPermission("people-manage")?(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,class:"btn btn-xs",onClick:Object(n["withModifiers"])((function(e){return g.initResend(t)}),["stop"])},"Resend",8,d)):Object(n["createCommentVNode"])("",!0)])})),128))]})),_:1},8,["visible"]),Object(n["createVNode"])(y,{label:"Admin",visible:e.hasPermission("people-manage")},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("section",b,[p,Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("button",{class:"btn btn red",onClick:t[0]||(t[0]=function(){return g.initMerge&&g.initMerge.apply(g,arguments)})},"Merge Person into another")]),Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("button",{class:"btn btn red",onClick:t[1]||(t[1]=function(){return g.initDelete&&g.initDelete.apply(g,arguments)})},"Delete Person")])])]})),_:1},8,["visible"])]})),_:1}),(Object(n["openBlock"])(),Object(n["createBlock"])(n["Teleport"],{to:"body"},[Object(n["createVNode"])(k,{modelValue:g.showModal,"onUpdate:modelValue":t[2]||(t[2]=function(e){return g.showModal=e}),title:e.$route.meta.title},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(E,{name:"modal"})]})),_:1},8,["modelValue","title"]),Object(n["createVNode"])(k,{title:"Resend Email",modelValue:f.showResendDialog,"onUpdate:modelValue":t[3]||(t[3]=function(e){return f.showResendDialog=e})},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(_,{"mail-data":f.currentEmail,onSent:g.cleanupResend,onCanceled:g.cleanupResend},null,8,["mail-data","onSent","onCanceled"])]})),_:1},8,["modelValue"]),Object(n["createVNode"])(k,{title:"You are about to delete ".concat(e.person.name),modelValue:f.showDeleteConfirmation,"onUpdate:modelValue":t[4]||(t[4]=function(e){return f.showDeleteConfirmation=e})},{default:Object(n["withCtx"])((function(){return[m,j,h,Object(n["createVNode"])(P,{"submit-text":"Delete ".concat(e.person.name),onSubmitted:g.commitDelete,onCanceled:g.cancelDelete,"submit-variant":"red"},null,8,["submit-text","onSubmitted","onCanceled"])]})),_:1},8,["title","modelValue"]),Object(n["createVNode"])(k,{title:"Merge ".concat(e.person.name," into another person"),modelValue:f.showMergeForm,"onUpdate:modelValue":t[5]||(t[5]=function(e){return f.showMergeForm=e})},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(S,{obsolete:e.person,onSaved:g.handleMerged,onCanceled:g.handleMergeCanceled},null,8,["obsolete","onSaved","onCanceled"])]})),_:1},8,["title","modelValue"])]))])}var f=o("1da1"),g=o("2909"),V=o("5530"),w=(o("96cf"),o("4e82"),o("5502")),C=o("e328"),N=o("b442");function v(e,t,o,r,a,l){var c=Object(n["resolveComponent"])("data-table");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[Object(n["createVNode"])(c,{fields:a.fields,data:l.memberships,sort:a.sort,"onUpdate:sort":t[0]||(t[0]=function(e){return a.sort=e}),rowClickHandler:l.goToGroup,"row-class":function(){return"cursor-pointer"}},null,8,["fields","data","sort","rowClickHandler","row-class"])])}o("a15b"),o("d81d");var y=o("5313"),x={name:"MembershipList",props:{person:{type:Object,required:!0}},data:function(){return{sort:{field:"group.displayName",desc:!1},fields:[{name:"group.displayName",type:String,sortable:!0,label:"Name"},{name:"group.type.name",type:String,sortable:!0,label:"Type"},{name:"roles",type:String,sortable:!1,label:"Roles",resolveValue:function(e){return e.roles.map((function(e){return e.name})).join(", ")}},{name:"permissions",type:String,sortable:!1,label:"Permissions",resolveValue:function(e){return e.permissions.map((function(e){return e.name})).join(", ")}},{name:"start_date",type:Date,sortable:!0,label:"Started"},{name:"end_date",type:Date,sortable:!0,label:"Ended"}]}},computed:{memberships:function(){return this.person.memberships?this.person.memberships.map((function(e){return e.group&&(e.group=new y["b"](e.group)),e})):[]}},methods:{goToGroup:function(e){this.$router.push({name:"GroupDetail",params:{uuid:e.group.uuid}})}}},M=o("6b0d"),D=o.n(M);const E=D()(x,[["render",v]]);var k=E,_=o("c226"),P=Object(n["createElementVNode"])("p",{class:"mb-8"},[Object(n["createTextVNode"])(" Merging peple will do the following: "),Object(n["createElementVNode"])("ol",{class:"list-decimal ml-6"},[Object(n["createElementVNode"])("li",null,"Add the authoritative person to all groups of which the obsolete person is a member."),Object(n["createElementVNode"])("li",null,"Delete the obsolete person, their memberships, their invite, and their user account (if activated).")])],-1),S=Object(n["createTextVNode"])(" Merge "),T=Object(n["createTextVNode"])("(Obsolete person that will be deleted)"),B=Object(n["createTextVNode"])("Into "),R=Object(n["createTextVNode"])("(Authoritative person)");function I(e,t,o,r,a,l){var c=Object(n["resolveComponent"])("note"),i=Object(n["resolveComponent"])("person-search-select"),s=Object(n["resolveComponent"])("input-row"),u=Object(n["resolveComponent"])("button-row");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[P,Object(n["createVNode"])(s,{label:"Merge",vertical:""},{label:Object(n["withCtx"])((function(){return[S,Object(n["createVNode"])(c,{class:"inline-block"},{default:Object(n["withCtx"])((function(){return[T]})),_:1})]})),default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(i,{modelValue:a.obsoleteCopy,"onUpdate:modelValue":t[0]||(t[0]=function(e){return a.obsoleteCopy=e}),"allow-add":!1},null,8,["modelValue"])]})),_:1}),Object(n["createVNode"])(s,{label:"Into",errors:a.errors.authority_id,vertical:""},{label:Object(n["withCtx"])((function(){return[B,Object(n["createVNode"])(c,{class:"inline"},{default:Object(n["withCtx"])((function(){return[R]})),_:1})]})),default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(i,{modelValue:a.authorityCopy,"onUpdate:modelValue":t[1]||(t[1]=function(e){return a.authorityCopy=e}),"allow-add":!1},null,8,["modelValue"])]})),_:1},8,["errors"]),Object(n["createVNode"])(u,{"submit-text":"Merge",onSubmitted:l.commitMerge,onCanceled:l.cancelMerge},null,8,["onSubmitted","onCanceled"])])}var $=o("db04"),L={name:"PersonMergeForm",props:{authority:{type:Object,required:!1},obsolete:{type:Object,default:function(){return{}}}},emits:["saved","canceled"],data:function(){return{authorityCopy:null,obsoleteCopy:null,errors:{}}},watch:{authority:{immediate:!0,handler:function(e){e&&(this.authorityCopy=Object(V["a"])({},e.attributes))}},obsolete:{immediate:!0,handler:function(e){e&&(this.obsoleteCopy=Object(V["a"])({},e.attributes))}}},methods:{commitMerge:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.errors={},t.next=4,e.$store.dispatch("people/mergePeople",{authority:e.authorityCopy,obsolete:e.obsoleteCopy});case 4:e.authorityId=null,e.obsoleteIds=null,e.$emit("saved"),t.next=14;break;case 9:if(t.prev=9,t.t0=t["catch"](0),!Object($["b"])(t.t0)){t.next=14;break}return e.errors=t.t0.response.data.errors,t.abrupt("return");case 14:case"end":return t.stop()}}),t,null,[[0,9]])})))()},cancelMerge:function(){this.authorityId=null,this.obsoleteId=null,this.$emit("canceled")}}};const F=D()(L,[["render",I]]);var U=F,G=o("6a6b"),H={name:"PersonDetail",components:{TabsContainer:N["default"],MembershipList:k,PersonProfile:_["a"],PersonMergeForm:U,CoiList:G["a"]},props:{uuid:{required:!0,type:String}},data:function(){return{emails:[],currentEmail:{},showResendDialog:null,showDeleteConfirmation:!1,showMergeForm:!1}},watch:{uuid:{immediate:!0,handler:function(){this.$store.dispatch("people/getPerson",{uuid:this.uuid})}}},computed:Object(V["a"])(Object(V["a"])({},Object(w["b"])({person:"people/currentItem"})),{},{showModal:{get:function(){return this.$route.meta.showModal},set:function(e){e&&this.$router.push({name:"PersonEdit",params:{uuid:this.person.uuid}}),this.$router.push({name:"PersonDetail",params:{uuid:this.person.uuid}})}},sortedMailLog:function(){return Object(g["a"])(this.person.mailLog).sort((function(e,t){return e.created_at==t.created_at?0:Date.parse(e.created_at)>Date.parse(t.created_at)?-1:1}))}}),methods:{initResend:function(e){this.currentEmail=Object(V["a"])({},e),this.showResendDialog=!0},cleanupResend:function(){this.currentEmail={},this.showResendDialog=!1,this.$store.dispatch("people/getMail",this.person)},initDelete:function(){this.showDeleteConfirmation=!0},commitDelete:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("people/deletePerson",e.person);case 2:e.showDeleteConfirmation=!1,e.$router.go(-1);case 4:case"end":return t.stop()}}),t)})))()},cancelDelete:function(){this.showDeleteConfirmation=!1},initMerge:function(){this.showMergeForm=!0},handleMerged:function(){this.showMergeForm=!1,this.$router.go(-1)},handleMergeCanceled:function(){this.showMergeForm=!1}},setup:function(){return{formatDate:C["c"]}},mounted:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("people/getPerson",{uuid:e.uuid});case 2:e.$store.dispatch("people/getMail",e.person);case 3:case"end":return t.stop()}}),t)})))()}};const A=D()(H,[["render",O]]);t["default"]=A}}]);
//# sourceMappingURL=chunk-2d0d6d92.d416a838.js.map