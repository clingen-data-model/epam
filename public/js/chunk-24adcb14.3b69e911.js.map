{"version":3,"sources":["webpack:///./src/views/PersonEdit.vue","webpack:///./src/views/PersonEdit.vue?1701","webpack:///./src/components/people/ProfilePhotoForm.vue","webpack:///./src/components/people/ProfilePhotoForm.vue?8a9d","webpack:///./src/forms/profile_form.js","webpack:///./src/components/people/ProfileForm.vue","webpack:///./src/components/people/ProfileForm.vue?eb3a"],"names":["_createElementBlock","_createVNode","_component_profile_form","person","$options","$event","onSaved","onCanceled","name","components","ProfileForm","props","uuid","required","type","String","computed","this","$store","getters","watch","immediate","handler","dispatch","methods","goBack","$router","go","__exports__","render","class","_createElementVNode","src","alt","onClick","_createBlock","_Teleport","to","_component_modal_dialog","$data","title","_component_ImageCropper","image-src","onCropped","_component_input_row","hideLabel","errors","profile_photo","onChange","ref","_component_button_row","submit-text","onSubmitted","ImageCropper","Object","data","showForm","file","croppedImageBlob","deep","fetchProfileImage","srcPath","console","log","URL","createObjectURL","profilePhoto","altText","profile_photo_path","initUpload","$nextTick","window","dispatchEvent","Event","setFile","$refs","fileInput","files","setCroppedImageBlob","blob","url","options","Accept","timeout","responseType","api","get","then","rsp","Blob","saveCropped","size","width","img","Image","addEventListener","evt","canvas","document","createElement","ctx","getContext","oc","octx","height","cur","Math","floor","drawImage","toBlob","storeImage","formData","FormData","append","post","catch","error","isValidationError","response","cancelCropped","lookups","countries","primaryOccupations","races","ethnicities","genders","profileFields","label","component","InstitutionSearchSelect","AddressInput","value","TimezoneSearchSelect","demographicFields","placeholder","show","primary_occupation_id","race_id","enthnicity_id","gender_id","getLookups","keys","forEach","lkup","kebabCase","map","i","id","_hoisted_1","_component_profile_photo_form","$props","style","_component_data_form","fields","_hoisted_3","ProfilePhotoForm","emits","profile","page","institutionId","timezone","editableFields","hasPermission","userIsPerson","filter","f","includes","initProfile","attributes","save","force","commit","$emit","cancel","setup","onMounted","mounted"],"mappings":"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","file":"js/chunk-24adcb14.3b69e911.js","sourcesContent":["<template>\n    <div>\n        <profile-form :person=\"person\"\n            v-model=\"person\"\n            @saved=\"goBack()\"\n            @canceled=\"goBack()\"\n        ></profile-form>\n    </div>\n</template>\n<script>\nimport ProfileForm from '@/components/people/ProfileForm.vue'\n\nexport default {\n    name: 'PersonEdit',\n    components: {\n        ProfileForm\n    },\n    props: {\n        uuid: {\n            required: true,\n            type: String\n        }\n    },\n    computed: {\n        person () {\n            return this.$store.getters['people/currentItem'];\n        }\n    },\n    watch: {\n        uuid: {\n            immediate: true,\n            handler () {\n                this.$store.dispatch('people/getPerson', {uuid: this.uuid});\n            }\n        }\n    },\n    methods: {\n        goBack () {\n            this.$router.go(-1);\n        }\n    }\n}\n</script>","import { render } from \"./PersonEdit.vue?vue&type=template&id=7ddf0198\"\nimport script from \"./PersonEdit.vue?vue&type=script&lang=js\"\nexport * from \"./PersonEdit.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/yugen/code/epam/resources/app/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\n    <div>\n        <div class=\"border border-gray-200 rounded-lg\">\n            <img \n                :src=\"srcPath\" \n                :alt=\"altText\"\n                class=\"rounded-t-lg\"\n                @click=\"initUpload\"\n            >\n            <button \n                @click=\"initUpload\"\n                class=\"border border-t-0 bg-gray-200 block w-full\"\n            >\n                Edit\n            </button>\n        </div>\n\n        <teleport to='body'>\n            <modal-dialog v-model=\"showForm\" title=\"Upload a new profile photo\">\n                <ImageCropper \n                    :image-src=\"srcPath\" \n                    @cropped=\"setCroppedImageBlob\"\n                />\n\n                <input-row hideLabel :errors=\"errors.profile_photo\">\n                    <input type=\"file\" @change=\"setFile\" ref=\"fileInput\">\n                </input-row>\n\n\n                <button-row submit-text=\"Save\" @submitted=\"saveCropped\" @canceled=\"cancelCropped\" />\n            </modal-dialog>\n        </teleport>\n    </div>\n</template>\n<script>\nimport ImageCropper from '@/components/ImageCropper.vue'\nimport {api, isValidationError} from '@/http'\n\nexport default {\n    name: 'ProfilePhotoForm',\n    components: {\n        ImageCropper\n    },\n    props: {\n        person: {\n            type: Object,\n            required: true\n        }\n    },\n    data() {\n        return {\n            showForm: false,\n            file: null,\n            croppedImageBlob: null,\n            errors: {}\n        }\n    },\n    watch: {\n        person: {\n            immediate: true,\n            deep: true,\n            handler (to) {\n                if (to.profile_photo) {\n                    this.fetchProfileImage();\n                }\n            }\n        }\n    },\n    computed: {\n        srcPath () {\n            if (this.file) {\n                console.log('create from this.file');\n                return URL.createObjectURL(this.file);\n            }\n            if (this.person.profile_photo) {\n                return `/profile-photos/${this.person.profile_photo}`\n            }\n            return '/images/default_profile.jpg';\n        },\n        profilePhoto () {\n            if (this.person.profile_photo) {\n                return `/profile-photos/${this.person.profile_photo}`\n            }\n            return '/images/default_profile.jpg';\n        },\n        altText () {\n            return this.person.profile_photo_path \n                ? `${this.person.name} profile photo.` \n                : 'Default profile image';\n        },\n    },\n    methods: {\n        initUpload () {\n            this.showForm = true;\n            this.$nextTick(() => {\n                window.dispatchEvent(new Event('resize'));\n            });\n        },\n        setFile () {\n            this.file = this.$refs.fileInput.files[0]\n        },\n        setCroppedImageBlob (blob) {            \n            this.croppedImageBlob = blob;\n        },\n        async fetchProfileImage () {\n            const url = `/api/people/${this.person.uuid}/profile-photo`;\n            const options = {\n                Accept: 'application/octet-stream',\n                timeout: 30000,\n                responseType: 'blob'\n            };\n            this.file = await api.get(url, options)\n                            .then(rsp => {\n                                if( !(rsp.data instanceof Blob)) return;\n\n                                return new Blob([rsp.data]);\n                            });\n        },\n        saveCropped () {\n            if (this.croppedImageBlob.size > 2000000) {\n                const width = 400;\n                const img = new Image();\n                img.src = URL.createObjectURL(this.croppedImageBlob);\n\n                img.addEventListener('load', (evt) => {\n                    var canvas = document.createElement('canvas'),\n                    ctx = canvas.getContext(\"2d\"),\n\n                    oc = document.createElement('canvas'),\n                    octx = oc.getContext('2d');\n\n                    canvas.width = width; // destination canvas size\n                    canvas.height = canvas.width * img.height / img.width;\n\n                    var cur = {\n                        width: Math.floor(img.width * 0.5),\n                        height: Math.floor(img.height * 0.5)\n                    }\n\n                    oc.width = cur.width;\n                    oc.height = cur.height;\n\n                    octx.drawImage(img, 0, 0, cur.width, cur.height);\n\n                    while (cur.width * 0.5 > width) {\n                        cur = {\n                            width: Math.floor(cur.width * 0.5),\n                            height: Math.floor(cur.height * 0.5)\n                        };\n                        octx.drawImage(oc, 0, 0, cur.width * 2, cur.height * 2, 0, 0, cur.width, cur.height);\n                    }\n                    ctx.drawImage(oc, 0, 0, cur.width, cur.height, 0, 0, canvas.width, canvas.height);\n                    canvas.toBlob(blob => {\n                        console.log(blob.size/1000/1000);\n                        this.storeImage(blob);\n                    })\n                });\n\n                return;\n            }\n\n            this.storeImage(this.croppedImageBlob)\n        },\n        storeImage (blob) {\n            const formData = new FormData();\n\n            formData.append('profile_photo', blob);\n\n            api.post(`/api/people/${this.person.uuid}/profile-photo`, formData)\n                .then(() => {\n                    this.$store.dispatch('people/getPerson', {uuid: this.person.uuid});\n                    this.showForm = false;\n                    this.file = null;\n                })\n                .catch(error => {\n                    if (isValidationError(error)) {\n                        this.errors = error.response.data.errors;\n                    }\n                });\n        },\n        cancelCropped () {\n            this.showForm = false;\n            this.file = null;\n        }\n    }\n}\n</script>","import { render } from \"./ProfilePhotoForm.vue?vue&type=template&id=4230efd8\"\nimport script from \"./ProfilePhotoForm.vue?vue&type=script&lang=js\"\nexport * from \"./ProfilePhotoForm.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/yugen/code/epam/resources/app/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import {ref, computed} from 'vue';\nimport api from '@/http/api';\nimport {kebabCase} from '@/utils'\nimport TimezoneSearchSelect from '@/components/forms/TimezoneSearchSelect.vue'\nimport InstitutionSearchSelect from '@/components/forms/InstitutionSearchSelect.vue'\nimport AddressInput from '@/components/forms/AddressInput.vue'\n\nexport const lookups = ref({\n    countries:[],\n    primaryOccupations:[],\n    races:[],\n    ethnicities:[],\n    genders:[],\n});\n\nexport const profileFields = computed(() => [\n    { name: 'first_name'},\n    { name: 'last_name'},\n    { name: 'email'},\n    {\n        name: 'institution_id',\n        label: 'Institution',\n        type: 'component',\n        component: InstitutionSearchSelect\n    },\n    { name: 'credentials', type: 'large-text'},\n    { name: 'biography', type: 'large-text'},\n    {\n        name: '*', // specifies passing entire modelValue to component.\n        type: 'component',\n        label: 'Address',\n        component: AddressInput\n    },\n    { \n        name: 'country_id', \n        label: 'Country',\n        type: 'select', \n        options: lookups.value.countries\n    },\n    { name: 'phone'},\n    { \n        name: 'timezone', \n        label: 'Timezone',\n        type: 'component', \n        component: TimezoneSearchSelect\n    },\n]);\n\nexport const demographicFields = computed(() => [\n    {\n        name: 'primary_occupation_id',\n        label: 'Primary Occupation',\n        type: 'select',\n        options: lookups.value.primaryOccupations\n    },\n    {\n        name: 'primary_occupation_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.primary_occupation_id == 100\n        }\n    },\n    {\n        name: 'race_id',\n        label: 'Race',\n        type: 'select',\n        options: lookups.value.races\n    },\n    {\n        name: 'race_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.race_id == 100\n        }\n    },\n    {\n        name: 'ethnicity_id',\n        label: 'Ethnicity',\n        type: 'select',\n        options: lookups.value.ethnicities\n    },\n    {\n        name: 'enthnicity_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.enthnicity_id == 100\n        }\n    },\n    {\n        name: 'gender_id',\n        label: 'Gender',\n        type: 'select',\n        options: lookups.value.genders\n    },\n    {\n        name: 'gender_other',\n        label: ' ',\n        type: 'text',\n        placeholder: 'Details',\n        show: (data) => {\n            return data.gender_id == 100\n        }\n    },\n]);\n\nexport const getLookups = () => {\n    Object.keys(lookups.value).forEach(lkup => {\n        api.get(`/api/people/lookups/${kebabCase(lkup)}`)\n            .then(response => {\n                lookups.value[lkup] = response.data.data.map(i => ({value: i.id, label: i.name}));\n            })\n            .catch(error => console.error(error));\n    })\n}\n\nexport default {\n    profileFields,\n    demographicFields,\n    lookups,\n    getLookups,\n}","<template>\n    <div>\n        <h3>Profile</h3>\n        <div class=\"float-right\">\n            <profile-photo-form :person=\"person\" style=\"width: 100px; height: 100px;\" />\n        </div>\n        <data-form \n            :fields=\"fields\" \n            v-model=\"profile\" \n            :errors=\"errors\"\n        ></data-form>\n        <hr class=\"my-4\">\n\n        <!-- <h3>Demographics</h3>\n        <data-form \n            :fields=\"demographicFields\" \n            v-model=\"profile\" \n            :errors=\"errors\"\n        ></data-form> -->\n\n        <button-row @submitted=\"save\" @canceled=\"cancel()\" submit-text=\"Save\"></button-row>\n    </div>\n</template>\n<script>\nimport isValidationError from '@/http/is_validation_error'\nimport {onMounted} from 'vue'\nimport {getLookups, profileFields, demographicFields, lookups} from '@/forms/profile_form';\nimport ProfilePhotoForm from '@/components/people/ProfilePhotoForm.vue';\nexport default {\n    name: 'ProfileForm',\n    components: {\n        ProfilePhotoForm\n    },\n    props: {\n        person: {\n            type: Object,\n            required: true\n        }\n    },\n    emits: [\n        'saved',\n        'canceled'\n    ],\n    data() {\n        return {\n            errors: {},\n            profile: {},\n            page: 'profile',\n            institutionId: null,\n            timezone: null\n        }\n    },\n    computed: {\n        fields () {\n            let editableFields = [...this.profileFields];\n            if (!this.hasPermission('people-manage') && !this.userIsPerson(this.person)) {\n                editableFields =  editableFields.filter(f => ['first_name', 'last_name', 'email'].includes(f.name));\n            }\n            return editableFields;\n\n            // return (this.page == 'profile') ? this.profileFields : this.demographicFields;\n        },\n        title () {\n            return this.page == 'profile' ? 'Please fill out your profile' : 'Please share your demographic information.'\n        }\n    },\n    watch: {\n        person () {\n            this.initProfile();\n        }\n    },\n    methods: {\n        initProfile () {\n            this.profile = {...this.person.attributes};\n        },\n        async save () {\n            try {\n                await this.$store.dispatch(\n                        'people/updateProfile', \n                        {uuid: this.person.uuid, attributes: this.profile}\n                    )                \n                    .then(() => {\n                        this.$store.dispatch('getCurrentUser', {force: true})\n                        this.$store.commit('pushSuccess', 'Your profile has been updated.')\n                    })\n                    \n                this.errors = {};\n                this.$emit('saved');\n            } catch (error) {\n                if (isValidationError(error)) {\n                    this.errors = error.response.data.errors;\n                }\n            }\n        },\n        cancel () {\n            this.initProfile();\n            this.errors = {};\n            this.$emit('canceled');\n        }\n    },\n    setup () {\n        onMounted(() => getLookups());\n\n        return {\n            profileFields,\n            demographicFields,\n            getLookups,\n            lookups,\n        }\n    },\n    async mounted () {\n        this.initProfile()\n    }\n}\n</script>","import { render } from \"./ProfileForm.vue?vue&type=template&id=3ede90a3\"\nimport script from \"./ProfileForm.vue?vue&type=script&lang=js\"\nexport * from \"./ProfileForm.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/yugen/code/epam/resources/app/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}