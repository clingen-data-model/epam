(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24adcb14"],{1081:function(e,t,o){"use strict";o.r(t);var n=o("7a23");function r(e,t,o,r,i,a){var c=Object(n["resolveComponent"])("profile-form");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[Object(n["createVNode"])(c,{person:a.person,modelValue:a.person,"onUpdate:modelValue":t[0]||(t[0]=function(e){return a.person=e}),onSaved:t[1]||(t[1]=function(e){return a.goBack()}),onCanceled:t[2]||(t[2]=function(e){return a.goBack()})},null,8,["person","modelValue"])])}var i=o("5f08"),a={name:"PersonEdit",components:{ProfileForm:i["a"]},props:{uuid:{required:!0,type:String}},computed:{person:function(){return this.$store.getters["people/currentItem"]}},watch:{uuid:{immediate:!0,handler:function(){this.$store.dispatch("people/getPerson",{uuid:this.uuid})}}},methods:{goBack:function(){this.$router.go(-1)}}},c=o("6b0d"),l=o.n(c);const s=l()(a,[["render",r]]);t["default"]=s},"1f2d":function(e,t,o){"use strict";var n=o("7a23"),r={class:"border border-gray-200 rounded-lg"},i=["src","alt"],a={key:1};function c(e,t,o,c,l,s){var u=Object(n["resolveComponent"])("ImageCropper"),p=Object(n["resolveComponent"])("input-row"),d=Object(n["resolveComponent"])("button-row"),h=Object(n["resolveComponent"])("modal-dialog");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{class:Object(n["normalizeClass"])({"cursor-wait":l.saving})},[Object(n["createElementVNode"])("div",r,[Object(n["createElementVNode"])("img",{src:s.srcPath,alt:s.altText,class:"rounded-t-lg w-full",onClick:t[0]||(t[0]=function(){return s.initUpload&&s.initUpload.apply(s,arguments)})},null,8,i),Object(n["createElementVNode"])("button",{onClick:t[1]||(t[1]=function(){return s.initUpload&&s.initUpload.apply(s,arguments)}),class:"border border-t-0 bg-gray-200 block w-full"}," Edit ")]),(Object(n["openBlock"])(),Object(n["createBlock"])(n["Teleport"],{to:"body"},[Object(n["createVNode"])(h,{modelValue:l.showForm,"onUpdate:modelValue":t[3]||(t[3]=function(e){return l.showForm=e}),title:"Upload a new profile photo"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(u,{"image-src":s.srcPath,onCropped:s.setCroppedImageBlob},null,8,["image-src","onCropped"]),Object(n["createVNode"])(p,{hideLabel:"",errors:l.errors.profile_photo},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("input",{type:"file",onChange:t[2]||(t[2]=function(){return s.setFile&&s.setFile.apply(s,arguments)}),ref:"fileInput"},null,544)]})),_:1},8,["errors"]),l.saving?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",a,"Saving...")):(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:0,"submit-text":"Save",onSubmitted:s.saveCropped,onCanceled:s.cancelCropped},null,8,["onSubmitted","onCanceled"]))]})),_:1},8,["modelValue"])]))],2)}var l=o("1da1"),s=(o("96cf"),o("d3b7"),o("3ca3"),o("ddb0"),o("2b3d"),o("9861"),o("b0c0"),o("450c")),u=o("db04"),p={name:"ProfilePhotoForm",components:{ImageCropper:s["default"]},props:{person:{type:Object,required:!0}},data:function(){return{showForm:!1,file:null,croppedImageBlob:null,errors:{},saving:!1}},watch:{person:{immediate:!0,deep:!0,handler:function(e){e.profile_photo&&this.fetchProfileImage()}}},computed:{srcPath:function(){return this.file?(console.log("create from this.file"),URL.createObjectURL(this.file)):this.person.profile_photo?"/profile-photos/".concat(this.person.profile_photo):"/images/default_profile.jpg"},profilePhoto:function(){return this.person.profile_photo?"/profile-photos/".concat(this.person.profile_photo):"/images/default_profile.jpg"},altText:function(){return this.person.profile_photo_path?"".concat(this.person.name," profile photo."):"Default profile image"}},methods:{initUpload:function(){this.showForm=!0,this.$nextTick((function(){window.dispatchEvent(new Event("resize"))}))},setFile:function(){this.file=this.$refs.fileInput.files[0]},setCroppedImageBlob:function(e){this.croppedImageBlob=e},fetchProfileImage:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o="/api/people/".concat(e.person.uuid,"/profile-photo"),n={Accept:"application/octet-stream",timeout:3e4,responseType:"blob"},t.next=4,u["a"].get(o,n).then((function(e){if(e.data instanceof Blob)return new Blob([e.data])}));case 4:e.file=t.sent;case 5:case"end":return t.stop()}}),t)})))()},saveCropped:function(){var e=this;if(this.croppedImageBlob.size>2e6){var t=400,o=new Image;return o.src=URL.createObjectURL(this.croppedImageBlob),void o.addEventListener("load",(function(){var n=document.createElement("canvas"),r=n.getContext("2d"),i=document.createElement("canvas"),a=i.getContext("2d");n.width=t,n.height=n.width*o.height/o.width;var c={width:Math.floor(.5*o.width),height:Math.floor(.5*o.height)};i.width=c.width,i.height=c.height,a.drawImage(o,0,0,c.width,c.height);while(.5*c.width>t)c={width:Math.floor(.5*c.width),height:Math.floor(.5*c.height)},a.drawImage(i,0,0,2*c.width,2*c.height,0,0,c.width,c.height);r.drawImage(i,0,0,c.width,c.height,0,0,n.width,n.height),n.toBlob((function(t){console.log(t.size/1e3/1e3),e.storeImage(t)}),null,.5)}))}this.storeImage(this.croppedImageBlob)},storeImage:function(e){var t=this;this.saving=!0;var o=new FormData;o.append("profile_photo",e),u["a"].post("/api/people/".concat(this.person.uuid,"/profile-photo"),o).then((function(){t.$store.dispatch("people/getPerson",{uuid:t.person.uuid}),t.showForm=!1,t.file=null,t.saving=!1})).catch((function(e){if(Object(u["b"])(e))return t.errors=e.response.data.errors,void(t.saving=!1);throw t.saving=!1,e}))},cancelCropped:function(){this.showForm=!1,this.file=null}}},d=o("6b0d"),h=o.n(d);const f=h()(p,[["render",c]]);t["a"]=f},"48e8":function(e,t,o){"use strict";o.d(t,"c",(function(){return s})),o.d(t,"d",(function(){return u})),o.d(t,"a",(function(){return p})),o.d(t,"b",(function(){return d}));o("d3b7"),o("159b"),o("b64b"),o("d81d"),o("b0c0");var n=o("7a23"),r=o("f96b"),i=o("025e"),a=o("2297"),c=o("05b6"),l=o("526b"),s=Object(n["ref"])({countries:[],primaryOccupations:[],races:[],ethnicities:[],genders:[]}),u=Object(n["computed"])((function(){return[{name:"first_name"},{name:"last_name"},{name:"email"},{name:"institution_id",label:"Institution",type:"component",component:c["default"]},{name:"credentials",type:"large-text",notes:"Include degrees and certifications such as PhD, MD, CGC, etc."},{name:"biography",type:"large-text"},{name:"*",type:"component",label:"Address",component:l["default"]},{name:"country_id",label:"Country",type:"select",options:s.value.countries},{name:"phone"},{name:"timezone",label:"Timezone",type:"component",component:a["default"]}]})),p=Object(n["computed"])((function(){return[{name:"primary_occupation_id",label:"Primary Occupation",type:"select",options:s.value.primaryOccupations},{name:"primary_occupation_other",label:" ",type:"text",placeholder:"Details",show:function(e){return 100==e.primary_occupation_id}},{name:"race_id",label:"Race",type:"select",options:s.value.races},{name:"race_other",label:" ",type:"text",placeholder:"Details",show:function(e){return 100==e.race_id}},{name:"ethnicity_id",label:"Ethnicity",type:"select",options:s.value.ethnicities},{name:"enthnicity_other",label:" ",type:"text",placeholder:"Details",show:function(e){return 100==e.enthnicity_id}},{name:"gender_id",label:"Gender",type:"select",options:s.value.genders},{name:"gender_other",label:" ",type:"text",placeholder:"Details",show:function(e){return 100==e.gender_id}}]})),d=function(){Object.keys(s.value).forEach((function(e){r["a"].get("/api/people/lookups/".concat(Object(i["c"])(e))).then((function(t){s.value[e]=t.data.data.map((function(e){return{value:e.id,label:e.name}}))})).catch((function(e){return console.error(e)}))}))}},"5f08":function(e,t,o){"use strict";var n=o("7a23"),r=Object(n["createElementVNode"])("h3",null,"Profile",-1),i={class:"float-right"},a=Object(n["createElementVNode"])("hr",{class:"my-4"},null,-1);function c(e,t,o,c,l,s){var u=Object(n["resolveComponent"])("profile-photo-form"),p=Object(n["resolveComponent"])("data-form"),d=Object(n["resolveComponent"])("button-row");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[r,Object(n["createElementVNode"])("div",i,[Object(n["createVNode"])(u,{person:o.person,style:{width:"100px",height:"100px"}},null,8,["person"])]),Object(n["createVNode"])(p,{fields:s.fields,modelValue:l.profile,"onUpdate:modelValue":t[0]||(t[0]=function(e){return l.profile=e}),errors:l.errors},null,8,["fields","modelValue","errors"]),a,Object(n["createVNode"])(d,{onSubmitted:s.save,onCanceled:t[1]||(t[1]=function(e){return s.cancel()}),"submit-text":"Save"},null,8,["onSubmitted"])])}var l=o("1da1"),s=o("5530"),u=o("2909"),p=(o("96cf"),o("4de4"),o("d3b7"),o("caad"),o("b0c0"),o("033d")),d=o("48e8"),h=o("1f2d"),f={name:"ProfileForm",components:{ProfilePhotoForm:h["a"]},props:{person:{type:Object,required:!0}},emits:["saved","canceled"],data:function(){return{errors:{},profile:{},page:"profile",institutionId:null,timezone:null}},computed:{fields:function(){var e=Object(u["a"])(this.profileFields);return this.hasPermission("people-manage")||this.userIsPerson(this.person)||(e=e.filter((function(e){return["first_name","last_name","email"].includes(e.name)}))),e},title:function(){return"profile"==this.page?"Please fill out your profile":"Please share your demographic information."}},watch:{person:function(){this.initProfile()}},methods:{initProfile:function(){this.profile=Object(s["a"])({},this.person.attributes)},save:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$store.dispatch("people/updateProfile",{uuid:e.person.uuid,attributes:e.profile}).then((function(){e.$store.dispatch("getCurrentUser",{force:!0}),e.$store.commit("pushSuccess","Your profile has been updated.")}));case 3:e.errors={},e.$emit("saved"),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),Object(p["a"])(t.t0)&&(e.errors=t.t0.response.data.errors);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},cancel:function(){this.initProfile(),this.errors={},this.$emit("canceled")}},setup:function(){return Object(n["onMounted"])((function(){return Object(d["b"])()})),{profileFields:d["d"],demographicFields:d["a"],getLookups:d["b"],lookups:d["c"]}},mounted:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.initProfile();case 1:case"end":return t.stop()}}),t)})))()}},m=o("6b0d"),b=o.n(m);const g=b()(f,[["render",c]]);t["a"]=g}}]);
//# sourceMappingURL=chunk-24adcb14.5e8382f7.js.map