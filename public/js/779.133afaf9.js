"use strict";(self["webpackChunkepam"]=self["webpackChunkepam"]||[]).push([[779],{1202:function(e,t,o){o.d(t,{Rc:function(){return c},bA:function(){return h},oo:function(){return d},tV:function(){return u}});var i=o(2262),r=o(6252),n=o(812),s=o(8661),a=o(9298),l=o(4569),p=o(1350);const h=(0,i.iH)({countries:[],primaryOccupations:[],races:[],ethnicities:[],genders:[]}),d=(0,r.Fl)((()=>[{name:"first_name"},{name:"last_name"},{name:"email"},{name:"institution_id",label:"Institution",type:"component",component:{component:l["default"]}},{name:"credentials",type:"large-text",notes:"Include degrees and certifications such as PhD, MD, CGC, etc. Please include professional roles and associations in your biography."},{name:"biography",type:"large-text"},{name:"*",type:"component",label:"Address",component:{component:p["default"]}},{name:"country_id",label:"Country",type:"select",options:h.value.countries},{name:"phone"},{name:"timezone",label:"Timezone",type:"component",component:{component:a["default"]}}])),c=(0,r.Fl)((()=>[{name:"primary_occupation_id",label:"Primary Occupation",type:"select",options:h.value.primaryOccupations},{name:"primary_occupation_other",label:" ",type:"text",placeholder:"Details",show:e=>100==e.primary_occupation_id},{name:"race_id",label:"Race",type:"select",options:h.value.races},{name:"race_other",label:" ",type:"text",placeholder:"Details",show:e=>100==e.race_id},{name:"ethnicity_id",label:"Ethnicity",type:"select",options:h.value.ethnicities},{name:"enthnicity_other",label:" ",type:"text",placeholder:"Details",show:e=>100==e.enthnicity_id},{name:"gender_id",label:"Gender",type:"select",options:h.value.genders},{name:"gender_other",label:" ",type:"text",placeholder:"Details",show:e=>100==e.gender_id}])),u=()=>{Object.keys(h.value).forEach((e=>{n.Z.get(`/api/people/lookups/${(0,s.GL)(e)}`).then((t=>{h.value[e]=t.data.data.map((e=>({value:e.id,label:e.name})))})).catch((e=>console.error(e)))}))}},6465:function(e,t,o){o.d(t,{Z:function(){return m}});var i=o(6252);const r=(0,i._)("h3",null,"Profile",-1),n={key:0,class:"float-right"},s=(0,i._)("hr",{class:"my-4"},null,-1);function a(e,t,o,a,l,p){const h=(0,i.up)("profile-photo-form"),d=(0,i.up)("data-form"),c=(0,i.up)("button-row");return(0,i.wg)(),(0,i.iD)("div",null,[r,e.hasPermission("people-manage")||e.userIsPerson(o.person)?((0,i.wg)(),(0,i.iD)("div",n,[(0,i.Wm)(h,{person:o.person,style:{width:"100px",height:"100px"}},null,8,["person"])])):(0,i.kq)("",!0),(0,i.Wm)(d,{fields:p.fields,modelValue:l.profile,"onUpdate:modelValue":t[0]||(t[0]=e=>l.profile=e),errors:l.errors},null,8,["fields","modelValue","errors"]),s,(0,i.Wm)(c,{onSubmitted:p.save,onCanceled:t[1]||(t[1]=e=>p.cancel()),"submit-text":"Save"},null,8,["onSubmitted"])])}o(6699);var l=o(9700),p=o(1202),h=o(2998),d={name:"ProfileForm",components:{ProfilePhotoForm:h.Z},props:{person:{type:Object,required:!0}},emits:["saved","canceled"],data(){return{errors:{},profile:{},page:"profile",institutionId:null,timezone:null}},computed:{fields(){let e=[...this.profileFields];return this.hasPermission("people-manage")||this.userIsPerson(this.person)||(e=e.filter((e=>["first_name","last_name","email","credentials"].includes(e.name)))),e},title(){return"profile"==this.page?"Please fill out your profile":"Please share your demographic information."}},watch:{person(){this.initProfile()}},methods:{initProfile(){this.profile={...this.person.attributes}},async save(){try{await this.$store.dispatch("people/updateProfile",{uuid:this.person.uuid,attributes:this.profile}).then((()=>{this.$store.dispatch("getCurrentUser",{force:!0}),this.$store.commit("pushSuccess","Your profile has been updated.")})),this.errors={},this.$emit("saved")}catch(e){(0,l.Z)(e)&&(this.errors=e.response.data.errors)}},cancel(){this.initProfile(),this.errors={},this.$emit("canceled")}},setup(){return(0,i.bv)((()=>(0,p.tV)())),{profileFields:p.oo,demographicFields:p.Rc,getLookups:p.tV,lookups:p.bA}},async mounted(){this.initProfile()}},c=o(3744);const u=(0,c.Z)(d,[["render",a]]);var m=u},2998:function(e,t,o){o.d(t,{Z:function(){return m}});var i=o(6252),r=o(3577);const n={class:"border border-gray-200 rounded-lg"},s=["src","alt"],a={key:1};function l(e,t,o,l,p,h){const d=(0,i.up)("ImageCropper"),c=(0,i.up)("input-row"),u=(0,i.up)("button-row"),m=(0,i.up)("modal-dialog");return(0,i.wg)(),(0,i.iD)("div",{class:(0,r.C_)({"cursor-wait":p.saving})},[(0,i._)("div",n,[(0,i._)("img",{src:h.srcPath,alt:h.altText,class:"rounded-t-lg w-full",onClick:t[0]||(t[0]=(...e)=>h.initUpload&&h.initUpload(...e))},null,8,s),(0,i._)("button",{onClick:t[1]||(t[1]=(...e)=>h.initUpload&&h.initUpload(...e)),class:"border border-t-0 bg-gray-200 block w-full"}," Edit ")]),((0,i.wg)(),(0,i.j4)(i.lR,{to:"body"},[(0,i.Wm)(m,{modelValue:p.showForm,"onUpdate:modelValue":t[3]||(t[3]=e=>p.showForm=e),title:"Upload a new profile photo"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{"image-src":h.srcPath,onCropped:h.setCroppedImageBlob},null,8,["image-src","onCropped"]),(0,i.Wm)(c,{hideLabel:"",errors:p.errors.profile_photo},{default:(0,i.w5)((()=>[(0,i._)("input",{type:"file",onChange:t[2]||(t[2]=(...e)=>h.setFile&&h.setFile(...e)),ref:"fileInput"},null,544)])),_:1},8,["errors"]),p.saving?((0,i.wg)(),(0,i.iD)("div",a,"Saving...")):((0,i.wg)(),(0,i.j4)(u,{key:0,"submit-text":"Save",onSubmitted:h.saveCropped,onCanceled:h.cancelCropped},null,8,["onSubmitted","onCanceled"]))])),_:1},8,["modelValue"])]))],2)}var p=o(6058),h=o(9028),d={name:"ProfilePhotoForm",components:{ImageCropper:p["default"]},props:{person:{type:Object,required:!0}},data(){return{showForm:!1,file:null,croppedImageBlob:null,errors:{},saving:!1}},watch:{person:{immediate:!0,deep:!0,handler(e){e.profile_photo&&this.fetchProfileImage()}}},computed:{srcPath(){return this.file?(console.log("create from this.file"),URL.createObjectURL(this.file)):this.person.profile_photo?`/profile-photos/${this.person.profile_photo}`:"/images/default_profile.jpg"},profilePhoto(){return this.person.profile_photo?`/profile-photos/${this.person.profile_photo}`:"/images/default_profile.jpg"},altText(){return this.person.profile_photo_path?`${this.person.name} profile photo.`:"Default profile image"}},methods:{initUpload(){this.showForm=!0,this.$nextTick((()=>{window.dispatchEvent(new Event("resize"))}))},setFile(){this.file=this.$refs.fileInput.files[0]},setCroppedImageBlob(e){this.croppedImageBlob=e},async fetchProfileImage(){const e=`/api/people/${this.person.uuid}/profile-photo`,t={Accept:"application/octet-stream",timeout:3e4,responseType:"blob"};this.file=await h.hi.get(e,t).then((e=>{if(e.data instanceof Blob)return new Blob([e.data])}))},saveCropped(){if(this.croppedImageBlob.size>2e6){const e=400,t=new Image;return t.src=URL.createObjectURL(this.croppedImageBlob),void t.addEventListener("load",(()=>{var o=document.createElement("canvas"),i=o.getContext("2d"),r=document.createElement("canvas"),n=r.getContext("2d");o.width=e,o.height=o.width*t.height/t.width;var s={width:Math.floor(.5*t.width),height:Math.floor(.5*t.height)};r.width=s.width,r.height=s.height,n.drawImage(t,0,0,s.width,s.height);while(.5*s.width>e)s={width:Math.floor(.5*s.width),height:Math.floor(.5*s.height)},n.drawImage(r,0,0,2*s.width,2*s.height,0,0,s.width,s.height);i.drawImage(r,0,0,s.width,s.height,0,0,o.width,o.height),o.toBlob((e=>{console.log(e.size/1e3/1e3),this.storeImage(e)}),null,.5)}))}this.storeImage(this.croppedImageBlob)},storeImage(e){this.saving=!0;const t=new FormData;t.append("profile_photo",e),h.hi.post(`/api/people/${this.person.uuid}/profile-photo`,t).then((()=>{this.$store.dispatch("people/getPerson",{uuid:this.person.uuid}),this.showForm=!1,this.file=null,this.saving=!1})).catch((e=>{if((0,h.z1)(e))return this.errors=e.response.data.errors,void(this.saving=!1);throw this.saving=!1,e}))},cancelCropped(){this.showForm=!1,this.file=null}}},c=o(3744);const u=(0,c.Z)(d,[["render",l]]);var m=u},4779:function(e,t,o){o.r(t),o.d(t,{default:function(){return p}});var i=o(6252);function r(e,t,o,r,n,s){const a=(0,i.up)("profile-form");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(a,{person:s.person,modelValue:s.person,"onUpdate:modelValue":t[0]||(t[0]=e=>s.person=e),onSaved:t[1]||(t[1]=e=>s.goBack()),onCanceled:t[2]||(t[2]=e=>s.goBack())},null,8,["person","modelValue"])])}var n=o(6465),s={name:"PersonEdit",components:{ProfileForm:n.Z},props:{uuid:{required:!0,type:String}},computed:{person(){return this.$store.getters["people/currentItem"]}},watch:{uuid:{immediate:!0,handler(){this.$store.dispatch("people/getPerson",{uuid:this.uuid})}}},methods:{goBack(){this.$router.go(-1)}}},a=o(3744);const l=(0,a.Z)(s,[["render",r]]);var p=l}}]);
//# sourceMappingURL=779.133afaf9.js.map